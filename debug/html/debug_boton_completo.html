<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Bot√≥n Eliminar - Diagn√≥stico Completo</title>
    
    <!-- CSS de la aplicaci√≥n -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/modals.css">
    <link rel="stylesheet" href="assets/css/charts.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <style>
        .debug-console {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10000;
            border: 2px solid #333;
        }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .success { color: #0f0; }
        .info { color: #0ff; }
        
        .test-buttons {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .producto-debug {
            border: 2px solid #007bff;
            background: #f8f9fa;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Debug Bot√≥n Eliminar</h1>
            <p>Diagn√≥stico completo del problema</p>
        </div>

        <div class="test-buttons">
            <h3>üß™ Controles de Debug</h3>
            <button onclick="verificarTodo()" class="btn" style="background: #007bff; margin: 5px;">üîç Verificar Todo</button>
            <button onclick="crearProductoDebug()" class="btn" style="background: #28a745; margin: 5px;">‚ûï Crear Producto Debug</button>
            <button onclick="testEliminarManual()" class="btn" style="background: #dc3545; margin: 5px;">‚ö° Test Eliminar Manual</button>
            <button onclick="limpiarConsola()" class="btn" style="background: #6c757d; margin: 5px;">üßπ Limpiar Consola</button>
        </div>

        <!-- Estado de Funciones -->
        <div id="function-status" class="test-buttons" style="background: #e7f3ff;"></div>

        <!-- Lista de Productos -->
        <div class="products-section">
            <h2>üì¶ Productos con Debug</h2>
            <div id="listaProductos" class="productos-lista"></div>
        </div>

        <!-- Consola de Debug -->
        <div class="debug-console" id="debugConsole">
            <strong>üîß Debug Console - Logs en tiempo real</strong><br>
            <div id="debugLog"></div>
        </div>
    </div>

    <!-- Scripts de la Aplicaci√≥n -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/storage.js"></script>
    <script src="assets/js/statistics.js"></script>
    <script src="assets/js/charts.js"></script>
    <script src="assets/js/modals.js"></script>
    <script src="assets/js/products.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        let debugProductId = null;

        function debugLog(mensaje, tipo = 'info') {
            const debugLogEl = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'success': '#0f0',
                'error': '#f00', 
                'warning': '#ff0',
                'info': '#0ff'
            };
            
            debugLogEl.innerHTML += `<div style="color: ${colors[tipo] || '#fff'}; margin: 2px 0;">[${timestamp}] ${mensaje}</div>`;
            debugLogEl.scrollTop = debugLogEl.scrollHeight;
        }

        function limpiarConsola() {
            document.getElementById('debugLog').innerHTML = '';
            debugLog('üßπ Consola limpiada', 'info');
        }

        function verificarTodo() {
            debugLog('üîç === VERIFICACI√ìN COMPLETA ===', 'info');
            
            // 1. Verificar funciones
            const funciones = [
                'eliminarProductoDirecto',
                'eliminarProducto', 
                'confirmarEliminacion',
                'getProductos',
                'saveProductos',
                'deleteProducto',
                'cargarProductos'
            ];

            debugLog('üìã Verificando funciones...', 'info');
            funciones.forEach(func => {
                const existe = typeof window[func] === 'function';
                debugLog(`${existe ? '‚úÖ' : '‚ùå'} ${func}: ${existe ? 'OK' : 'NO ENCONTRADA'}`, existe ? 'success' : 'error');
            });

            // 2. Verificar elementos DOM
            debugLog('üèóÔ∏è Verificando elementos DOM...', 'info');
            const elementos = ['listaProductos', 'modal-confirmacion', 'confirm-product-name'];
            elementos.forEach(id => {
                const elemento = document.getElementById(id);
                debugLog(`${elemento ? '‚úÖ' : '‚ùå'} #${id}: ${elemento ? 'EXISTE' : 'NO ENCONTRADO'}`, elemento ? 'success' : 'error');
            });

            // 3. Verificar productos
            const productos = getProductos();
            debugLog(`üì¶ Productos en storage: ${productos.length}`, 'info');

            // 4. Test b√°sico de funci√≥n
            debugLog('‚ö° Probando eliminarProductoDirecto...', 'info');
            try {
                if (typeof eliminarProductoDirecto === 'function') {
                    debugLog('‚úÖ Funci√≥n eliminarProductoDirecto es ejecutable', 'success');
                } else {
                    debugLog('‚ùå eliminarProductoDirecto no es una funci√≥n', 'error');
                }
            } catch (error) {
                debugLog(`‚ùå Error al probar funci√≥n: ${error.message}`, 'error');
            }
        }

        function crearProductoDebug() {
            debugLog('‚ûï Creando producto de debug...', 'info');
            
            debugProductId = Date.now();
            const producto = {
                id: debugProductId,
                nombre: 'Producto Debug Test',
                valor: 50000,
                cuotas: 10,
                fechaInicio: '2025-01-01',
                valorCuota: 5000,
                cuotasPagadas: 0
            };

            try {
                const productos = getProductos();
                productos.push(producto);
                saveProductos(productos);
                cargarProductos();
                debugLog(`‚úÖ Producto creado con ID: ${debugProductId}`, 'success');
            } catch (error) {
                debugLog(`‚ùå Error al crear producto: ${error.message}`, 'error');
            }
        }

        function testEliminarManual() {
            if (!debugProductId) {
                debugLog('‚ùå No hay producto debug. Cr√©alo primero.', 'error');
                return;
            }

            debugLog(`‚ö° Probando eliminaci√≥n manual del producto ${debugProductId}...`, 'warning');
            
            try {
                // Simular click en el bot√≥n
                debugLog('üñ±Ô∏è Simulando click en bot√≥n eliminar...', 'info');
                
                if (typeof eliminarProductoDirecto === 'function') {
                    eliminarProductoDirecto(debugProductId);
                    debugLog('‚úÖ Funci√≥n eliminarProductoDirecto ejecutada', 'success');
                } else {
                    debugLog('‚ùå Funci√≥n eliminarProductoDirecto no disponible', 'error');
                }
            } catch (error) {
                debugLog(`‚ùå Error en test manual: ${error.message}`, 'error');
            }
        }

        // Override de funciones para capturar eventos
        const originalEliminarProductoDirecto = window.eliminarProductoDirecto;
        window.eliminarProductoDirecto = function(id) {
            debugLog(`üöÄ INTERCEPTADO: eliminarProductoDirecto(${id})`, 'warning');
            try {
                return originalEliminarProductoDirecto.call(this, id);
            } catch (error) {
                debugLog(`üí• ERROR en eliminarProductoDirecto: ${error.message}`, 'error');
                throw error;
            }
        };

        // Interceptar clicks en la p√°gina
        document.addEventListener('click', function(event) {
            const target = event.target;
            debugLog(`üñ±Ô∏è Click detectado en: ${target.tagName} - "${target.textContent.trim()}"`, 'info');
            
            if (target.textContent.includes('Eliminar') || target.textContent.includes('üóëÔ∏è')) {
                debugLog(`‚ö†Ô∏è Click en bot√≥n eliminar detectado!`, 'warning');
                debugLog(`   - Elemento: ${target.outerHTML.substring(0, 100)}...`, 'info');
                debugLog(`   - onclick: ${target.getAttribute('onclick')}`, 'info');
            }
        });

        // Override console para capturar todos los logs
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const mensaje = args.join(' ');
            if (mensaje.includes('Eliminaci√≥n') || mensaje.includes('Error') || mensaje.includes('producto')) {
                debugLog(`üì° APP: ${mensaje}`, 'info');
            }
        };

        const originalConsoleError = console.error;
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            debugLog(`üí• ERROR: ${args.join(' ')}`, 'error');
        };

        // Inicializaci√≥n
        window.addEventListener('DOMContentLoaded', () => {
            debugLog('üöÄ Debug page cargada', 'success');
            setTimeout(() => {
                verificarTodo();
                cargarProductos();
            }, 1000);
        });

        // Monitor de errores globales
        window.addEventListener('error', function(event) {
            debugLog(`üí• ERROR GLOBAL: ${event.message} en ${event.filename}:${event.lineno}`, 'error');
        });
    </script>
</body>
</html>
