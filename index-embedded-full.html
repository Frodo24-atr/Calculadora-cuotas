<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Calculadora de Cuotas v2.0</title>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- CSS Principal embebido -->
    <style>
/* ESTILOS B√ÅSICOS PARA CALCULADORA DE CUOTAS */
* {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 5px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  color: #333;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.1);
  overflow: hidden;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 25px;
  text-align: center;
}

.header h1 {
  margin: 0;
  font-size: 2.5em;
  font-weight: 600;
}

.header p {
  margin: 10px 0 0 0;
  opacity: 0.9;
  font-size: 1.1em;
}

.form-section, .products-section {
  padding: 15px;
}

.form-group {
  margin-bottom: 10px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #555;
}

.form-group input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e1e5e9;
  border-radius: 10px;
  font-size: 16px;
  transition: border-color 0.3s ease;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: #667eea;
  color: white;
}

.btn-primary:hover {
  background: #5a6fd8;
  transform: translateY(-2px);
}

.btn-info {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-info:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

.stat-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 25px;
  border-radius: 15px;
  text-align: center;
}

.stat-value {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
}

.stat-label {
  font-size: 14px;
  opacity: 0.9;
}

.chart-controls {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.chart-type-controls {
  display: flex;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 4px;
  gap: 2px;
}

.chart-type-btn {
  background: none;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  color: #667eea;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  height: 40px;
}

.chart-type-btn:hover {
  background: rgba(102, 126, 234, 0.1);
  transform: translateY(-1px);
}

.chart-type-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.time-range-controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.chart-container {
  background: #f8f9fa;
  border-radius: 15px;
  padding: 20px;
  margin: 20px 0;
}

.chart-canvas-wrapper {
  position: relative;
  height: 300px;
  margin-top: 20px;
}

.product-card {
  background: white;
  border: 2px solid #e1e5e9;
  border-radius: 15px;
  padding: 20px;
  margin: 15px 0;
  box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.product-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.product-header h4 {
  margin: 0;
  color: #333;
  font-size: 18px;
}

.product-actions {
  display: flex;
  gap: 10px;
}

.btn-edit, .btn-delete {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}

.btn-edit {
  background: #ffc107;
  color: #333;
}

.btn-delete {
  background: #dc3545;
  color: white;
}

.pdf-download-section {
  text-align: center;
  margin: 25px 0 20px 0;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
  position: relative;
  overflow: hidden;
}

.pdf-download-content h3 {
  color: white;
  margin: 0 0 15px 0;
  font-size: 24px;
  font-weight: 600;
}

.pdf-download-content p {
  color: rgba(255, 255, 255, 0.9);
  margin: 0 0 25px 0;
  font-size: 16px;
}

.pdf-download-btn {
  background: white !important;
  color: #667eea !important;
  border: none;
  padding: 18px 40px;
  font-size: 18px;
  font-weight: 700;
  border-radius: 50px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.pdf-download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 35px rgba(0,0,0,0.2);
}

.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0);
  opacity: 0;
  backdrop-filter: blur(0px);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.6);
  opacity: 1;
  backdrop-filter: blur(4px);
}

.modal.closing {
  background-color: rgba(0, 0, 0, 0);
  opacity: 0;
  backdrop-filter: blur(0px);
}

.modal-content {
  background-color: white;
  margin: auto;
  padding: 0;
  border-radius: 16px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
  position: relative;
  z-index: 10000;
  transform: scale(0.8) translateY(-30px) rotateX(10deg);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  will-change: transform, opacity;
}

.modal.show .modal-content {
  transform: scale(1) translateY(0) rotateX(0deg);
  opacity: 1;
}

.modal.closing .modal-content {
  transform: scale(0.9) translateY(20px) rotateX(-5deg);
  opacity: 0;
}

.modal-header {
  padding: 20px 20px 10px 20px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transform: translateY(-10px);
  opacity: 0;
  transition: all 0.3s ease 0.1s;
}

.modal.show .modal-header {
  transform: translateY(0);
  opacity: 1;
}

.modal-body {
  padding: 20px;
  transform: translateY(-10px);
  opacity: 0;
  transition: all 0.3s ease 0.2s;
}

.modal.show .modal-body {
  transform: translateY(0);
  opacity: 1;
}

.modal-footer {
  padding: 10px 20px 20px 20px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  transform: translateY(10px);
  opacity: 0;
  transition: all 0.3s ease 0.3s;
}

.modal.show .modal-footer {
  transform: translateY(0);
  opacity: 1;
}

.modal-header h3 {
  margin: 0;
  color: #333;
  font-size: 18px;
  font-weight: 600;
}

.close {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  line-height: 1;
  transform: scale(0.8);
  opacity: 0;
  transition: all 0.3s ease;
}

.modal.show .close {
  transform: scale(1);
  opacity: 1;
  transition: all 0.3s ease 0.1s;
}

.close:hover {
  color: #000;
  transform: scale(1.1) rotate(90deg);
}

/* ===== NAVEGACI√ìN ===== */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  transition: all 0.3s ease;
}

.nav-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 60px;
}

.nav-brand {
  display: flex;
  align-items: center;
  gap: 10px;
  color: white;
  font-size: 18px;
  font-weight: 600;
  text-decoration: none;
}

.nav-brand i {
  font-size: 24px;
}

.nav-menu {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 20px;
}

.nav-item {
  position: relative;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 8px;
  color: white;
  text-decoration: none;
  padding: 10px 15px;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-weight: 500;
}

.nav-link:hover,
.nav-item.active .nav-link {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.nav-link i {
  font-size: 16px;
}

.hamburger {
  display: none;
  flex-direction: column;
  cursor: pointer;
  padding: 5px;
}

.hamburger .bar {
  width: 25px;
  height: 3px;
  background: white;
  margin: 3px 0;
  transition: 0.3s;
  border-radius: 2px;
}

.hamburger.active .bar:nth-child(1) {
  transform: rotate(-45deg) translate(-5px, 6px);
}

.hamburger.active .bar:nth-child(2) {
  opacity: 0;
}

.hamburger.active .bar:nth-child(3) {
  transform: rotate(45deg) translate(-5px, -6px);
}

.nav-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.nav-overlay.active {
  display: block;
  opacity: 1;
}

/* ===== CONTENIDO PRINCIPAL ===== */
.main-content {
  margin-top: 60px;
}

.section {
  padding: 30px 0;
  min-height: auto;
  display: flex;
  align-items: center;
}

.section:nth-child(even) {
  background: transparent;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  width: 100%;
}

.section-header {
  text-align: center;
  margin-bottom: 25px;
}

.section-header h2 {
  font-size: 2.5rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  font-weight: 700;
}

/* Colores por secci√≥n */
#productos .section-header h2 {
  color: #667eea;
}

#productos .section-header h2 i {
  color: #667eea;
}

#estadisticas .section-header h2 {
  color: #26de81;
}

#estadisticas .section-header h2 i {
  color: #26de81;
}

#recordatorios .section-header h2 {
  color: #ff6b6b;
}

#recordatorios .section-header h2 i {
  color: #ff6b6b;
}

#exportar .section-header h2 {
  color: #764ba2;
}

#exportar .section-header h2 i {
  color: #764ba2;
}

.section-header p {
  font-size: 1.2rem;
  color: #666;
  max-width: 600px;
  margin: 0 auto;
}

/* ===== FORMULARIO ===== */
.form-section {
  background: transparent;
  padding: 20px 0;
  border-radius: 0;
  box-shadow: none;
  margin-bottom: 20px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-bottom: 30px;
}

.input-group {
  display: flex;
  flex-direction: column;
}

.input-group label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  font-weight: 600;
  color: #333;
}

.input-group input,
.input-group select {
  padding: 12px 15px;
  border: 2px solid #e1e5e9;
  border-radius: 10px;
  font-size: 16px;
  transition: all 0.3s ease;
}

.input-group input:focus,
.input-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* ================================================= */
/* MEJORAS PARA INPUTS DE FORMATO LATINOAMERICANO */
/* ================================================= */

.input-help {
  display: block;
  font-size: 0.75rem;
  color: #6c757d;
  margin-top: 4px;
  font-style: italic;
  opacity: 0.8;
}

.input-group input:focus + .input-help {
  color: #667eea;
  opacity: 1;
}

.input-group input.error + .input-help {
  color: #dc3545;
}

.input-group input.valid + .input-help {
  color: #28a745;
}

/* Indicador visual de validaci√≥n en tiempo real */
.input-group input.error {
  border-color: #dc3545;
  box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

.input-group input.valid {
  border-color: #28a745;
  box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}

/* ===== BOTONES ===== */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-info {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-info:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-danger {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
  color: white;
}

.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
}

.btn-success {
  background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
  color: white;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(38, 222, 129, 0.3);
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
  transform: translateY(-2px);
}

/* ===== ESTAD√çSTICAS ===== */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 15px;
  border: 2px solid #f0f0f0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
}

.stat-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.stat-icon {
  font-size: 2.5rem;
  color: #26de81;
  margin-bottom: 15px;
}

.stat-content h3 {
  font-size: 2rem;
  color: #333;
  margin-bottom: 8px;
  font-weight: 700;
}

.stat-content p {
  color: #666;
  font-weight: 500;
  margin: 0;
}

/* ===== GR√ÅFICOS ===== */
.chart-section {
  background: transparent;
  padding: 20px 0;
  border-radius: 0;
  box-shadow: none;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  flex-wrap: wrap;
  gap: 20px;
}

.chart-header h3 {
  font-size: 1.5rem;
  color: #333;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.time-range-controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.time-range-btn {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 8px 16px;
  border: 2px solid #e1e5e9;
  background: white;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  color: #666;
}

.time-range-btn:hover,
.time-range-btn.active {
  border-color: #667eea;
  background: #667eea;
  color: white;
  transform: translateY(-2px);
}

.chart-container {
  position: relative;
  height: 400px;
  width: 100%;
}

/* ================================================= */
/* CONTROLES DE GR√ÅFICOS MEJORADOS */
/* ================================================= */

.chart-controls {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.chart-type-controls {
  display: flex;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 4px;
  gap: 2px;
}

.chart-type-btn {
  background: none;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  color: #667eea;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  height: 40px;
}

.chart-type-btn:hover {
  background: rgba(102, 126, 234, 0.1);
  transform: translateY(-1px);
}

.chart-type-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.time-range-controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

/* ================================================= */
/* MENSAJE VAC√çO DEL GR√ÅFICO */
/* ================================================= */

.chart-empty-message {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
  border-radius: 16px;
  border: 2px dashed rgba(102, 126, 234, 0.3);
  margin: 20px 0;
}

.empty-chart-content {
  text-align: center;
  padding: 40px 20px;
  max-width: 400px;
}

.empty-chart-content i {
  font-size: 3rem;
  color: #667eea;
  margin-bottom: 16px;
  opacity: 0.7;
}

.empty-chart-content h4 {
  color: #333;
  font-size: 1.4rem;
  margin-bottom: 12px;
  font-weight: 600;
}

.empty-chart-content p {
  color: #666;
  font-size: 1rem;
  line-height: 1.5;
  margin: 0;
}

/* ================================================= */
/* RESPONSIVE PARA CONTROLES DE GR√ÅFICO */
/* ================================================= */

@media (max-width: 768px) {
  .chart-controls {
    justify-content: center;
    gap: 15px;
  }
  
  .chart-type-controls {
    order: 2;
    margin-top: 10px;
  }
  
  .time-range-controls {
    order: 1;
    justify-content: center;
  }
  
  .chart-type-btn {
    min-width: 36px;
    height: 36px;
    padding: 6px 10px;
    font-size: 14px;
  }
  
  .empty-chart-content {
    padding: 30px 15px;
  }
  
  .empty-chart-content h4 {
    font-size: 1.2rem;
  }
  
  .empty-chart-content p {
    font-size: 0.9rem;
  }
}

@media (max-width: 480px) {
  .chart-controls {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }
  
  .chart-type-controls,
  .time-range-controls {
    justify-content: center;
    order: unset;
    margin: 0;
  }
  
  .chart-empty-message {
    min-height: 250px;
    margin: 15px 0;
  }
  
  .empty-chart-content {
    padding: 25px 15px;
  }
  
  .empty-chart-content i {
    font-size: 2.5rem;
  }
  
  .empty-chart-content h4 {
    font-size: 1.1rem;
  }
}

/* ===== PRODUCTOS ===== */
.products-list {
  background: transparent;
  padding: 20px 0;
  border-radius: 0;
  box-shadow: none;
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 20px;
}

.list-header h3 {
  font-size: 1.5rem;
  color: #333;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.lista-productos {
  display: grid;
  gap: 20px;
}

.producto-item {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 15px;
  border-left: 5px solid #667eea;
  transition: all 0.3s ease;
}

.producto-item:hover {
  transform: translateX(5px);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.producto-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  flex-wrap: wrap;
  gap: 15px;
}

.producto-nombre {
  font-size: 1.3rem;
  color: #333;
  margin: 0;
  font-weight: 600;
}

.producto-acciones {
  display: flex;
  gap: 10px;
}

.btn-edit,
.btn-delete {
  padding: 8px 15px;
  font-size: 14px;
  border-radius: 8px;
}

.btn-edit {
  background: #17a2b8;
  color: white;
}

.btn-edit:hover {
  background: #138496;
}

.btn-delete {
  background: #dc3545;
  color: white;
}

.btn-delete:hover {
  background: #c82333;
}

.producto-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.producto-detalle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #e9ecef;
}

.producto-detalle strong {
  color: #495057;
}

.producto-detalle span {
  color: #667eea;
  font-weight: 600;
}

/* ===== RECORDATORIOS ===== */
.recordatorios-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
  margin-bottom: 40px;
}

.recordatorio-card {
  background: white;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  text-align: center;
  transition: all 0.3s ease;
}

.recordatorio-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
}

.recordatorio-icon {
  font-size: 3rem;
  margin-bottom: 15px;
}

.recordatorio-card:first-child .recordatorio-icon {
  color: #ff6b6b; /* Rojo para email */
}

.recordatorio-card h4 {
  font-size: 1.5rem;
  color: #333;
  margin-bottom: 10px;
}

.recordatorio-card p {
  color: #666;
  margin-bottom: 25px;
}

.recordatorio-input-group {
  margin-bottom: 20px;
  text-align: left;
}

.recordatorio-input,
.recordatorio-select {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e1e5e9;
  border-radius: 10px;
  font-size: 16px;
  transition: all 0.3s ease;
}

.recordatorio-input:focus,
.recordatorio-select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.recordatorio-config {
  margin-bottom: 25px;
  text-align: left;
}

.recordatorio-btn {
  width: 100%;
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.email-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.email-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.recordatorios-status {
  background: transparent;
  padding: 20px 0;
  border-radius: 0;
  box-shadow: none;
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 15px;
  transition: all 0.3s ease;
}

.status-item:hover {
  background: #e9ecef;
}

.status-icon {
  font-size: 1.5rem;
}

.status-item:first-child .status-icon {
  color: #26de81; /* Verde para activos */
}

.status-item:nth-child(2) .status-icon {
  color: #ff6b6b; /* Rojo para pendientes */
}

.status-item:nth-child(3) .status-icon {
  color: #667eea; /* Azul para pr√≥ximos */
}

.next-reminders h5 {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
  color: #333;
}

.reminders-list {
  background: #f8f9fa;
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 15px;
}

.reminder-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: white;
  border-radius: 10px;
  margin-bottom: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.reminder-item:hover {
  transform: translateX(5px);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.reminder-item:last-child {
  margin-bottom: 0;
}

.reminder-info {
  display: flex;
  flex-direction: column;
  gap: 5px;
  flex: 1;
}

.reminder-type {
  font-size: 12px;
  color: #666;
  font-weight: 600;
}

.reminder-product {
  font-weight: 600;
  color: #333;
  font-size: 14px;
}

.reminder-amount {
  color: #667eea;
  font-weight: 600;
  font-size: 14px;
}

.reminder-date {
  color: #666;
  font-size: 12px;
}

.delete-reminder-btn {
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  margin-left: 15px;
}

.delete-reminder-btn:hover {
  background: #c82333;
  transform: scale(1.1);
}

.reminders-controls {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 15px;
  flex-wrap: wrap;
}

.test-email-btn {
  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
  border: none;
  transition: all 0.3s ease;
}

.test-email-btn:hover {
  background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(23, 162, 184, 0.3);
}

.send-full-report-btn {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  border: none;
  transition: all 0.3s ease;
}

.send-full-report-btn:hover {
  background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
}

.delete-all-btn {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
}

/* ===== PDF EXPORT ===== */
.pdf-download-section {
  background: transparent;
  padding: 20px 0;
  border-radius: 0;
  box-shadow: none;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.pdf-download-background {
  display: none;
}

.pdf-download-content {
  position: relative;
  z-index: 2;
  background: white;
  padding: 30px;
  border-radius: 15px;
  border: 2px solid #f0f0f0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.pdf-icon {
  font-size: 4rem;
  color: #764ba2;
  margin-bottom: 20px;
}

.pdf-download-content h3 {
  font-size: 2rem;
  color: #333;
  margin-bottom: 15px;
}

.pdf-download-content p {
  font-size: 1.1rem;
  color: #666;
  margin-bottom: 25px;
}

.pdf-features {
  list-style: none;
  padding: 0;
  margin: 25px 0;
  text-align: left;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}

.pdf-features li {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 5px 0;
  color: #666;
}

.pdf-features i {
  color: #26de81;
  font-size: 16px;
}

.pdf-download-btn {
  background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

.pdf-download-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(38, 222, 129, 0.3);
}

/* ===== MODALES ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
}

.modal-content {
  background-color: white;
  margin: 10% auto;
  padding: 0;
  border-radius: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  padding: 25px 30px 20px;
  border-bottom: 2px solid #f1f3f4;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  margin: 0;
  color: #333;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.close {
  color: #666;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.3s ease;
}

.close:hover {
  color: #333;
}

.modal-body {
  padding: 25px 30px;
}

.modal-footer {
  padding: 20px 30px 25px;
  border-top: 2px solid #f1f3f4;
  display: flex;
  justify-content: flex-end;
  gap: 15px;
}

/* ===== LOADING ===== */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;
}

.loading-spinner {
  text-align: center;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-spinner p {
  color: #333;
  font-size: 18px;
  font-weight: 600;
  margin: 0;
}

/* ===== MENSAJE DE RESULTADO ===== */
.resultado {
  position: fixed;
  top: 80px;
  right: 20px;
  padding: 15px 25px;
  border-radius: 10px;
  color: white;
  font-weight: 600;
  z-index: 2000;
  max-width: 350px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
  transform: translateX(400px);
  opacity: 0;
  transition: all 0.3s ease;
}

.resultado.success {
  background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
  transform: translateX(0);
  opacity: 1;
}

.resultado.error {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
  transform: translateX(0);
  opacity: 1;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
  .hamburger {
    display: flex;
  }

  .nav-menu {
    position: fixed;
    top: 60px;
    right: -100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    width: 100%;
    max-width: 300px;
    height: calc(100vh - 60px);
    flex-direction: column;
    align-items: flex-start;
    padding: 20px;
    transition: right 0.3s ease;
    box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
  }

  .nav-menu.active {
    right: 0;
  }

  .nav-item {
    width: 100%;
    margin-bottom: 10px;
  }

  .nav-link {
    width: 100%;
    padding: 15px 20px;
    border-radius: 10px;
    font-size: 16px;
  }

  .nav-link span {
    font-size: 16px;
  }

  .section {
    padding: 40px 0;
    min-height: auto;
  }

  .section-header h2 {
    font-size: 2rem;
    flex-direction: column;
    gap: 10px;
  }

  .section-header p {
    font-size: 1rem;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }

  .chart-header {
    flex-direction: column;
    align-items: stretch;
    text-align: center;
  }

  .time-range-controls {
    justify-content: center;
  }

  .list-header {
    flex-direction: column;
    text-align: center;
  }

  .producto-header {
    flex-direction: column;
    text-align: center;
  }

  .producto-info {
    grid-template-columns: 1fr;
  }

  .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .recordatorios-grid {
    grid-template-columns: 1fr;
  }

  .status-grid {
    grid-template-columns: 1fr;
  }

  .reminder-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .reminder-info {
    width: 100%;
  }

  .delete-reminder-btn {
    align-self: flex-end;
    margin-left: 0;
  }

  .modal-content {
    margin: 5% auto;
    width: 95%;
  }

  .modal-footer {
    flex-direction: column;
    gap: 10px;
  }

  .btn {
    width: 100%;
    justify-content: center;
  }

  .pdf-features {
    text-align: center;
  }
}

@media (max-width: 480px) {
  .nav-container {
    padding: 0 15px;
  }

  .container {
    padding: 0 15px;
  }

  .form-section,
  .products-list,
  .chart-section,
  .recordatorio-card,
  .recordatorios-status,
  .pdf-download-section {
    padding: 20px;
  }

  .section-header h2 {
    font-size: 1.8rem;
  }

  .stat-card {
    padding: 20px;
  }

  .producto-item {
    padding: 15px;
  }

  .modal-header,
  .modal-body,
  .modal-footer {
    padding: 20px;
  }
}

/* ===== ANIMACIONES ADICIONALES ===== */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.section {
  animation: fadeInUp 0.6s ease-out;
}

.stat-card,
.recordatorio-card,
.producto-item {
  animation: fadeInUp 0.6s ease-out;
}

/* Smooth scrolling para toda la p√°gina */
html {
  scroll-behavior: smooth;
}

/* Mejoras de accesibilidad */
*:focus {
  outline: 2px solid #667eea;
  outline-offset: 2px;
}

button:focus,
input:focus,
select:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
}

/* ================================================= */
/* SISTEMA DE NOTIFICACIONES FLOTANTES */
/* ================================================= */

.notification-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-width: 400px;
  pointer-events: none;
}

.notification {
  padding: 16px 20px;
  border-radius: 12px;
  color: white;
  font-weight: 500;
  font-size: 14px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  gap: 12px;
  opacity: 0;
  transform: translateX(100%);
  transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  pointer-events: auto;
  position: relative;
  overflow: hidden;
}

.notification.show {
  opacity: 1;
  transform: translateX(0);
}

.notification.hide {
  opacity: 0;
  transform: translateX(100%);
}

/* Tipos de notificaciones */
.notification.success {
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  border-left: 4px solid #2E7D32;
}

.notification.success::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(76, 175, 80, 0.9) 0%, rgba(69, 160, 73, 0.9) 100%);
  z-index: -1;
}

.notification.error {
  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
  border-left: 4px solid #c62828;
}

.notification.error::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(244, 67, 54, 0.9) 0%, rgba(211, 47, 47, 0.9) 100%);
  z-index: -1;
}

.notification.warning {
  background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
  border-left: 4px solid #ef6c00;
}

.notification.warning::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 152, 0, 0.9) 0%, rgba(245, 124, 0, 0.9) 100%);
  z-index: -1;
}

.notification.info {
  background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
  border-left: 4px solid #1565C0;
}

.notification.info::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(33, 150, 243, 0.9) 0%, rgba(25, 118, 210, 0.9) 100%);
  z-index: -1;
}

.notification-icon {
  font-size: 18px;
  flex-shrink: 0;
}

.notification-content {
  flex: 1;
  z-index: 1;
}

.notification-title {
  font-weight: 600;
  font-size: 15px;
  margin-bottom: 4px;
}

.notification-message {
  font-size: 13px;
  opacity: 0.95;
  line-height: 1.3;
}

.notification-close {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 16px;
  opacity: 0.7;
  transition: opacity 0.2s ease;
  padding: 4px;
  border-radius: 4px;
  flex-shrink: 0;
  z-index: 1;
}

.notification-close:hover {
  opacity: 1;
  background: rgba(255, 255, 255, 0.1);
}

/* Animaci√≥n de progreso */
.notification-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: rgba(255, 255, 255, 0.3);
  transition: width linear;
  z-index: 1;
}

/* Responsive */
@media (max-width: 480px) {
  .notification-container {
    left: 10px;
    right: 10px;
    bottom: 10px;
    max-width: none;
  }
  
  .notification {
    font-size: 13px;
    padding: 14px 16px;
  }
  
  .notification-title {
    font-size: 14px;
  }
  
  .notification-message {
    font-size: 12px;
  }
}

/* ================================================= */
/* FIN DE NOTIFICACIONES FLOTANTES */
/* ================================================= */
    </style>
</head>
<body>
    <!-- Navegaci√≥n -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-calculator"></i>
                <span>Calculadora de Cuotas</span>
            </div>
            
            <!-- Men√∫ Desktop -->
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#products" class="nav-link">
                        <i class="fas fa-box"></i>
                        <span>Productos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#statistics" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Estad√≠sticas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#reminders" class="nav-link">
                        <i class="fas fa-bell"></i>
                        <span>Recordatorios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#export" class="nav-link">
                        <i class="fas fa-file-pdf"></i>
                        <span>Exportar</span>
                    </a>
                </li>
            </ul>
            
            <!-- Hamburger Menu -->
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Overlay para m√≥vil -->
    <div class="nav-overlay"></div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Cargando aplicaci√≥n...</p>
        </div>
    </div>

    <!-- Contenido Principal -->
    <main class="main-content">
        <!-- Secci√≥n: Agregar Productos -->
        <section id="products" class="section">
            <div class="container">
                <div class="section-header">
                    <h2><i class="fas fa-plus-circle"></i> Agregar Producto</h2>
                    <p>Gestiona tus productos y cuotas de manera sencilla</p>
                </div>
                
                <div class="form-section">
                    <form id="productForm">
                        <div class="form-grid">
                            <div class="input-group">
                                <label for="nombreProducto">
                                    <i class="fas fa-tag"></i>
                                    Nombre del Producto
                                </label>
                                <input type="text" id="nombreProducto" placeholder="Ej: Laptop, Celular, etc." required>
                            </div>
                            
                            <div class="input-group">
                                <label for="valorTotalProducto">
                                    <i class="fas fa-dollar-sign"></i>
                                    Valor Total
                                </label>
                                <input type="text" id="valorTotalProducto" placeholder="ej: 1.500,75 o 1,500.75" required>
                                <small class="input-help">Acepta formato con punto o coma decimal</small>
                            </div>
                            
                            <div class="input-group">
                                <label for="numeroCuotas">
                                    <i class="fas fa-calendar-alt"></i>
                                    N√∫mero de Cuotas
                                </label>
                                <input type="number" id="numeroCuotas" placeholder="12" min="1" max="60" required>
                            </div>
                            
                            <div class="input-group">
                                <label for="fechaInicio">
                                    <i class="fas fa-calendar-day"></i>
                                    Fecha de Inicio
                                </label>
                                <input type="date" id="fechaInicio" required>
                            </div>
                        </div>
                        
                        <button type="button" id="btnAgregarProducto" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Agregar Producto
                        </button>
                    </form>
                </div>
                
                <!-- Lista de Productos -->
                <div class="products-list">
                    <div class="list-header">
                        <h3><i class="fas fa-list"></i> Productos Registrados</h3>
                        <button id="btnBorrarTodo" class="btn btn-danger" style="display: none;">
                            <i class="fas fa-trash-alt"></i>
                            Eliminar Todos
                        </button>
                    </div>
                    <div id="listaProductos" class="lista-productos">
                        <p class="no-products">No hay productos registrados. ¬°Agrega tu primer producto arriba! üöÄ</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n: Estad√≠sticas -->
        <section id="statistics" class="section">
            <div class="container">
                <div class="section-header">
                    <h2><i class="fas fa-chart-line"></i> Estad√≠sticas y Gr√°ficos</h2>
                    <p>Visualiza el progreso de tus pagos y estad√≠sticas</p>
                </div>
                
                <!-- Estad√≠sticas R√°pidas -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalProductos">0</h3>
                            <p>Total Productos</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="valorTotal">$0</h3>
                            <p>Valor Total</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="promedioMensual">$0</h3>
                            <p>Promedio Mensual</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="proximoMes">$0</h3>
                            <p>Pr√≥ximo Mes</p>
                        </div>
                    </div>
                </div>
                
                <!-- Gr√°fico -->
                <div class="chart-section">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Gr√°fico de Cuotas</h3>
                        <div class="chart-controls">
                            <!-- Controles de tipo de gr√°fico -->
                            <div class="chart-type-controls">
                                <button class="chart-type-btn active" data-type="bar" title="Gr√°fico de Barras">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                                <button class="chart-type-btn" data-type="line" title="Gr√°fico de L√≠neas">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="chart-type-btn" data-type="area" title="Gr√°fico de √Årea">
                                    <i class="fas fa-chart-area"></i>
                                </button>
                            </div>
                            
                            <!-- Controles de tiempo -->
                            <div class="time-range-controls">
                                <button class="time-range-btn active" data-range="all">
                                    <i class="fas fa-globe"></i>
                                    Todo
                                </button>
                                <button class="time-range-btn" data-range="6m">
                                    <i class="fas fa-calendar-alt"></i>
                                    6 Meses
                                </button>
                                <button class="time-range-btn" data-range="3m">
                                    <i class="fas fa-calendar"></i>
                                    3 Meses
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <!-- Mensaje cuando no hay productos -->
                        <div id="chartMessage" class="chart-empty-message">
                            <div class="empty-chart-content">
                                <i class="fas fa-chart-pie"></i>
                                <h4>üìä ¬°Agrega un producto para visualizar el gr√°fico!</h4>
                                <p>Una vez que agregues productos, podr√°s ver aqu√≠ el an√°lisis de tus cuotas mensuales</p>
                            </div>
                        </div>
                        <canvas id="gastosChart" style="display: none;"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n: Recordatorios -->
        <section id="reminders" class="section">
            <div class="container">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> Sistema de Recordatorios</h2>
                    <p>Configura recordatorios autom√°ticos por email</p>
                </div>
                
                <!-- Configuraci√≥n de Email -->
                <div class="recordatorios-grid">
                    <div class="recordatorio-card email-card">
                        <div class="recordatorio-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h4>Recordatorios por Email</h4>
                        <p>Recibe notificaciones autom√°ticas en tu correo</p>
                        
                        <div class="recordatorio-input-group">
                            <label for="emailAddress">
                                <i class="fas fa-at"></i>
                                Correo electr√≥nico:
                            </label>
                            <input type="email" id="emailAddress" placeholder="tu@email.com" class="recordatorio-input">
                        </div>
                        
                        <div class="recordatorio-config">
                            <label for="emailDays">
                                <i class="fas fa-clock"></i>
                                Recordar con:
                            </label>
                            <select id="emailDays" class="recordatorio-select">
                                <option value="1">1 d√≠a de anticipaci√≥n</option>
                                <option value="3" selected>3 d√≠as de anticipaci√≥n</option>
                                <option value="7">1 semana de anticipaci√≥n</option>
                            </select>
                        </div>
                        
                        <button class="recordatorio-btn email-btn" onclick="setupEmailReminder()">
                            <i class="fas fa-check"></i>
                            Configurar Email
                        </button>
                    </div>
                </div>

                <!-- Estado de Recordatorios -->
                <div class="recordatorios-status">
                    <h4><i class="fas fa-info-circle"></i> Estado de Configuraci√≥n</h4>
                    <div class="status-grid">
                        <div class="status-item email-status">
                            <span class="status-icon">
                                <i class="fas fa-envelope"></i>
                            </span>
                            <span class="status-text" id="emailStatus">No configurado</span>
                        </div>
                    </div>
                    
                    <div class="next-reminders">
                        <h5><i class="fas fa-calendar-check"></i> Pr√≥ximos recordatorios:</h5>
                        <div id="nextReminders" class="reminders-list">
                            <p>No hay recordatorios programados</p>
                        </div>
                    </div>
                    
                    <div class="reminders-controls" id="remindersControls" style="display: block;">
                        <button class="btn btn-success send-full-report-btn" onclick="sendFullReportEmail()" title="Env√≠a un reporte completo con todos los productos y cuotas">
                            <i class="fas fa-file-alt"></i>
                            Enviar Reporte Completo
                        </button>
                        <button class="btn btn-danger delete-all-btn" onclick="deleteAllReminders()">
                            <i class="fas fa-trash-alt"></i>
                            Eliminar Todos los Recordatorios
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n: Exportar PDF -->
        <section id="export" class="section">
            <div class="container">
                <div class="section-header">
                    <h2><i class="fas fa-file-pdf"></i> Exportar Reporte</h2>
                    <p>Descarga un resumen completo en formato PDF</p>
                </div>
                
                <div class="pdf-download-section">
                    <div class="pdf-download-background"></div>
                    <div class="pdf-download-content">
                        <div class="pdf-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <h3>Reporte PDF Completo</h3>
                        <p>Incluye estad√≠sticas, gr√°ficos y desglose mensual detallado</p>
                        <ul class="pdf-features">
                            <li><i class="fas fa-check"></i> Resumen de todos los productos</li>
                            <li><i class="fas fa-check"></i> Gr√°fico de cuotas mensuales</li>
                            <li><i class="fas fa-check"></i> Estad√≠sticas detalladas</li>
                            <li><i class="fas fa-check"></i> Desglose por tarjetas mensuales</li>
                        </ul>
                        <button id="btnDescargarPDF" class="btn btn-success pdf-download-btn">
                            <i class="fas fa-download"></i>
                            Descargar PDF
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Mensaje de resultado -->
    <div id="resultado" class="resultado"></div>

    <!-- Modal de Edici√≥n -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Producto</h3>
                <span id="closeEditModal" class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="modal-nombre">
                        <i class="fas fa-tag"></i>
                        Nombre del Producto:
                    </label>
                    <input type="text" id="modal-nombre" required>
                </div>
                <div class="input-group">
                    <label for="modal-valor">
                        <i class="fas fa-dollar-sign"></i>
                        Valor Total:
                    </label>
                    <input type="text" id="modal-valor" placeholder="ej: 1.500,75 o 1,500.75" required>
                    <small class="input-help">Acepta formato con punto o coma decimal</small>
                </div>
                <div class="input-group">
                    <label for="modal-cuotas">
                        <i class="fas fa-calendar-alt"></i>
                        N√∫mero de Cuotas:
                    </label>
                    <input type="number" id="modal-cuotas" required>
                </div>
                <div class="input-group">
                    <label for="modal-fecha">
                        <i class="fas fa-calendar-day"></i>
                        Fecha de Inicio:
                    </label>
                    <input type="date" id="modal-fecha" required>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCancelEdit" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
                <button id="btnSaveEdit" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="confirmModal" class="modal">
        <div class="modal-content confirm-modal">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminaci√≥n</h3>
            </div>
            <div class="modal-body">
                <p>¬øEst√°s seguro de que deseas eliminar el producto "<span id="confirm-product-name"></span>"?</p>
                <p class="warning-text">Esta acci√≥n no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button id="btnCancelDelete" class="btn btn-secondary confirm-btn-cancel">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
                <button id="btnConfirmDelete" class="btn btn-danger confirm-btn-delete">
                    <i class="fas fa-trash"></i>
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Sistema de Notificaciones Flotantes -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Scripts JavaScript -->
    <!-- Cargar configuraci√≥n de servicios primero -->
    <script src="./config/services.js"></script>
    
    <!-- Cargar scripts principales directamente -->
    <script src="./modules/reminders.js"></script>
    <script src="./scripts/app.js"></script>
    
    <!-- Script de navegaci√≥n -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            const navOverlay = document.querySelector('.nav-overlay');
            const navLinks = document.querySelectorAll('.nav-link');

            // Toggle men√∫ m√≥vil
            hamburger.addEventListener('click', function() {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
                navOverlay.classList.toggle('active');
                document.body.classList.toggle('nav-open');
            });

            // Cerrar men√∫ al hacer clic en overlay
            navOverlay.addEventListener('click', function() {
                closeMenu();
            });

            // Cerrar men√∫ al hacer clic en un enlace
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    
                    if (targetSection) {
                        targetSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                    
                    closeMenu();
                    
                    // Actualizar enlace activo
                    navLinks.forEach(l => l.parentElement.classList.remove('active'));
                    this.parentElement.classList.add('active');
                });
            });

            // Funci√≥n para cerrar men√∫
            function closeMenu() {
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
                navOverlay.classList.remove('active');
                document.body.classList.remove('nav-open');
            }

            // Cerrar men√∫ al scroll en m√≥vil
            let isScrolling = false;
            window.addEventListener('scroll', function() {
                if (!isScrolling && window.innerWidth <= 768) {
                    isScrolling = true;
                    closeMenu();
                    setTimeout(() => {
                        isScrolling = false;
                    }, 100);
                }
            });

            // Actualizar enlace activo al hacer scroll
            window.addEventListener('scroll', function() {
                const sections = document.querySelectorAll('.section');
                const scrollPos = window.scrollY + 100;

                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.getAttribute('id');

                    if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                        navLinks.forEach(link => {
                            link.parentElement.classList.remove('active');
                            if (link.getAttribute('href') === '#' + sectionId) {
                                link.parentElement.classList.add('active');
                            }
                        });
                    }
                });
            });
        });
    </script>
    
    <!-- Timeout de emergencia para evitar cuelgues -->
    <script>
        // Timeout de emergencia - fuerza ocultar loading despu√©s de 2 segundos
        setTimeout(() => {
            const loading = document.getElementById('loadingIndicator');
            if (loading && loading.style.display !== 'none') {
                loading.style.display = 'none';
                console.log('‚úÖ Loading ocultado por timeout de emergencia');
            }
        }, 2000);
        
        // Inicializaci√≥n inmediata del loading
        document.addEventListener('DOMContentLoaded', () => {
            const loading = document.getElementById('loadingIndicator');
            if (loading) {
                setTimeout(() => {
                    if (loading.style.display !== 'none') {
                        loading.style.display = 'none';
                        console.log('‚úÖ Loading ocultado por timeout DOM');
                    }
                }, 1000);
            }
        });
    </script>

    <!-- Scripts JavaScript embebidos -->
    
    <!-- Configuraci√≥n de servicios -->
    <script>
/**
 * Configuraci√≥n de servicios externos para recordatorios
 * 
 * INSTRUCCIONES PARA CONFIGURAR:
 * 
 * 1. EmailJS (Para env√≠o de emails):
 *    - Crear cuenta en https://www.emailjs.com/
 *    - Ir a https://dashboard.emailjs.com/admin/services
 *    - Crear un servicio de email (Gmail, Outlook, etc.)
 *    - Ir a https://dashboard.emailjs.com/admin/templates
 *    - Crear una plantilla con las variables: {{to_email}}, {{product_name}}, {{payment_date}}, {{amount}}
 *    - Copiar las claves y reemplazar los valores abajo
 * 
 * IMPORTANTE: Si no tienes configurado EmailJS, las notificaciones funcionar√°n
 * pero los emails no se enviar√°n.
 */

console.log('üîß === INICIANDO CARGA DE SERVICES.JS ===');

// Funci√≥n para configurar SERVICES_CONFIG
function setupServicesConfig() {
  console.log('üìã Definiendo SERVICES_CONFIG...');

  const SERVICES_CONFIG = {
    // Configuraci√≥n de EmailJS
    emailJS: {
      publicKey: '8c4l-rq7DsQF8ibja', // Tu Public Key de EmailJS
      serviceId: 'service_srur1ha', // Tu Service ID  
      templateId: 'template_vd109cb', // ‚úÖ Template ID real actualizado
      
      // Configuraci√≥n adicional
      enabled: true, // ‚úÖ Habilitado para usar el template real
      
      // Plantilla de ejemplo para crear en EmailJS:
      exampleTemplate: {
        subject: "Recordatorio de Pago - ${product_name}",
        body: "Hola,\n\nTe recordamos que tienes un pago pendiente:\n\nProducto: ${product_name}\nMonto: $${amount}\nFecha de vencimiento: ${payment_date}\n\n¬°No olvides realizar tu pago a tiempo!\n\nSaludos,\nTu Calculadora de Cuotas"
      }
    },
    
    // Configuraci√≥n de WhatsApp (no requiere claves)
    whatsapp: {
      baseUrl: 'https://wa.me/'
    }
  };

  console.log('‚úÖ SERVICES_CONFIG definido correctamente');

  // Verificar que window existe (navegador)
  if (typeof window !== 'undefined') {
    console.log('üåê Ejecut√°ndose en navegador - asignando a window');
    
    // Hacer disponible globalmente de m√∫ltiples maneras
    window.SERVICES_CONFIG = SERVICES_CONFIG;
    
    // Tambi√©n como variable global sin window
    if (typeof globalThis !== 'undefined') {
      globalThis.SERVICES_CONFIG = SERVICES_CONFIG;
    }
    
    // Verificar que se asign√≥ correctamente
    if (window.SERVICES_CONFIG && window.SERVICES_CONFIG.emailJS) {
      console.log('‚úÖ SERVICES_CONFIG asignado correctamente a window');
      console.log('üìß EmailJS config disponible:', !!window.SERVICES_CONFIG.emailJS);
    } else {
      console.error('‚ùå Error: SERVICES_CONFIG no se asign√≥ correctamente a window');
    }
  } else {
    console.log('‚ö†Ô∏è window no disponible (entorno Node.js)');
  }

  // Confirmar que se carg√≥ correctamente
  console.log('‚úÖ services.js procesado exitosamente');
  console.log('üìã Configuraci√≥n EmailJS:', {
    enabled: SERVICES_CONFIG.emailJS.enabled,
    hasPublicKey: !!SERVICES_CONFIG.emailJS.publicKey,
    hasServiceId: !!SERVICES_CONFIG.emailJS.serviceId,
    hasTemplateId: !!SERVICES_CONFIG.emailJS.templateId,
    templateId: SERVICES_CONFIG.emailJS.templateId
  });

  return SERVICES_CONFIG;
}

try {
  // Configurar servicios
  const config = setupServicesConfig();
  
  // Evento personalizado para notificar que se carg√≥
  if (typeof window !== 'undefined') {
    // Disparar evento inmediatamente
    const event = new CustomEvent('servicesConfigLoaded', { 
      detail: { config: config } 
    });
    window.dispatchEvent(event);
    console.log('üéØ Evento servicesConfigLoaded disparado inmediatamente');
    
    // Tambi√©n disparar despu√©s de un breve delay para asegurar listeners
    setTimeout(() => {
      const delayedEvent = new CustomEvent('servicesConfigLoaded', { 
        detail: { config: config } 
      });
      window.dispatchEvent(delayedEvent);
      console.log('üéØ Evento servicesConfigLoaded disparado con delay');
    }, 100);
    
    // Marcar como cargado
    window.SERVICES_CONFIG_LOADED = true;
  }

} catch (error) {
  console.error('‚ùå ERROR CR√çTICO en services.js:', error);
  console.error('üìã Stack trace:', error.stack);
  
  // Crear configuraci√≥n de emergencia
  if (typeof window !== 'undefined') {
    console.log('üö® Creando configuraci√≥n de emergencia...');
    window.SERVICES_CONFIG = {
      emailJS: {
        publicKey: '8c4l-rq7DsQF8ibja',
        serviceId: 'service_srur1ha',
        templateId: 'template_EJEMPLO',
        enabled: false
      },
      whatsapp: {
        baseUrl: 'https://wa.me/'
      }
    };
    window.SERVICES_CONFIG_LOADED = true;
    console.log('‚ö†Ô∏è Configuraci√≥n de emergencia creada');
  }
}

console.log('üîß === FIN DE CARGA DE SERVICES.JS ===');
    </script>
    
    <!-- M√≥dulo de recordatorios -->
    <script>
/**
 * M√≥dulo de Recordatorios
 * Gestiona recordatorios por WhatsApp y Email
 */

class RemindersManager {
  constructor() {
    try {
      console.log('üîî Construyendo RemindersManager...');
      
      this.config = {
        email: {
          enabled: false,
          address: '',
          daysAhead: 3,
          serviceId: '', // EmailJS Service ID
          templateId: '', // EmailJS Template ID
          publicKey: '' // EmailJS Public Key
        }
      };
      
      this.reminders = [];
      this.sentReminders = new Set(); // Para evitar enviar duplicados
      this.checkInterval = null; // Intervalo de verificaci√≥n
      
      console.log('üìã Cargando configuraci√≥n...');
      this.loadConfig();
      
      console.log('üìã Cargando recordatorios enviados...');
      this.loadSentReminders();
      
      console.log('üîß Inicializando servicios...');
      this.initializeServices();
      
      console.log('‚è∞ Iniciando programador...');
      this.startReminderScheduler();
      
      // Inicializar UI cuando el DOM est√© listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          this.updateUI();
          this.loadExistingProducts();
        });
      } else {
        setTimeout(() => {
          this.updateUI();
          this.loadExistingProducts();
        }, 100);
      }
      
      console.log('‚úÖ RemindersManager construido correctamente');
    } catch (error) {
      console.error('‚ùå Error en constructor de RemindersManager:', error);
      throw error;
    }
  }

  // Cargar configuraci√≥n del localStorage
  loadConfig() {
    const saved = localStorage.getItem('remindersConfig');
    if (saved) {
      this.config = { ...this.config, ...JSON.parse(saved) };
    }
  }

  // Guardar configuraci√≥n
  saveConfig() {
    localStorage.setItem('remindersConfig', JSON.stringify(this.config));
    this.updateUI();
  }

  // Cargar recordatorios ya enviados
  loadSentReminders() {
    const saved = localStorage.getItem('sentReminders');
    if (saved) {
      this.sentReminders = new Set(JSON.parse(saved));
    }
  }

  // Guardar recordatorios enviados
  saveSentReminders() {
    localStorage.setItem('sentReminders', JSON.stringify([...this.sentReminders]));
  }

  // Inicializar servicios externos
  async initializeServices() {
    console.log('üîß Iniciando initializeServices...');
    
    // Verificar m√∫ltiples m√©todos de acceso a la configuraci√≥n
    let configFound = false;
    let attempts = 0;
    const maxAttempts = 30; // 1.5 segundos m√°ximo
    
    // Funci√≥n para verificar configuraci√≥n disponible
    const checkConfig = () => {
      // M√©todo 1: window.SERVICES_CONFIG
      if (typeof window !== 'undefined' && window.SERVICES_CONFIG) {
        console.log('‚úÖ Configuraci√≥n encontrada en window.SERVICES_CONFIG');
        return true;
      }
      
      // M√©todo 2: Variable global SERVICES_CONFIG
      if (typeof SERVICES_CONFIG !== 'undefined') {
        console.log('‚úÖ Configuraci√≥n encontrada en SERVICES_CONFIG global');
        if (typeof window !== 'undefined') {
          window.SERVICES_CONFIG = SERVICES_CONFIG;
        }
        return true;
      }
      
      // M√©todo 3: Verificar si hay un marcador de carga
      if (typeof window !== 'undefined' && window.SERVICES_CONFIG_LOADED) {
        console.log('‚úÖ Configuraci√≥n marcada como cargada');
        return true;
      }
      
      return false;
    };
    
    // Verificar si ya est√° disponible
    if (checkConfig()) {
      configFound = true;
      console.log('‚úÖ Configuraci√≥n ya disponible');
    } else {
      console.log('‚è≥ Configuraci√≥n no disponible, estableciendo listeners y esperando...');
      
      // Escuchar el evento personalizado de carga de services.js
      const configListener = (event) => {
        console.log('üéØ Evento servicesConfigLoaded recibido');
        if (event.detail && event.detail.config) {
          window.SERVICES_CONFIG = event.detail.config;
          configFound = true;
          console.log('‚úÖ Configuraci√≥n establecida desde evento');
        }
      };
      
      if (typeof window !== 'undefined') {
        window.addEventListener('servicesConfigLoaded', configListener);
      }
      
      // Esperar hasta que SERVICES_CONFIG est√© disponible
      while (!configFound && attempts < maxAttempts) {
        console.log(`‚è≥ Esperando SERVICES_CONFIG... Intento ${attempts + 1}/${maxAttempts}`);
        await new Promise(resolve => setTimeout(resolve, 50));
        attempts++;
        
        if (checkConfig()) {
          configFound = true;
          break;
        }
      }

      // Limpiar listener
      if (typeof window !== 'undefined') {
        window.removeEventListener('servicesConfigLoaded', configListener);
      }
    }

    // Verificar que la configuraci√≥n est√© disponible
    if (!configFound || typeof window.SERVICES_CONFIG === 'undefined') {
      console.error('‚ùå Configuraci√≥n de servicios no encontrada despu√©s de esperar');
      console.error('üîß Aseg√∫rate de que src/config/services.js se est√© cargando correctamente');
      console.error('‚ÑπÔ∏è La aplicaci√≥n funcionar√° pero sin recordatorios por email');
      
      // Crear configuraci√≥n b√°sica de emergencia
      window.SERVICES_CONFIG = {
        emailJS: {
          publicKey: '8c4l-rq7DsQF8ibja',
          serviceId: 'service_srur1ha',
          templateId: 'template_EJEMPLO',
          enabled: false
        },
        whatsapp: {
          baseUrl: 'https://wa.me/'
        }
      };
      
      console.log('üö® Configuraci√≥n de emergencia creada');
    }

    console.log('‚úÖ SERVICES_CONFIG encontrado:', window.SERVICES_CONFIG);
    const config = window.SERVICES_CONFIG;

    // Inicializar EmailJS
    if (typeof emailjs !== 'undefined') {
      try {
        console.log('üîß Verificando configuraci√≥n de EmailJS...');
        
        // Verificar configuraci√≥n completa
        if (!config.emailJS.publicKey || !config.emailJS.serviceId || !config.emailJS.templateId) {
          console.warn('‚ö†Ô∏è Configuraci√≥n de EmailJS incompleta. Revisa src/config/services.js');
          console.warn('üìã Estado actual:', {
            publicKey: !!config.emailJS.publicKey,
            serviceId: !!config.emailJS.serviceId,
            templateId: !!config.emailJS.templateId,
            enabled: config.emailJS.enabled
          });
          return;
        }

        // Inicializar EmailJS con la Public Key
        emailjs.init(config.emailJS.publicKey);
        
        console.log('‚úÖ EmailJS inicializado correctamente');
        console.log('üîß Configuraci√≥n:', {
          publicKey: config.emailJS.publicKey.substring(0, 8) + '...',
          serviceId: config.emailJS.serviceId,
          templateId: config.emailJS.templateId,
          enabled: config.emailJS.enabled
        });
      } catch (error) {
        console.error('‚ùå Error inicializando EmailJS:', error.message);
        console.error('üîß Error completo:', error);
      }
    } else {
      console.warn('‚ö†Ô∏è EmailJS no disponible - librer√≠a no cargada');
    }
  }

  // Configurar recordatorio de Email
  async setupEmail(address, daysAhead) {
    console.log('üìß Configurando email para:', address);
    
    if (!address || !this.validateEmail(address)) {
      throw new Error('Direcci√≥n de email inv√°lida');
    }

    // Esperar hasta que SERVICES_CONFIG est√© disponible
    let attempts = 0;
    const maxAttempts = 20; // 2 segundos m√°ximo
    
    while (typeof window.SERVICES_CONFIG === 'undefined' && attempts < maxAttempts) {
      console.log(`‚è≥ Esperando SERVICES_CONFIG en setupEmail... Intento ${attempts + 1}/${maxAttempts}`);
      await new Promise(resolve => setTimeout(resolve, 100));
      attempts++;
    }

    // Verificar configuraci√≥n
    if (typeof window.SERVICES_CONFIG === 'undefined') {
      throw new Error('Configuraci√≥n de servicios no encontrada. Revisa el archivo config/services.js');
    }

    const emailConfig = window.SERVICES_CONFIG.emailJS;
    
    // Verificar que todas las claves est√©n configuradas
    if (!emailConfig.publicKey || !emailConfig.serviceId || !emailConfig.templateId) {
      throw new Error('Configuraci√≥n de EmailJS incompleta. Verifica que tengas configurado publicKey, serviceId y templateId en config/services.js');
    }

    // Verificar que EmailJS est√© disponible
    if (typeof emailjs === 'undefined') {
      throw new Error('EmailJS no est√° disponible. Verifica que est√© incluido en el HTML');
    }

    // Verificar si estamos ejecutando desde archivo local
    if (window.location.protocol === 'file:') {
      console.warn('‚ö†Ô∏è EmailJS puede no funcionar desde archivos locales debido a CORS. Se recomienda usar un servidor local.');
    }

    this.config.email = {
      enabled: true,
      address: address,
      daysAhead: parseInt(daysAhead) || 3,
      serviceId: emailConfig.serviceId,
      templateId: emailConfig.templateId,
      publicKey: emailConfig.publicKey
    };

    this.saveConfig();
    return true;
  }

  // Validar email
  validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // Generar recordatorios para todos los productos
  generateReminders(products) {
    this.reminders = [];
    
    products.forEach(product => {
      const startDate = new Date(product.startDate);
      
      for (let i = 0; i < product.installments; i++) {
        const paymentDate = new Date(startDate.getFullYear(), startDate.getMonth() + i, 1);
        
        // Crear recordatorios solo para Email
        if (this.config.email.enabled) {
          const reminderDate = new Date(paymentDate);
          reminderDate.setDate(reminderDate.getDate() - this.config.email.daysAhead);
          
          this.reminders.push({
            type: 'email',
            product: product.name,
            paymentDate: paymentDate,
            reminderDate: reminderDate,
            amount: product.monthlyPayment,
            installment: i + 1,
            totalInstallments: product.installments
          });
        }
      }
    });

    // Ordenar por fecha de recordatorio
    this.reminders.sort((a, b) => a.reminderDate - b.reminderDate);
    
    // Verificar inmediatamente si hay recordatorios pendientes
    setTimeout(() => {
      this.checkPendingReminders();
    }, 1000);
    
    this.updateUI();
    
    console.log(`üìÖ Se generaron ${this.reminders.length} recordatorios`);
  }

  // Forzar verificaci√≥n manual de recordatorios
  async forceCheckReminders() {
    console.log('üîÑ Verificando recordatorios manualmente...');
    await this.checkPendingReminders();
  }

  // Iniciar el programador de recordatorios
  startReminderScheduler() {
    try {
      console.log('üïê Iniciando programador de recordatorios...');
      
      // Limpiar intervalo anterior si existe
      if (this.checkInterval) {
        clearInterval(this.checkInterval);
      }
      
      // Verificar recordatorios cada hora
      this.checkInterval = setInterval(() => {
        try {
          this.checkPendingReminders();
        } catch (error) {
          console.error('‚ùå Error en verificaci√≥n autom√°tica:', error);
        }
      }, 60 * 60 * 1000); // 1 hora
      
      // Verificaci√≥n inicial despu√©s de 5 segundos (dar tiempo a que cargue todo)
      setTimeout(() => {
        try {
          this.checkPendingReminders();
        } catch (error) {
          console.error('‚ùå Error en verificaci√≥n inicial:', error);
        }
      }, 5000);
      
      console.log('‚úÖ Programador de recordatorios iniciado');
    } catch (error) {
      console.error('‚ùå Error iniciando programador de recordatorios:', error);
    }
  }

  // Detener el programador de recordatorios
  stopReminderScheduler() {
    if (this.checkInterval) {
      clearInterval(this.checkInterval);
      this.checkInterval = null;
      console.log('üõë Programador de recordatorios detenido');
    }
  }

  // Verificar recordatorios pendientes
  async checkPendingReminders() {
    if (this.reminders.length === 0) {
      console.log('üì≠ No hay recordatorios para verificar');
      return;
    }

    const today = new Date();
    const todayStr = today.toDateString();
    
    console.log(`üîç Verificando ${this.reminders.length} recordatorios para ${todayStr}...`);
    
    let pendingReminders = 0;
    
    for (const reminder of this.reminders) {
      const reminderDate = new Date(reminder.reminderDate);
      const reminderStr = reminderDate.toDateString();
      
      // Si es hoy y no se ha enviado ya
      if (reminderStr === todayStr && !this.sentReminders.has(reminder.id)) {
        console.log(`üìÖ Recordatorio pendiente para: ${reminder.product}`);
        
        // Solo enviar email por ahora
        if (reminder.type === 'email' && this.config.email.enabled) {
          try {
            await this.sendEmailReminder(reminder);
            this.sentReminders.add(reminder.id);
            this.saveSentReminders();
            console.log(`‚úÖ Email enviado para: ${reminder.product}`);
          } catch (error) {
            console.error(`‚ùå Error enviando email para ${reminder.product}:`, error);
          }
        }
        
        pendingReminders++;
      }
    }
    
    if (pendingReminders === 0) {
      console.log('‚úÖ No hay recordatorios pendientes para hoy');
    } else {
      console.log(`üì§ Se procesaron ${pendingReminders} recordatorios pendientes`);
    }
  }

  // Enviar recordatorio por WhatsApp
  async sendWhatsAppReminder(reminder) {
    const message = encodeURIComponent(
      `üîî *Recordatorio de Pago*\n\n` +
      `üì¶ Producto: ${reminder.product}\n` +
      `üí∞ Monto: $${Math.round(reminder.amount).toLocaleString('es-ES')}\n` +
      `üìÖ Fecha de pago: ${reminder.paymentDate.toLocaleDateString('es-ES')}\n` +
      `üìä Cuota: ${reminder.installment}/${reminder.totalInstallments}\n\n` +
      `¬°No olvides hacer tu pago! üí™`
    );

    const whatsappUrl = `https://wa.me/${this.config.whatsapp.number.replace('+', '')}?text=${message}`;
    
    // Mostrar notificaci√≥n al usuario
    this.showReminderNotification('WhatsApp', reminder);
    
    // Abrir WhatsApp (el usuario debe hacer clic para enviar)
    window.open(whatsappUrl, '_blank');
  }

  // Mostrar notificaci√≥n de recordatorio
  showReminderNotification(type, reminder) {
    // Crear notificaci√≥n visual
    const notification = document.createElement('div');
    notification.className = 'reminder-notification';
    notification.innerHTML = `
      <div class="notification-content">
        <div class="notification-icon">üîî</div>
        <div class="notification-text">
          <strong>Recordatorio ${type}</strong><br>
          ${reminder.product} - $${Math.round(reminder.amount).toLocaleString('es-ES')}<br>
          <small>Fecha de pago: ${reminder.paymentDate.toLocaleDateString('es-ES')}</small>
        </div>
        <button onclick="this.parentElement.parentElement.remove()" class="notification-close">√ó</button>
      </div>
    `;

    // Agregar estilos si no existen
    if (!document.getElementById('reminder-notification-styles')) {
      const styles = document.createElement('style');
      styles.id = 'reminder-notification-styles';
      styles.textContent = `
        .reminder-notification {
          position: fixed;
          top: 20px;
          right: 20px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 15px;
          border-radius: 10px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.3);
          z-index: 10000;
          max-width: 350px;
          animation: slideIn 0.3s ease-out;
        }
        .notification-content {
          display: flex;
          align-items: center;
          gap: 10px;
        }
        .notification-icon {
          font-size: 24px;
        }
        .notification-text {
          flex: 1;
          font-size: 14px;
        }
        .notification-close {
          background: rgba(255,255,255,0.2);
          border: none;
          color: white;
          width: 25px;
          height: 25px;
          border-radius: 50%;
          cursor: pointer;
          font-size: 16px;
        }
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(styles);
    }

    document.body.appendChild(notification);

    // Auto-remover despu√©s de 8 segundos
    setTimeout(() => {
      if (notification.parentElement) {
        notification.remove();
      }
    }, 8000);
  }

  // Enviar recordatorio por email
  async sendEmailReminder(reminder) {
    if (typeof emailjs === 'undefined') {
      throw new Error('EmailJS no est√° disponible');
    }

    // Verificar configuraci√≥n
    if (!this.config.email.serviceId || !this.config.email.templateId) {
      throw new Error('Configuraci√≥n de email incompleta');
    }

    // Si estamos en archivo local, mostrar advertencia pero intentar enviar
    if (window.location.protocol === 'file:') {
      console.warn('‚ö†Ô∏è Intentando enviar email desde archivo local - puede fallar por CORS');
    }

    // Obtener todas las cuotas del producto
    const productInstallments = this.getProductInstallments(reminder.product);
    
    // Generar lista detallada de cuotas
    const installmentsList = this.generateInstallmentsList(productInstallments, reminder);
    
    // Calcular totales
    const totalPending = productInstallments.filter(inst => inst.isPending).length;
    const totalPaid = productInstallments.length - totalPending;
    const totalAmount = productInstallments.reduce((sum, inst) => sum + inst.amount, 0);
    const pendingAmount = productInstallments.filter(inst => inst.isPending).reduce((sum, inst) => sum + inst.amount, 0);

    const templateParams = {
      to_email: this.config.email.address,
      to: this.config.email.address,
      user_email: this.config.email.address,
      recipient_email: this.config.email.address,
      user_name: this.config.email.address.split('@')[0], // Usar la parte antes del @ como nombre
      to_name: this.config.email.address.split('@')[0],
      from_name: 'Calculadora de Cuotas',
      reply_to: this.config.email.address,
      product_name: reminder.product,
      payment_amount: Math.round(reminder.amount).toLocaleString('es-ES'),
      payment_date: reminder.paymentDate.toLocaleDateString('es-ES', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      }),
      installment_current: reminder.installment,
      installment_total: reminder.totalInstallments,
      days_ahead: this.config.email.daysAhead,
      
      // Informaci√≥n detallada adicional
      installments_list: installmentsList,
      total_installments: productInstallments.length,
      paid_installments: totalPaid,
      pending_installments: totalPending,
      total_amount: Math.round(totalAmount).toLocaleString('es-ES'),
      pending_amount: Math.round(pendingAmount).toLocaleString('es-ES'),
      
      // Fecha de generaci√≥n del correo
      email_date: new Date().toLocaleDateString('es-ES', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      })
    };

    try {
      // Verificar que EmailJS est√© disponible
      if (typeof emailjs === 'undefined') {
        throw new Error('EmailJS no est√° disponible. Verifica que la librer√≠a est√© cargada.');
      }

      // Verificar configuraci√≥n b√°sica
      if (!this.config.email.serviceId || !this.config.email.templateId) {
        throw new Error('Configuraci√≥n de email incompleta. Verifica serviceId y templateId en services.js');
      }

      // Verificar que EmailJS est√© inicializado
      if (!window.SERVICES_CONFIG || !window.SERVICES_CONFIG.emailJS) {
        throw new Error('Configuraci√≥n de servicios no disponible');
      }

      // Verificar si EmailJS est√° habilitado en la configuraci√≥n
      if (window.SERVICES_CONFIG.emailJS.enabled === false) {
        throw new Error('EmailJS est√° deshabilitado en la configuraci√≥n. Configura tu Template ID y habil√≠talo en services.js');
      }

      // Verificar Template ID espec√≠ficamente
      if (this.config.email.templateId.includes('EJEMPLO') || this.config.email.templateId === 'template_EJEMPLO') {
        throw new Error('Debes configurar un Template ID real en services.js. Visita https://dashboard.emailjs.com/admin/templates para crear uno.');
      }

      // Inicializar EmailJS si no est√° hecho
      if (!emailjs.publicKey) {
        console.log('üîß Inicializando EmailJS...');
        emailjs.init(window.SERVICES_CONFIG.emailJS.publicKey);
      }

      console.log('üìß Enviando email con configuraci√≥n:', {
        serviceId: this.config.email.serviceId,
        templateId: this.config.email.templateId,
        to_email: templateParams.to_email
      });

      const response = await emailjs.send(
        this.config.email.serviceId,
        this.config.email.templateId,
        templateParams
      );
      
      console.log('‚úÖ Email enviado correctamente:', response);
      console.log('üìß Contenido del email:', templateParams);
      
      // Mostrar notificaci√≥n de √©xito
      this.showReminderNotification('Email', reminder);
      
      return true;
    } catch (error) {
      console.error('‚ùå Error detallado enviando email:', error);
      console.error('‚ùå Stack trace:', error.stack);
      
      // Mejorar mensajes de error espec√≠ficos
      let errorMessage = 'Error desconocido';
      
      if (error.text) {
        errorMessage = error.text;
      } else if (error.message) {
        errorMessage = error.message;
      }
      
      // Errores espec√≠ficos de EmailJS
      if (error.status) {
        switch(error.status) {
          case 400:
            if (error.text && error.text.includes('template ID not found')) {
              errorMessage = 'Template ID no encontrado en EmailJS. Debes configurar un Template ID real en services.js';
            } else if (error.text && error.text.includes('service ID not found')) {
              errorMessage = 'Service ID no encontrado en EmailJS. Verifica tu Service ID en services.js';
            } else {
              errorMessage = 'Error 400: Datos inv√°lidos. Verifica tu configuraci√≥n de EmailJS en services.js';
            }
            break;
          case 402:
            errorMessage = 'Error 402: L√≠mite de emails alcanzado en tu cuenta EmailJS';
            break;
          case 403:
            errorMessage = 'Error 403: Acceso denegado. Verifica tu Public Key en services.js';
            break;
          case 404:
            errorMessage = 'Error 404: Servicio o plantilla no encontrados. Verifica los IDs en services.js';
            break;
          case 422:
            errorMessage = 'Error 422: Plantilla mal configurada. Revisa las variables en tu plantilla de EmailJS';
            break;
          default:
            errorMessage = `Error ${error.status}: ${error.text || 'Error del servidor EmailJS'}`;
        }
      }
      
      // Agregar instrucciones espec√≠ficas para configurar EmailJS
      if (errorMessage.includes('template ID not found') || errorMessage.includes('Template ID')) {
        errorMessage += '\n\nüìã PASOS PARA SOLUCIONARLO:\n';
        errorMessage += '1. Ve a https://dashboard.emailjs.com/admin/templates\n';
        errorMessage += '2. Crea una nueva plantilla de email\n';
        errorMessage += '3. Copia el Template ID (ej: template_abc123)\n';
        errorMessage += '4. Edita src/config/services.js\n';
        errorMessage += '5. Reemplaza "template_EJEMPLO" por tu Template ID real\n';
        errorMessage += '6. Cambia enabled: true en services.js\n';
        errorMessage += '7. Guarda y recarga la p√°gina';
      }
      
      // Si es error de CORS, sugerir alternativa
      if (errorMessage.includes('CORS') || errorMessage.includes('cors')) {
        errorMessage = 'Error de CORS: Para usar email, ejecuta la aplicaci√≥n desde un servidor web (no archivo local)';
      }
      
      throw new Error(errorMessage);
    }
  }

  // M√©todo para probar el env√≠o de email con datos de muestra
  async testEmailSending() {
    // Esperar un poco para que se cargue la configuraci√≥n si es necesario
    await new Promise(resolve => setTimeout(resolve, 100));
    
    // Verificar configuraci√≥n antes de intentar enviar
    if (!window.SERVICES_CONFIG) {
      console.error('‚ùå SERVICES_CONFIG no disponible, intentando cargar...');
      
      // Intentar cargar la configuraci√≥n manualmente
      try {
        // Verificar si existe globalmente
        if (typeof SERVICES_CONFIG !== 'undefined') {
          window.SERVICES_CONFIG = SERVICES_CONFIG;
          console.log('‚úÖ Configuraci√≥n cargada desde variable global');
        } else {
          throw new Error('Configuraci√≥n de EmailJS no encontrada. Verifica que services.js est√© cargado correctamente.');
        }
      } catch (error) {
        throw new Error('Configuraci√≥n de EmailJS no encontrada. Verifica que services.js est√© cargado correctamente.');
      }
    }

    if (!window.SERVICES_CONFIG.emailJS) {
      throw new Error('Configuraci√≥n de EmailJS no encontrada en services.js');
    }

    if (window.SERVICES_CONFIG.emailJS.enabled === false) {
      throw new Error('EmailJS est√° deshabilitado. Para habilitar:\n1. Configura tu Template ID en services.js\n2. Cambia enabled: true');
    }

    if (window.SERVICES_CONFIG.emailJS.templateId.includes('EJEMPLO')) {
      throw new Error('Debes configurar un Template ID real:\n1. Ve a https://dashboard.emailjs.com/admin/templates\n2. Crea una plantilla\n3. Actualiza templateId en services.js\n4. Cambia enabled: true');
    }

    if (!this.config.email.enabled || !this.config.email.address) {
      throw new Error('Email no configurado. Primero configura tu email en la secci√≥n de recordatorios.');
    }
    
    console.log('üß™ Probando env√≠o de email...');
    
    // Crear datos de prueba
    const testReminder = {
      product: 'Producto de Prueba',
      amount: 150000,
      paymentDate: new Date(),
      installment: 3,
      totalInstallments: 12,
      id: 'test-' + Date.now(),
      type: 'email'
    };
    
    try {
      const result = await this.sendEmailReminder(testReminder);
      console.log('‚úÖ Email de prueba enviado exitosamente');
      
      if (window.app && typeof window.app.showNotification === 'function') {
        window.app.showNotification(
          'success', 
          'Email de prueba enviado', 
          `Se envi√≥ un email de prueba a ${this.config.email.address}`
        );
      }
      
      return result;
    } catch (error) {
      console.error('‚ùå Error enviando email de prueba:', error);
      
      if (window.app && typeof window.app.showNotification === 'function') {
        window.app.showNotification(
          'error', 
          'Error en email de prueba', 
          error.message
        );
      }
      
      throw error;
    }
  }

  // Obtener pr√≥ximos recordatorios
  getUpcomingReminders(limit = 5) {
    const now = new Date();
    return this.reminders
      .filter(r => r.reminderDate >= now)
      .slice(0, limit);
  }

  // Eliminar recordatorio individual
  deleteReminder(index) {
    const upcoming = this.getUpcomingReminders();
    if (index >= 0 && index < upcoming.length) {
      const reminderToDelete = upcoming[index];
      
      // Encontrar el √≠ndice en el array completo de recordatorios
      const fullIndex = this.reminders.findIndex(r => 
        r.product === reminderToDelete.product &&
        r.installment === reminderToDelete.installment &&
        r.type === reminderToDelete.type &&
        r.reminderDate.getTime() === reminderToDelete.reminderDate.getTime()
      );
      
      if (fullIndex !== -1) {
        this.reminders.splice(fullIndex, 1);
        this.updateUI();
        
        // Mostrar notificaci√≥n usando el sistema de la app principal
        if (window.app && typeof window.app.showNotification === 'function') {
          window.app.showNotification(
            'warning', 
            'Recordatorio eliminado', 
            `Se elimin√≥ el recordatorio de "${reminderToDelete.product}" para el ${reminderToDelete.reminderDate.toLocaleDateString('es-ES')}`
          );
        }
        
        return true;
      }
    }
    return false;
  }

  // Eliminar todos los recordatorios
  deleteAllReminders() {
    const count = this.reminders.length;
    this.reminders = [];
    this.sentReminders.clear();
    this.saveSentReminders();
    this.updateUI();
    
    // Mostrar notificaci√≥n usando el sistema de la app principal
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification(
        'warning', 
        'Recordatorios eliminados', 
        `Se eliminaron ${count} recordatorios correctamente`
      );
    }
  }

  // Limpiar recordatorios de un producto espec√≠fico
  clearProductReminders(productName) {
    this.reminders = this.reminders.filter(r => r.product !== productName);
    this.updateUI();
  }

  // Actualizar la interfaz de usuario con los recordatorios
  updateUI() {
    const nextRemindersDiv = document.getElementById('nextReminders');
    if (!nextRemindersDiv) return;

    const upcoming = this.getUpcomingReminders();
    
    if (upcoming.length === 0) {
      nextRemindersDiv.innerHTML = '<p>No hay recordatorios programados</p>';
      return;
    }

    const remindersHTML = upcoming.map((reminder, index) => {
      const typeIcon = '';
      const typeName = 'Email';
      
      return `
        <div class="reminder-item">
          <div class="reminder-info">
            <span class="reminder-type">${typeIcon} ${typeName}</span>
            <span class="reminder-product">${reminder.product}</span>
            <span class="reminder-amount">$${Math.round(reminder.amount).toLocaleString('es-ES')}</span>
            <span class="reminder-date">${reminder.reminderDate.toLocaleDateString('es-ES')}</span>
          </div>
          <button class="delete-reminder-btn" onclick="deleteIndividualReminder(${index})" title="Eliminar recordatorio">
            ‚úï
          </button>
        </div>
      `;
    }).join('');

    nextRemindersDiv.innerHTML = remindersHTML;

    // Mostrar/ocultar controles seg√∫n haya recordatorios o productos
    const remindersControls = document.getElementById('remindersControls');
    if (remindersControls) {
      // Verificar si hay productos registrados para mostrar el bot√≥n de reporte
      const products = JSON.parse(localStorage.getItem('calculadora-productos') || '[]');
      const hasProducts = products.length > 0;
      const hasReminders = upcoming.length > 0;
      
      // Mostrar controles si hay productos (para reporte) o recordatorios (para gesti√≥n)
      remindersControls.style.display = (hasProducts || hasReminders) ? 'block' : 'none';
      
      // Mostrar/ocultar bot√≥n de eliminar seg√∫n haya recordatorios
      const deleteBtn = remindersControls.querySelector('.delete-all-btn');
      if (deleteBtn) {
        deleteBtn.style.display = hasReminders ? 'inline-block' : 'none';
      }
    }

    // Actualizar estados de configuraci√≥n
    this.updateStatusIndicators();
  }

  // Actualizar indicadores de estado
  updateStatusIndicators() {
    const emailStatus = document.getElementById('emailStatus');

    if (emailStatus) {
      emailStatus.textContent = this.config.email.enabled ? 
        `Configurado (${this.config.email.address})` : 'No configurado';
    }
  }

  // Cargar productos existentes al inicializar
  loadExistingProducts() {
    try {
      const products = JSON.parse(localStorage.getItem('products') || '[]');
      if (products.length > 0) {
        this.generateReminders(products);
        console.log(`üìÖ Cargados ${products.length} productos existentes para recordatorios`);
      }
    } catch (error) {
      console.warn('‚ö†Ô∏è Error cargando productos existentes:', error);
    }
  }

  // Obtener todas las cuotas de un producto espec√≠fico
  getProductInstallments(productName) {
    // Buscar el producto en los datos almacenados
    const products = JSON.parse(localStorage.getItem('calculadora-productos') || '[]');
    const product = products.find(p => p.name === productName);
    
    if (!product) {
      return [];
    }
    
    const installments = [];
    const startDate = new Date(product.startDate);
    const today = new Date();
    
    for (let i = 0; i < product.installments; i++) {
      const paymentDate = new Date(startDate.getFullYear(), startDate.getMonth() + i, startDate.getDate());
      const isPending = paymentDate >= today;
      const isToday = paymentDate.toDateString() === today.toDateString();
      const isOverdue = paymentDate < today && !isToday;
      
      installments.push({
        number: i + 1,
        amount: product.monthlyPayment,
        paymentDate: paymentDate,
        isPending: isPending,
        isToday: isToday,
        isOverdue: isOverdue,
        status: isOverdue ? 'vencida' : isPending ? 'pendiente' : 'pagada'
      });
    }
    
    return installments;
  }

  // Generar lista formateada de cuotas para el email
  generateInstallmentsList(installments, currentReminder) {
    if (installments.length === 0) {
      return 'No se encontraron cuotas para este producto.';
    }
    
    let list = '';
    
    // Agregar cuotas vencidas primero (si las hay)
    const overdueInstallments = installments.filter(inst => inst.isOverdue);
    if (overdueInstallments.length > 0) {
      list += 'üö® CUOTAS VENCIDAS:\n';
      overdueInstallments.forEach(inst => {
        list += `   ‚Ä¢ Cuota ${inst.number}: $${Math.round(inst.amount).toLocaleString('es-ES')} - Fecha: ${inst.paymentDate.toLocaleDateString('es-ES')} ‚ö†Ô∏è\n`;
      });
      list += '\n';
    }
    
    // Agregar cuota actual (la del recordatorio)
    const todayInstallments = installments.filter(inst => inst.isToday);
    if (todayInstallments.length > 0) {
      list += 'üìÖ CUOTA DE HOY:\n';
      todayInstallments.forEach(inst => {
        list += `   ‚Ä¢ Cuota ${inst.number}: $${Math.round(inst.amount).toLocaleString('es-ES')} - HOY ${inst.paymentDate.toLocaleDateString('es-ES')} üîî\n`;
      });
      list += '\n';
    }
    
    // Agregar pr√≥ximas cuotas pendientes
    const futureInstallments = installments.filter(inst => inst.isPending && !inst.isToday);
    if (futureInstallments.length > 0) {
      list += 'üìã PR√ìXIMAS CUOTAS:\n';
      futureInstallments.slice(0, 5).forEach(inst => { // Mostrar m√°ximo 5 pr√≥ximas
        list += `   ‚Ä¢ Cuota ${inst.number}: $${Math.round(inst.amount).toLocaleString('es-ES')} - ${inst.paymentDate.toLocaleDateString('es-ES')}\n`;
      });
      
      if (futureInstallments.length > 5) {
        list += `   ... y ${futureInstallments.length - 5} cuotas m√°s\n`;
      }
      list += '\n';
    }
    
    // Agregar resumen
    const totalPending = installments.filter(inst => inst.isPending).length;
    const totalPaid = installments.length - totalPending;
    const pendingAmount = installments.filter(inst => inst.isPending).reduce((sum, inst) => sum + inst.amount, 0);
    
    list += 'üìä RESUMEN:\n';
    list += `   ‚Ä¢ Cuotas pagadas: ${totalPaid}/${installments.length}\n`;
    list += `   ‚Ä¢ Cuotas pendientes: ${totalPending}/${installments.length}\n`;
    list += `   ‚Ä¢ Monto pendiente total: $${Math.round(pendingAmount).toLocaleString('es-ES')}\n`;
    
    return list;
  }

  // Enviar reporte completo por email
  async sendFullReportEmail() {
    if (!this.config.email.enabled || !this.config.email.address) {
      throw new Error('Email no configurado. Primero configura tu email en la secci√≥n de recordatorios.');
    }
    
    console.log('üìä Generando reporte completo por email...');
    
    // Obtener todos los productos
    const products = JSON.parse(localStorage.getItem('calculadora-productos') || '[]');
    
    if (products.length === 0) {
      throw new Error('No hay productos registrados para incluir en el reporte.');
    }
    
    // Generar estad√≠sticas generales mejoradas
    const totalProducts = products.length;
    const totalValue = products.reduce((sum, p) => sum + p.totalValue, 0);
    const totalMonthlyPayments = products.reduce((sum, p) => sum + p.monthlyPayment, 0);
    const averageProductValue = totalValue / totalProducts;
    
    // Determinar email del usuario antes de todo
    let userEmail = null;
    let clienteNombre = 'Usuario';
    
    if (this.config.email.enabled && this.config.email.address) {
      userEmail = this.config.email.address;
      clienteNombre = userEmail.split('@')[0];
      console.log('‚úÖ Email configurado en recordatorios:', userEmail);
    } else {
      // Solicitar email al usuario si no est√° configurado
      userEmail = prompt('üìß Ingresa tu email para recibir el reporte:');
      if (!userEmail) {
        throw new Error('Email requerido para enviar el reporte.');
      }
      clienteNombre = userEmail.split('@')[0];
      console.log('‚úÖ Email ingresado por el usuario:', userEmail);
    }
    
    // Generar reporte detallado mejorado por producto
    const resumenDetallado = products.map((product, index) => {
      const startDate = new Date(product.startDate);
      const endDate = new Date(product.endDate);
      const today = new Date();
      
      // Calcular progreso
      const totalDuration = endDate.getTime() - startDate.getTime();
      const elapsed = today.getTime() - startDate.getTime();
      const progress = Math.max(0, Math.min(100, (elapsed / totalDuration) * 100));
      
      // Calcular cuotas pagadas/pendientes
      const monthsElapsed = Math.max(0, Math.floor((today - startDate) / (30.44 * 24 * 60 * 60 * 1000)));
      const installmentsPaid = Math.min(monthsElapsed, product.installments);
      const installmentsPending = product.installments - installmentsPaid;
      
      // Generar emoji basado en el tipo de producto
      let emoji = 'üì¶';
      const name = product.name.toLowerCase();
      if (name.includes('laptop') || name.includes('computador') || name.includes('pc')) emoji = 'üíª';
      else if (name.includes('celular') || name.includes('phone') || name.includes('m√≥vil')) emoji = 'üì±';
      else if (name.includes('carro') || name.includes('auto') || name.includes('veh√≠culo')) emoji = 'üöó';
      else if (name.includes('casa') || name.includes('apartamento') || name.includes('vivienda')) emoji = 'üè†';
      else if (name.includes('moto') || name.includes('bicicleta')) emoji = 'üèçÔ∏è';
      
      return `${emoji} ${product.name}
   üí∞ Valor Total: $${product.totalValue.toLocaleString('es-CO')}
   üìÖ ${product.installments} cuotas de $${product.monthlyPayment.toLocaleString('es-CO')} c/u
   üìä Progreso: ${Math.round(progress)}% completado
   ‚úÖ Cuotas pagadas: ${installmentsPaid}/${product.installments}
   ‚è≥ Cuotas pendientes: ${installmentsPending}
   üóìÔ∏è Inicio: ${startDate.toLocaleDateString('es-CO')}
   üèÅ Finalizaci√≥n: ${endDate.toLocaleDateString('es-CO')}
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`;
    }).join('\n');
    
    // Calcular pr√≥ximos pagos
    const nextPayments = this.getNextThreePayments(products);
    const proximosPagos = nextPayments.length > 0 ? 
      nextPayments.map(payment => 
        `üîî ${payment.date.toLocaleDateString('es-CO')} - ${payment.product} - $${payment.amount.toLocaleString('es-CO')}`
      ).join('\n') : 
      'No hay pagos pr√≥ximos programados';
    
    // Preparar datos para el email con formato mejorado
    const templateParams = {
      to_email: userEmail,
      cliente_nombre: clienteNombre,
      subject: 'üí∞ Tu Reporte Financiero Personalizado - Calculadora de Cuotas',
      mensaje_principal: `¬°Hola ${clienteNombre}! üëã

Aqu√≠ tienes tu reporte financiero completo con todos los detalles de tus productos y cuotas. Mant√©n el control de tus finanzas de manera inteligente.`,
      
      productos_detalle: resumenDetallado,
      
      estadisticas_resumen: `üìä RESUMEN FINANCIERO:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíº Total de productos: ${totalProducts}
üíé Valor total invertido: $${totalValue.toLocaleString('es-CO')}
üí≥ Pago mensual total: $${totalMonthlyPayments.toLocaleString('es-CO')}
üìà Promedio por producto: $${Math.round(averageProductValue).toLocaleString('es-CO')}
üîî Pr√≥ximos pagos:
${proximosPagos}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`,
      
      consejos_financieros: `üí° CONSEJOS FINANCIEROS PERSONALIZADOS:
‚Ä¢ Programa recordatorios 3 d√≠as antes de cada pago para estar preparado
‚Ä¢ Mant√©n un fondo de emergencia del 20% del pago mensual total
‚Ä¢ Revisa tu progreso mensualmente para ajustar tu presupuesto
‚Ä¢ Considera pagos adelantados cuando tengas ingresos extra
‚Ä¢ Aprovecha los descuentos por pronto pago si est√°n disponibles
‚Ä¢ Mant√©n un registro de todos tus gastos para mejor control financiero`,
      
      mensaje_despedida: `¬°Gracias por confiar en nuestra Calculadora de Cuotas! üôè

Esperamos que esta informaci√≥n te ayude a mantener un mejor control de tus finanzas personales. Recuerda que la planificaci√≥n financiera es clave para alcanzar tus metas.

Si tienes alguna pregunta o sugerencia, no dudes en contactarnos. Estamos aqu√≠ para ayudarte en tu camino hacia la estabilidad financiera.

¬°Que tengas un excelente d√≠a y que logres todas tus metas! ‚ú®`,
      
      from_name: 'üí∞ Calculadora de Cuotas - Tu Asistente Financiero Personal',
      fecha_reporte: new Date().toLocaleDateString('es-CO', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      }),
      
      // Variables adicionales para personalizaci√≥n
      total_productos: totalProducts,
      valor_total: totalValue.toLocaleString('es-CO'),
      pago_mensual_total: totalMonthlyPayments.toLocaleString('es-CO')
    };
    
    try {
      // Verificar que EmailJS est√© disponible y configurado
      if (typeof emailjs === 'undefined') {
        throw new Error('EmailJS no est√° disponible. Verifica que la librer√≠a est√© cargada.');
      }

      // Verificar configuraci√≥n de servicios
      if (!window.SERVICES_CONFIG || !window.SERVICES_CONFIG.emailJS) {
        throw new Error('Configuraci√≥n de servicios no disponible. Verifica que services.js est√© cargado.');
      }

      const emailConfig = window.SERVICES_CONFIG.emailJS;

      // Verificar que la configuraci√≥n est√© completa
      if (!emailConfig.publicKey || !emailConfig.serviceId || !emailConfig.templateId) {
        throw new Error('Configuraci√≥n de EmailJS incompleta. Verifica publicKey, serviceId y templateId en services.js');
      }

      // Verificar si EmailJS est√° habilitado
      if (emailConfig.enabled === false) {
        throw new Error('EmailJS est√° deshabilitado en la configuraci√≥n. Configura tu Template ID y habil√≠talo en services.js');
      }

      // Verificar Template ID espec√≠ficamente - usar el template correcto
      console.log('üîç Usando Template ID:', emailConfig.templateId);

      // Inicializar EmailJS si no est√° inicializado
      console.log('üîß Verificando inicializaci√≥n de EmailJS...');
      try {
        emailjs.init(emailConfig.publicKey);
        console.log('‚úÖ EmailJS inicializado con Public Key:', emailConfig.publicKey.substring(0, 8) + '...');
      } catch (initError) {
        console.error('‚ùå Error inicializando EmailJS:', initError);
        throw new Error('Error inicializando EmailJS: ' + initError.message);
      }

      console.log('üìß Enviando reporte mejorado con configuraci√≥n:', {
        serviceId: emailConfig.serviceId,
        templateId: emailConfig.templateId,
        to_email: userEmail
      });

      const response = await emailjs.send(
        emailConfig.serviceId,
        emailConfig.templateId,
        templateParams
      );
      
      console.log('‚úÖ Reporte mejorado enviado correctamente:', response);
      console.log('üìß Contenido del reporte mejorado:', templateParams);
      
      return true;
    } catch (error) {
      console.error('‚ùå Error enviando reporte completo:', error);
      
      // Mejorar mensajes de error espec√≠ficos
      let errorMessage = 'Error desconocido';
      
      if (error.text) {
        errorMessage = error.text;
      } else if (error.message) {
        errorMessage = error.message;
      }
      
      // Errores espec√≠ficos de EmailJS
      if (error.status) {
        switch(error.status) {
          case 400:
            if (error.text && error.text.includes('template ID not found')) {
              errorMessage = 'Template ID no encontrado en EmailJS. Debes configurar un Template ID real en services.js';
            } else if (error.text && error.text.includes('service ID not found')) {
              errorMessage = 'Service ID no encontrado en EmailJS. Verifica tu Service ID en services.js';
            } else {
              errorMessage = 'Error 400: Datos inv√°lidos. Verifica tu configuraci√≥n de EmailJS en services.js';
            }
            break;
          case 402:
            errorMessage = 'Error 402: L√≠mite de emails alcanzado en tu cuenta EmailJS';
            break;
          case 403:
            errorMessage = 'Error 403: Acceso denegado. Verifica tu Public Key en services.js';
            break;
          case 404:
            errorMessage = 'Error 404: Servicio o plantilla no encontrados. Verifica los IDs en services.js';
            break;
          case 422:
            errorMessage = 'Error 422: Plantilla mal configurada. Revisa las variables en tu plantilla de EmailJS';
            break;
          default:
            errorMessage = `Error ${error.status}: ${error.text || 'Error del servidor EmailJS'}`;
        }
      }
      
      // Agregar instrucciones espec√≠ficas para configurar EmailJS
      if (errorMessage.includes('template ID not found') || errorMessage.includes('Template ID')) {
        errorMessage += '\n\nüìã PASOS PARA SOLUCIONARLO:\n';
        errorMessage += '1. Ve a https://dashboard.emailjs.com/admin/templates\n';
        errorMessage += '2. Crea una nueva plantilla de email\n';
        errorMessage += '3. Copia el Template ID (ej: template_abc123)\n';
        errorMessage += '4. Edita src/config/services.js\n';
        errorMessage += '5. Reemplaza "template_EJEMPLO" por tu Template ID real\n';
        errorMessage += '6. Cambia enabled: true en services.js\n';
        errorMessage += '7. Guarda y recarga la p√°gina';
      }
      
      throw new Error(errorMessage);
    }
  }

  // Obtener pr√≥ximos tres pagos (funci√≥n auxiliar para reporte por email)
  getNextThreePayments(products) {
    const today = new Date();
    const upcomingPayments = [];
    
    products.forEach(product => {
      const startDate = new Date(product.startDate);
      
      for (let i = 0; i < product.installments; i++) {
        const paymentDate = new Date(startDate.getFullYear(), startDate.getMonth() + i, startDate.getDate());
        
        if (paymentDate >= today) {
          upcomingPayments.push({
            date: paymentDate,
            product: product.name,
            amount: product.monthlyPayment,
            installmentNumber: i + 1,
            totalInstallments: product.installments
          });
        }
      }
    });
    
    // Ordenar por fecha y tomar los primeros 3
    upcomingPayments.sort((a, b) => a.date.getTime() - b.date.getTime());
    return upcomingPayments.slice(0, 3);
  }
}

// === EXPORTACI√ìN Y DISPONIBILIDAD GLOBAL ===

// Hacer disponible globalmente
window.RemindersManager = RemindersManager;

// === FUNCIONES DE DIAGN√ìSTICO Y PRUEBA ===

// Funci√≥n para diagnosticar el estado de la configuraci√≥n
window.diagnosticarConfiguracion = function() {
  console.log('üîç === DIAGN√ìSTICO DE CONFIGURACI√ìN ===');
  
  // Verificar SERVICES_CONFIG
  console.log('üìã SERVICES_CONFIG disponible:', typeof window.SERVICES_CONFIG !== 'undefined');
  if (typeof window.SERVICES_CONFIG !== 'undefined') {
    console.log('üìß EmailJS config:', {
      enabled: window.SERVICES_CONFIG.emailJS.enabled,
      hasPublicKey: !!window.SERVICES_CONFIG.emailJS.publicKey,
      hasServiceId: !!window.SERVICES_CONFIG.emailJS.serviceId,
      hasTemplateId: !!window.SERVICES_CONFIG.emailJS.templateId,
      publicKey: window.SERVICES_CONFIG.emailJS.publicKey.substring(0, 8) + '...',
      serviceId: window.SERVICES_CONFIG.emailJS.serviceId,
      templateId: window.SERVICES_CONFIG.emailJS.templateId
    });
  }
  
  // Verificar EmailJS
  console.log('üìß EmailJS disponible:', typeof emailjs !== 'undefined');
  
  // Verificar RemindersManager
  console.log('üîî RemindersManager disponible:', typeof window.remindersManager !== 'undefined');
  
  // Verificar funciones globales
  console.log('üß™ Funciones de prueba disponibles:', {
    testEmailJS: typeof window.testEmailJS !== 'undefined',
    testReminderEmail: typeof window.testReminderEmail !== 'undefined',
    sendCompleteReport: typeof window.sendCompleteReport !== 'undefined'
  });
  
  console.log('üîç === FIN DEL DIAGN√ìSTICO ===');
};

// Funci√≥n mejorada para probar EmailJS
window.testEmailJSMejorado = async function() {
  console.log('üß™ === PRUEBA MEJORADA DE EMAILJS ===');
  
  try {
    // Diagnosticar primero
    window.diagnosticarConfiguracion();
    
    // Verificar configuraci√≥n
    if (typeof window.SERVICES_CONFIG === 'undefined') {
      throw new Error('SERVICES_CONFIG no est√° disponible. Verifica que services.js est√© cargado.');
    }
    
    const config = window.SERVICES_CONFIG.emailJS;
    
    if (!config.enabled) {
      throw new Error('EmailJS est√° deshabilitado en la configuraci√≥n (enabled: false). Cambia a enabled: true en services.js');
    }
    
    if (!config.publicKey || !config.serviceId || !config.templateId) {
      throw new Error('Configuraci√≥n de EmailJS incompleta. Verifica publicKey, serviceId y templateId en services.js');
    }
    
    if (config.templateId.includes('EJEMPLO')) {
      throw new Error('Template ID es de ejemplo. Debes configurar un Template ID real desde https://dashboard.emailjs.com/admin/templates');
    }
    
    if (typeof emailjs === 'undefined') {
      throw new Error('EmailJS no est√° disponible. Verifica que la librer√≠a est√© cargada.');
    }
    
    // Solicitar email al usuario
    const email = prompt('üß™ Ingresa tu email para la prueba:');
    if (!email) {
      console.log('‚ùå Prueba cancelada - no se proporcion√≥ email');
      return;
    }
    
    // Inicializar EmailJS
    console.log('ÔøΩ Inicializando EmailJS...');
    emailjs.init(config.publicKey);
    console.log('‚úÖ EmailJS inicializado con Public Key:', config.publicKey.substring(0, 8) + '...');
    
    console.log('ÔøΩüìß Enviando email de prueba a:', email);
    console.log('üîß Configuraci√≥n utilizada:', {
      serviceId: config.serviceId,
      templateId: config.templateId,
      publicKey: config.publicKey.substring(0, 8) + '...'
    });
    
    // Enviar email de prueba
    const result = await emailjs.send(
      config.serviceId,
      config.templateId,
      {
        to_email: email,
        user_name: email.split('@')[0],
        product_name: 'PRUEBA - Producto de Ejemplo',
        payment_date: new Date().toLocaleDateString('es-ES'),
        payment_amount: '1,000',
        installment_current: 1,
        installment_total: 12,
        days_ahead: 3,
        from_name: 'Calculadora de Cuotas - Prueba'
      }
    );
    
    console.log('‚úÖ Email de prueba enviado exitosamente!');
    console.log('üìã Resultado:', result);
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('success', 'Prueba exitosa', 'Email de prueba enviado correctamente a ' + email);
    } else {
      alert('‚úÖ Email de prueba enviado exitosamente a ' + email);
    }
    
  } catch (error) {
    console.error('‚ùå Error en la prueba de EmailJS:', error);
    
    let errorMessage = error.message || 'Error desconocido';
    
    // Mejorar mensajes de error espec√≠ficos
    if (error.status) {
      switch(error.status) {
        case 400:
          if (error.text && error.text.includes('template ID not found')) {
            errorMessage = 'Template ID no encontrado. Visita https://dashboard.emailjs.com/admin/templates para crear uno.';
          } else if (error.text && error.text.includes('public key')) {
            errorMessage = 'Public Key inv√°lida. Verifica tu Public Key en https://dashboard.emailjs.com/admin/account';
          }
          break;
        case 403:
          errorMessage = 'Acceso denegado. Verifica tu Public Key en services.js';
          break;
        case 404:
          errorMessage = 'Servicio o plantilla no encontrados. Verifica los IDs en services.js';
          break;
      }
    }
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('error', 'Error en la prueba', errorMessage);
    } else {
      alert('‚ùå Error en la prueba: ' + errorMessage);
    }
  }
  
  console.log('üß™ === FIN DE LA PRUEBA ===');
};

// === FUNCIONES GLOBALES PARA LA INTERFAZ ===

// Funci√≥n global para enviar reporte completo por email
window.sendFullReportEmail = async function() {
  console.log('üìä Enviando reporte completo...');
  
  try {
    if (!window.remindersManager) {
      throw new Error('Sistema de recordatorios no inicializado');
    }
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('info', 'Enviando reporte', 'Generando y enviando reporte completo...');
    }
    
    await window.remindersManager.sendFullReportEmail();
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('success', 'Reporte enviado', 'El reporte completo ha sido enviado por email correctamente');
    } else {
      alert('‚úÖ Reporte completo enviado por email correctamente');
    }
    
  } catch (error) {
    console.error('‚ùå Error enviando reporte completo:', error);
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('error', 'Error enviando reporte', error.message);
    } else {
      alert('‚ùå Error enviando reporte: ' + error.message);
    }
  }
};

// Funci√≥n global para probar email de recordatorio
window.testEmailReminder = async function() {
  console.log('üß™ Probando email de recordatorio...');
  
  try {
    if (!window.remindersManager) {
      throw new Error('Sistema de recordatorios no inicializado');
    }
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('info', 'Enviando prueba', 'Enviando email de prueba...');
    }
    
    await window.remindersManager.testEmailSending();
    
    console.log('‚úÖ Email de prueba enviado correctamente');
    
  } catch (error) {
    console.error('‚ùå Error en email de prueba:', error);
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('error', 'Error en prueba de email', error.message);
    } else {
      alert('‚ùå Error en prueba de email: ' + error.message);
    }
  }
};

// Funci√≥n global para eliminar todos los recordatorios
window.deleteAllReminders = function() {
  if (!window.remindersManager) {
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('error', 'Error', 'Sistema de recordatorios no inicializado');
    } else {
      alert('‚ùå Sistema de recordatorios no inicializado');
    }
    return;
  }
  
  const confirm = window.confirm('¬øEst√°s seguro de que quieres eliminar todos los recordatorios?');
  if (confirm) {
    window.remindersManager.deleteAllReminders();
  }
};

// Funci√≥n global para eliminar recordatorio individual
window.deleteIndividualReminder = function(index) {
  if (!window.remindersManager) {
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('error', 'Error', 'Sistema de recordatorios no inicializado');
    } else {
      alert('‚ùå Sistema de recordatorios no inicializado');
    }
    return;
  }
  
  const confirm = window.confirm('¬øEst√°s seguro de que quieres eliminar este recordatorio?');
  if (confirm) {
    window.remindersManager.deleteReminder(index);
  }
};

// Funci√≥n global para configurar email
window.setupEmailReminder = async function() {
  const email = document.getElementById('emailAddress').value;
  const daysAhead = document.getElementById('emailDays').value;
  
  if (!email) {
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('warning', 'Email requerido', 'Por favor ingresa tu email');
    } else {
      alert('‚ö†Ô∏è Por favor ingresa tu email');
    }
    return;
  }
  
  try {
    if (!window.remindersManager) {
      throw new Error('Sistema de recordatorios no inicializado');
    }
    
    await window.remindersManager.setupEmail(email, daysAhead);
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('success', 'Email configurado', 'Recordatorios por email configurados correctamente');
    } else {
      alert('‚úÖ Recordatorios por email configurados correctamente');
    }
    
    // Regenerar recordatorios con la nueva configuraci√≥n
    if (window.app && window.app.state && window.app.state.products) {
      window.remindersManager.generateReminders(window.app.state.products);
    }
    
  } catch (error) {
    console.error('‚ùå Error configurando email:', error);
    
    if (window.app && typeof window.app.showNotification === 'function') {
      window.app.showNotification('error', 'Error configurando email', error.message);
    } else {
      alert('‚ùå Error configurando email: ' + error.message);
    }
  }
};

// Funci√≥n global para test b√°sico de notificaciones
window.testBasicNotification = function() {
  if (window.app && typeof window.app.showNotification === 'function') {
    window.app.showNotification('success', 'Prueba de notificaci√≥n', 'El sistema de notificaciones est√° funcionando correctamente');
  } else {
    alert('‚úÖ Notificaci√≥n de prueba - El sistema est√° funcionando');
  }
};

console.log('‚úÖ Funciones globales de interfaz registradas correctamente');

// Mostrar advertencias seg√∫n el entorno al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
  // Inicializar el sistema de recordatorios autom√°ticamente
  if (!window.remindersManager) {
    try {
      window.remindersManager = new RemindersManager();
      console.log('‚úÖ Sistema de recordatorios inicializado autom√°ticamente');
    } catch (error) {
      console.error('‚ùå Error inicializando sistema de recordatorios:', error);
    }
  }

  // Mostrar advertencia de CORS para email
  const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
  const isFile = window.location.protocol === 'file:';
  
  if (isLocalhost || isFile) {
    // Advertencia para Google Calendar
    const calendarWarning = document.getElementById('calendarLocalWarning');
    if (calendarWarning) {
      calendarWarning.style.display = 'block';
    }
    
    // Advertencia para Email si existe
    const emailWarning = document.getElementById('emailWarning');
    if (emailWarning) {
      emailWarning.style.display = 'block';
    }
    
    console.log('üìç Detectado entorno de desarrollo local');
    console.log('‚úÖ WhatsApp: Funciona perfectamente');
    console.log('‚ö†Ô∏è Email: Puede fallar por CORS');
    console.log('‚ùå Google Calendar: No funciona en localhost');
  }
});

// Funci√≥n global para verificar configuraci√≥n de EmailJS
window.verificarConfiguracionEmailJS = function() {
  console.log('üîç === VERIFICACI√ìN DE CONFIGURACI√ìN EMAILJS ===');
  
  // Verificar m√∫ltiples formas de acceso a la configuraci√≥n
  let config = null;
  
  if (typeof window.SERVICES_CONFIG !== 'undefined') {
    config = window.SERVICES_CONFIG.emailJS;
    console.log('‚úÖ SERVICES_CONFIG encontrado en window');
  } else if (typeof SERVICES_CONFIG !== 'undefined') {
    config = SERVICES_CONFIG.emailJS;
    console.log('‚úÖ SERVICES_CONFIG encontrado globalmente');
    // Asignar a window para uso futuro
    window.SERVICES_CONFIG = SERVICES_CONFIG;
  } else {
    console.error('‚ùå SERVICES_CONFIG no disponible en ninguna forma');
    
    // Intentar crear configuraci√≥n b√°sica
    const basicConfig = {
      emailJS: {
        publicKey: '8c4l-rq7DsQF8ibja',
        serviceId: 'service_srur1ha',
        templateId: 'template_EJEMPLO',
        enabled: false
      }
    };
    
    window.SERVICES_CONFIG = basicConfig;
    config = basicConfig.emailJS;
    console.log('‚ö†Ô∏è Configuraci√≥n b√°sica creada');
  }
  
  if (!config) {
    alert('‚ùå No se pudo cargar la configuraci√≥n. Verifica que services.js est√© funcionando correctamente.');
    return;
  }
  
  console.log('üìã Estado de configuraci√≥n:', {
    enabled: config.enabled,
    publicKey: config.publicKey ? config.publicKey.substring(0, 8) + '...' : 'NO CONFIGURADO',
    serviceId: config.serviceId || 'NO CONFIGURADO',
    templateId: config.templateId || 'NO CONFIGURADO'
  });
  
  let mensaje = 'üìä ESTADO DE CONFIGURACI√ìN EMAILJS:\n\n' +
                `Public Key: ${config.publicKey ? config.publicKey.substring(0, 8) + '...' : 'NO CONFIGURADO'}\n` +
                `Service ID: ${config.serviceId || 'NO CONFIGURADO'}\n` +
                `Template ID: ${config.templateId || 'NO CONFIGURADO'}\n` +
                `Habilitado: ${config.enabled ? 'S√ç' : 'NO'}\n`;
  
  if (config.templateId === 'template_EJEMPLO') {
    mensaje += '‚ö†Ô∏è ADVERTENCIA: Template ID es de ejemplo!\n';
  }
  
  alert(mensaje);
  console.log('üîç === FIN DE VERIFICACI√ìN ===');
};

// Funci√≥n global para diagnosticar la carga de servicios
window.diagnosticarCarga = function() {
  console.log('ü©∫ === DIAGN√ìSTICO DE CARGA DE SERVICIOS ===');
  
  let reporte = 'ü©∫ DIAGN√ìSTICO DE CARGA DE SERVICIOS:\n\n';
  
  // 1. Verificar variables globales
  reporte += 'üìã VARIABLES GLOBALES:\n';
  
  if (typeof window.SERVICES_CONFIG !== 'undefined') {
    reporte += '‚úÖ window.SERVICES_CONFIG: DISPONIBLE\n';
  } else {
    reporte += '‚ùå window.SERVICES_CONFIG: NO DISPONIBLE\n';
  }
  
  if (typeof SERVICES_CONFIG !== 'undefined') {
    reporte += '‚úÖ SERVICES_CONFIG (global): DISPONIBLE\n';
  } else {
    reporte += '‚ùå SERVICES_CONFIG (global): NO DISPONIBLE\n';
  }
  
  if (typeof window.SERVICES_CONFIG_LOADED !== 'undefined') {
    reporte += '‚úÖ SERVICES_CONFIG_LOADED: ' + window.SERVICES_CONFIG_LOADED + '\n';
  } else {
    reporte += '‚ùå SERVICES_CONFIG_LOADED: NO DEFINIDO\n';
  }
  
  // 2. Verificar librer√≠as
  reporte += '\nüìö LIBRER√çAS:\n';
  
  if (typeof emailjs !== 'undefined') {
    reporte += '‚úÖ EmailJS: CARGADO\n';
  } else {
    reporte += '‚ùå EmailJS: NO CARGADO\n';
  }
  
  // 3. Verificar RemindersManager
  reporte += '\nüîß SISTEMA DE RECORDATORIOS:\n';
  
  if (typeof window.remindersManager !== 'undefined') {
    reporte += '‚úÖ RemindersManager: INICIALIZADO\n';
  } else {
    reporte += '‚ùå RemindersManager: NO INICIALIZADO\n';
  }
  
  if (typeof window.RemindersManager !== 'undefined') {
    reporte += '‚úÖ Clase RemindersManager: DISPONIBLE\n';
  } else {
    reporte += '‚ùå Clase RemindersManager: NO DISPONIBLE\n';
  }
  
  // 4. Verificar configuraci√≥n espec√≠fica
  if (typeof window.SERVICES_CONFIG !== 'undefined') {
    reporte += '\n‚öôÔ∏è CONFIGURACI√ìN EMAILJS:\n';
    const config = window.SERVICES_CONFIG.emailJS;
    
    reporte += `Public Key: ${config.publicKey ? config.publicKey.substring(0, 8) + '...' : 'NO CONFIGURADO'}\n`;
    reporte += `Service ID: ${config.serviceId || 'NO CONFIGURADO'}\n`;
    reporte += `Template ID: ${config.templateId || 'NO CONFIGURADO'}\n`;
    reporte += `Habilitado: ${config.enabled ? 'S√ç' : 'NO'}\n`;
    
    if (config.templateId === 'template_EJEMPLO') {
      reporte += '‚ö†Ô∏è ADVERTENCIA: Template ID es de ejemplo!\n';
    }
  }
  
  // 5. Sugerencias
  reporte += '\nüîß SUGERENCIAS:\n';
  
  if (typeof window.SERVICES_CONFIG === 'undefined') {
    reporte += '- Verificar que services.js se est√© cargando correctamente\n';
    reporte += '- Revisar la consola del navegador para errores\n';
    reporte += '- Asegurar que el archivo est√° en src/config/services.js\n';
  }
  
  if (typeof emailjs === 'undefined') {
    reporte += '- EmailJS no est√° cargado, verificar el script en index.html\n';
  }
  
  if (typeof window.remindersManager === 'undefined') {
    reporte += '- El sistema de recordatorios no se inicializ√≥ correctamente\n';
  }
  
  alert(reporte);
  console.log(reporte);
  console.log('ü©∫ === FIN DEL DIAGN√ìSTICO ===');
};

// Funci√≥n para prueba r√°pida de configuraci√≥n
window.pruebaRapidaConfig = function() {
  console.log('‚ö° === PRUEBA R√ÅPIDA DE CONFIGURACI√ìN ===');
  
  const resultados = [];
  
  // Test 1: Variable global
  if (typeof window.SERVICES_CONFIG !== 'undefined') {
    resultados.push('‚úÖ window.SERVICES_CONFIG disponible');
    console.log('‚úÖ SERVICES_CONFIG encontrado');
  } else {
    resultados.push('‚ùå window.SERVICES_CONFIG NO disponible');
    console.log('‚ùå SERVICES_CONFIG NO encontrado');
  }
  
  // Test 2: Configuraci√≥n EmailJS
  if (window.SERVICES_CONFIG && window.SERVICES_CONFIG.emailJS) {
    resultados.push('‚úÖ Configuraci√≥n EmailJS accesible');
    console.log('‚úÖ EmailJS config OK');
  } else {
    resultados.push('‚ùå Configuraci√≥n EmailJS NO accesible');
    console.log('‚ùå EmailJS config FALLO');
  }
  
  // Test 3: Librer√≠a EmailJS
  if (typeof emailjs !== 'undefined') {
    resultados.push('‚úÖ Librer√≠a EmailJS cargada');
    console.log('‚úÖ EmailJS library OK');
  } else {
    resultados.push('‚ùå Librer√≠a EmailJS NO cargada');
    console.log('‚ùå EmailJS library FALLO');
  }
  
  // Test 4: RemindersManager
  if (typeof window.remindersManager !== 'undefined') {
    resultados.push('‚úÖ RemindersManager inicializado');
    console.log('‚úÖ RemindersManager OK');
  } else {
    resultados.push('‚ùå RemindersManager NO inicializado');
    console.log('‚ùå RemindersManager FALLO');
  }
  
  // Mostrar resultados
  const mensaje = '‚ö° PRUEBA R√ÅPIDA DE CONFIGURACI√ìN:\n\n' + resultados.join('\n');
  alert(mensaje);
  console.log(mensaje);
  console.log('‚ö° === FIN DE PRUEBA R√ÅPIDA ===');
  
  return resultados;
};

// Funci√≥n de depuraci√≥n para verificar configuraci√≥n en tiempo real
window.depurarConfigEmailJS = function() {
  console.log('üîç === DEPURACI√ìN DE CONFIGURACI√ìN EMAILJS ===');
  
  // 1. Verificar que SERVICES_CONFIG est√© disponible
  if (typeof window.SERVICES_CONFIG === 'undefined') {
    console.error('‚ùå window.SERVICES_CONFIG no est√° definido');
    alert('‚ùå ERROR: window.SERVICES_CONFIG no est√° definido\n\nEsto significa que services.js no se carg√≥ correctamente.');
    return;
  }
  
  // 2. Verificar la configuraci√≥n espec√≠fica
  const config = window.SERVICES_CONFIG.emailJS;
  console.log('üìã Configuraci√≥n actual:', config);
  
  // 3. Verificar cada campo espec√≠ficamente
  const verificaciones = {
    'SERVICES_CONFIG existe': !!window.SERVICES_CONFIG,
    'emailJS config existe': !!config,
    'publicKey': config?.publicKey || 'NO CONFIGURADO',
    'serviceId': config?.serviceId || 'NO CONFIGURADO', 
    'templateId': config?.templateId || 'NO CONFIGURADO',
    'enabled': config?.enabled || false,
    'templateId es ejemplo': config?.templateId?.includes('EJEMPLO') || false
  };
  
  console.table(verificaciones);
  
  // 4. Mostrar resultado
  let mensaje = 'üîç DEPURACI√ìN DE CONFIGURACI√ìN EMAILJS:\n\n';
  
  Object.entries(verificaciones).forEach(([key, value]) => {
    const status = value === true || (typeof value === 'string' && value !== 'NO CONFIGURADO') ? '‚úÖ' : '‚ùå';
    mensaje += `${status} ${key}: ${value}\n`;
  });
  
  // 5. Verificar el problema espec√≠fico
  if (config?.templateId?.includes('EJEMPLO')) {
    mensaje += '\nüö® PROBLEMA ENCONTRADO:\n';
    mensaje += `Template ID actual: "${config.templateId}"\n`;
    mensaje += 'Este Template ID contiene "EJEMPLO" y ser√° rechazado.\n';
    mensaje += 'Debes configurar un Template ID real en services.js';
  } else if (config?.templateId === 'template_f0c0va1') {
    mensaje += '\n‚úÖ CONFIGURACI√ìN CORRECTA:\n';
    mensaje += `Template ID: ${config.templateId}\n`;
    mensaje += 'La configuraci√≥n parece correcta.';
  }
  
  alert(mensaje);
  console.log('üîç === FIN DE DEPURACI√ìN ===');
  
  return verificaciones;
};

console.log('‚úÖ RemindersManager cargado correctamente');
    </script>
    
    <!-- Aplicaci√≥n principal -->
    <script>
// Aplicaci√≥n principal - Calculadora de Cuotas - Versi√≥n JavaScript
console.log('ÔøΩ INICIO: app.js se est√° ejecutando...');
console.log('ÔøΩüöÄ Iniciando Calculadora de Cuotas v2025.06.29 (JS)');

/**
 * Calculadora de Cuotas - Versi√≥n JavaScript pura
 */
class CalculadoraCuotas {
  constructor() {
    console.log('üöÄ Iniciando constructor CalculadoraCuotas...');
    
    this.state = {
      products: [],
      currentTimeRange: 'all',
      currentChartType: 'bar', // Nuevo estado para tipo de gr√°fico
      isLoading: true,
      modal: { isOpen: false },
    };
    
    this.chartInstance = null;
    this.remindersManager = null;
    
    console.log('üìä Estado inicial creado, llamando initialize...');
    this.initialize();
  }

  async initialize() {
    try {
      console.log('üîß Inicializando aplicaci√≥n...');
      
      // Mostrar loading
      console.log('üì± Mostrando indicador de carga...');
      this.showLoading();
      
      // Timeout de emergencia para evitar que se cuelgue
      const emergencyTimeout = setTimeout(() => {
        console.warn('‚ö†Ô∏è Timeout de emergencia - Forzando inicializaci√≥n');
        this.hideLoading();
        this.renderProducts();
        this.updateStats();
        this.state.isLoading = false;
      }, 5000);
      
      // Esperar que las librer√≠as externas se carguen
      console.log('üìö Esperando librer√≠as...');
      await this.waitForLibraries();
      
      // Configurar eventos b√°sicos
      console.log('üéØ Configurando eventos b√°sicos...');
      this.setupBasicEventListeners();
      
      // Inicializar valores por defecto del formulario
      console.log('üìã Configurando valores por defecto...');
      this.initializeFormDefaults();
      
      // Inicializar sistema de recordatorios
      console.log('üîî Inicializando recordatorios...');
      await this.initializeReminders();
      
      // Cargar datos del localStorage
      console.log('üíæ Cargando datos guardados...');
      this.loadStoredProducts();
      
      // Simular carga y luego ocultar loading
      console.log('‚è≥ Finalizando inicializaci√≥n...');
      setTimeout(() => {
        console.log('üé® Ocultando carga y renderizando...');
        clearTimeout(emergencyTimeout); // Cancelar timeout de emergencia
        this.hideLoading();
        
        // Renderizar productos DESPU√âS de ocultar loading
        this.renderProducts();
        this.updateStats();
        this.updateChart(); // Asegurar que el gr√°fico est√© sincronizado
        console.log('‚úÖ Aplicaci√≥n inicializada correctamente');
        this.state.isLoading = false;
      }, 1000);
      
    } catch (error) {
      console.error('‚ùå Error inicializando aplicaci√≥n:', error);
      this.hideLoading(); // Asegurar que se oculte el loading en caso de error
      this.showError('Error al inicializar la aplicaci√≥n: ' + error.message);
      this.state.isLoading = false;
    }
  }

  // Funci√≥n para verificar que las librer√≠as externas est√©n cargadas
  async waitForLibraries() {
    console.log('‚è≥ Esperando librer√≠as externas...');
    
    // Timeout m√°ximo de 5 segundos
    const maxWaitTime = 5000;
    const startTime = Date.now();
    
    // Esperar Chart.js
    let chartRetries = 0;
    while (!window.Chart && chartRetries < 50 && (Date.now() - startTime) < maxWaitTime) {
      await new Promise(resolve => setTimeout(resolve, 100));
      chartRetries++;
    }
    
    // Esperar jsPDF (puede estar en diferentes lugares)
    let pdfRetries = 0;
    while (!window.jsPDF && !window.jspdf && pdfRetries < 50 && (Date.now() - startTime) < maxWaitTime) {
      await new Promise(resolve => setTimeout(resolve, 100));
      pdfRetries++;
    }
    
    // Verificar que tengamos las librer√≠as b√°sicas
    const hasChart = !!window.Chart;
    const hasPDF = !!(window.jsPDF || window.jspdf);
    const hasEmailJS = !!window.emailjs;
    
    console.log('üìä Estado de librer√≠as:', {
      'Chart.js': hasChart ? '‚úÖ' : '‚ùå',
      'jsPDF': hasPDF ? '‚úÖ' : '‚ùå',
      'EmailJS': hasEmailJS ? '‚úÖ' : '‚ùå',
      'Tiempo de espera': `${Date.now() - startTime}ms`
    });
    
    // Inicializar EmailJS si est√° disponible
    if (hasEmailJS && window.SERVICES_CONFIG && window.SERVICES_CONFIG.emailJS) {
      try {
        console.log('üîß Inicializando EmailJS...');
        emailjs.init(window.SERVICES_CONFIG.emailJS.publicKey);
        console.log('‚úÖ EmailJS inicializado correctamente');
      } catch (error) {
        console.warn('‚ö†Ô∏è Error inicializando EmailJS:', error);
      }
    } else {
      console.warn('‚ö†Ô∏è EmailJS o configuraci√≥n no disponible - los recordatorios por email no funcionar√°n');
    }
    
    // Si no tenemos Chart.js, advertir pero continuar
    if (!hasChart) {
      console.warn('‚ö†Ô∏è Chart.js no se carg√≥ - los gr√°ficos no funcionar√°n');
    }
    
    // Si no tenemos jsPDF, advertir pero continuar
    if (!hasPDF) {
      console.warn('‚ö†Ô∏è jsPDF no se carg√≥ - la exportaci√≥n PDF no funcionar√°');
    }
  }

  setupBasicEventListeners() {
    console.log('üéØ Configurando event listeners b√°sicos...');
    
    // Bot√≥n agregar producto
    const btnAgregar = document.getElementById('btnAgregarProducto');
    if (btnAgregar) {
      console.log('‚úÖ Bot√≥n agregar producto encontrado, configurando event listener');
      btnAgregar.addEventListener('click', () => {
        console.log('üî• Click en bot√≥n agregar producto detectado');
        this.handleAddProduct();
      });
    } else {
      console.error('‚ùå Bot√≥n agregar producto NO encontrado');
    }

    // Bot√≥n eliminar todos los productos
    const btnBorrarTodo = document.getElementById('btnBorrarTodo');
    if (btnBorrarTodo) {
      console.log('‚úÖ Bot√≥n borrar todo encontrado, configurando event listener');
      btnBorrarTodo.addEventListener('click', () => {
        console.log('üî• Click en bot√≥n borrar todo detectado');
        this.handleDeleteAllProducts();
      });
    } else {
      console.log('‚ö†Ô∏è Bot√≥n borrar todo no encontrado (normal si no hay productos)');
    }

    // Bot√≥n descargar PDF
    const btnPDF = document.getElementById('btnDescargarPDF');
    if (btnPDF) {
      btnPDF.addEventListener('click', () => {
        this.generatePDF();
      });
    }

    // Botones de rango de tiempo
    document.querySelectorAll('.time-range-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const range = e.target.getAttribute('data-range');
        this.updateTimeRange(range);
      });
    });

    // Botones de tipo de gr√°fico
    document.querySelectorAll('.chart-type-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const type = e.target.getAttribute('data-type') || e.target.closest('[data-type]')?.getAttribute('data-type');
        if (type) {
          this.updateChartType(type);
        }
      });
    });

    // Modal eventos
    this.setupModalEvents();
    
    // Validaci√≥n en tiempo real para inputs num√©ricos
    this.setupNumberInputValidation();
  }

  initializeFormDefaults() {
    console.log('üìã Inicializando valores por defecto del formulario...');
    
    // Establecer fecha de hoy por defecto
    const fechaInput = document.getElementById('fechaInicio');
    if (fechaInput && !fechaInput.value) {
      const today = new Date();
      const dateString = today.toISOString().split('T')[0];
      fechaInput.value = dateString;
      console.log('üìÖ Fecha por defecto establecida:', dateString);
    }
    
    // Establecer n√∫mero de cuotas por defecto
    const cuotasInput = document.getElementById('numeroCuotas');
    if (cuotasInput && !cuotasInput.value) {
      cuotasInput.value = '12';
      console.log('üî¢ N√∫mero de cuotas por defecto: 12');
    }
  }

  setupModalEvents() {
    // Modal de edici√≥n
    const editModal = document.getElementById('editModal');
    const closeEditModal = document.getElementById('closeEditModal');
    const btnCancelEdit = document.getElementById('btnCancelEdit');
    const btnSaveEdit = document.getElementById('btnSaveEdit');

    if (closeEditModal) {
      closeEditModal.addEventListener('click', () => {
        this.closeModal('editModal');
      });
    }

    if (btnCancelEdit) {
      btnCancelEdit.addEventListener('click', () => {
        this.closeModal('editModal');
      });
    }

    if (btnSaveEdit) {
      btnSaveEdit.addEventListener('click', () => {
        this.saveEditedProduct();
      });
    }

    // Modal de confirmaci√≥n
    const confirmModal = document.getElementById('confirmModal');
    const btnCancelDelete = document.getElementById('btnCancelDelete');
    const btnConfirmDelete = document.getElementById('btnConfirmDelete');

    if (btnCancelDelete) {
      btnCancelDelete.addEventListener('click', () => {
        this.closeModal('confirmModal');
      });
    }

    if (btnConfirmDelete) {
      btnConfirmDelete.addEventListener('click', () => {
        this.confirmDelete();
      });
    }

    // Cerrar modal al hacer click fuera
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        this.closeModal(e.target.id);
      }
    });
  }

  handleAddProduct() {
    console.log('üî• handleAddProduct llamado');
    const nombre = document.getElementById('nombreProducto')?.value;
    const valorStr = document.getElementById('valorTotalProducto')?.value || '0';
    const cuotas = parseInt(document.getElementById('numeroCuotas')?.value || '0');
    const fecha = document.getElementById('fechaInicio')?.value;

    // Usar la nueva funci√≥n de parseo latinoamericano
    const valor = this.parseLatinNumber(valorStr);

    if (!nombre || !this.isValidNumber(valorStr) || !cuotas || !fecha) {
      this.showNotification('error', 'Error de validaci√≥n', 'Por favor completa todos los campos con valores v√°lidos');
      return;
    }

    if (valor <= 0) {
      this.showNotification('error', 'Valor inv√°lido', 'El valor del producto debe ser mayor a 0');
      return;
    }

    if (cuotas <= 0) {
      this.showNotification('error', 'Cuotas inv√°lidas', 'El n√∫mero de cuotas debe ser mayor a 0');
      return;
    }

    const startDate = new Date(fecha);
    const endDate = new Date(startDate);
    endDate.setMonth(endDate.getMonth() + cuotas);

    const product = {
      id: Date.now().toString(),
      name: nombre,
      totalValue: valor,
      installments: cuotas,
      startDate: startDate,
      endDate: endDate,
      monthlyPayment: valor / cuotas
    };

    this.state.products.push(product);
    this.saveProducts();
    this.renderProducts();
    this.clearForm();
    this.updateStats();
    
    // Mostrar notificaci√≥n de √©xito con valor formateado
    try {
      this.showNotification('success', '¬°Producto agregado!', 
        `"${nombre}" por $${this.formatLatinNumber(valor)} se ha agregado correctamente`);
    } catch (error) {
      console.error('‚ùå Error en showNotification:', error);
      // Fallback
      alert(`‚úÖ Producto agregado: "${nombre}" por $${this.formatLatinNumber(valor)}`);
    }
    
    // Generar recordatorios autom√°ticamente
    this.generateReminders();
  }

  loadStoredProducts() {
    try {
      const stored = localStorage.getItem('calculadora-productos');
      if (stored) {
        const products = JSON.parse(stored);
        this.state.products = products.map(p => ({
          ...p,
          startDate: new Date(p.startDate),
          endDate: new Date(p.endDate)
        }));
        console.log(`üì¶ Productos cargados desde localStorage: ${this.state.products.length}`);
        
        // Generar recordatorios para productos existentes
        setTimeout(() => {
          this.generateReminders();
        }, 2000); // Esperar a que el sistema de recordatorios est√© listo
      } else {
        console.log('üì¶ No hay productos guardados en localStorage');
        this.state.products = [];
      }
    } catch (error) {
      console.error('‚ùå Error cargando productos:', error);
      this.state.products = [];
    }
  }

  saveProducts() {
    try {
      localStorage.setItem('calculadora-productos', JSON.stringify(this.state.products));
      
      // Tambi√©n guardar en el formato que espera el sistema de recordatorios
      localStorage.setItem('products', JSON.stringify(this.state.products));
      
      // Generar recordatorios si hay productos
      this.generateReminders();
    } catch (error) {
      console.error('Error guardando productos:', error);
    }
  }

  // Generar recordatorios para todos los productos
  generateReminders() {
    if (this.state.products.length > 0) {
      console.log('üìÖ Generando recordatorios para', this.state.products.length, 'productos');
      // Llamar a la funci√≥n global si existe
      if (typeof window.generateReminders === 'function') {
        try {
          window.generateReminders(this.state.products);
        } catch (error) {
          console.error('‚ùå Error generando recordatorios:', error);
        }
      }
    }
  }

  renderProducts() {
    console.log('üé® Renderizando productos...', this.state.products);
    const container = document.getElementById('listaProductos');
    const btnBorrarTodo = document.getElementById('btnBorrarTodo');
    
    if (!container) {
      console.error('‚ùå Contenedor listaProductos no encontrado');
      return;
    }

    if (this.state.products.length === 0) {
      console.log('üì≠ No hay productos para mostrar');
      container.innerHTML = '<p class="no-products">No hay productos registrados. ¬°Agrega tu primer producto arriba! üöÄ</p>';
      
      // Ocultar bot√≥n eliminar todos
      if (btnBorrarTodo) {
        btnBorrarTodo.style.display = 'none';
      }
      
      // No hay productos, ocultar bot√≥n de eliminar todo
      return;
    }

    console.log(`üì¶ Renderizando ${this.state.products.length} productos`);
    container.innerHTML = this.state.products.map(product => `
      <div class="product-card" data-id="${product.id}">
        <div class="product-header">
          <h4>${product.name}</h4>
          <div class="product-actions">
            <button class="btn-edit" onclick="window.app.editProduct('${product.id}')">‚úèÔ∏è Editar</button>
            <button class="btn-delete" onclick="window.app.deleteProduct('${product.id}')">üóëÔ∏è Eliminar</button>
          </div>
        </div>
        <div class="product-details">
          <p><strong>Valor Total:</strong> $${this.formatLatinNumber(product.totalValue)}</p>
          <p><strong>Cuotas:</strong> ${product.installments}</p>
          <p><strong>Cuota Mensual:</strong> $${this.formatLatinNumber(product.monthlyPayment)}</p>
          <p><strong>Inicio:</strong> ${product.startDate.toLocaleDateString()}</p>
          <p><strong>Fin:</strong> ${product.endDate.toLocaleDateString()}</p>
        </div>
      </div>
    `).join('');
    
    // Mostrar bot√≥n eliminar todos si hay productos
    if (btnBorrarTodo) {
      btnBorrarTodo.style.display = 'block';
    }
    
    console.log('‚úÖ Productos renderizados correctamente');
    
    // Generar recordatorios si hay productos
    this.generateReminders();
  }

  clearForm() {
    document.getElementById('nombreProducto').value = '';
    document.getElementById('valorTotalProducto').value = '';
    document.getElementById('numeroCuotas').value = '';
    document.getElementById('fechaInicio').value = '';
  }

  updateStats() {
    console.log('üìä Actualizando estad√≠sticas...', this.state.products);
    const totalProducts = this.state.products.length;
    const totalValue = this.state.products.reduce((sum, p) => sum + p.totalValue, 0);
    const monthlyAverage = this.state.products.reduce((sum, p) => sum + p.monthlyPayment, 0);

    console.log(`üìä Stats: ${totalProducts} productos, $${totalValue} total, $${monthlyAverage} mensual`);

    document.getElementById('totalProductos').textContent = totalProducts.toString();
    document.getElementById('valorTotal').textContent = `$${this.formatLatinNumber(totalValue)}`;
    document.getElementById('promedioMensual').textContent = `$${this.formatLatinNumber(monthlyAverage)}`;
    document.getElementById('proximoMes').textContent = `$${this.formatLatinNumber(monthlyAverage)}`;

    // Actualizar gr√°fico
    this.updateChart();
  }

  updateChart() {
    const canvas = document.getElementById('gastosChart');
    const chartMessage = document.getElementById('chartMessage');
    
    if (!canvas) return;

    // Si no hay productos, mostrar mensaje vac√≠o
    if (this.state.products.length === 0) {
      if (chartMessage) chartMessage.style.display = 'flex';
      canvas.style.display = 'none';
      return;
    }

    // Ocultar mensaje y mostrar canvas
    if (chartMessage) chartMessage.style.display = 'none';
    canvas.style.display = 'block';

    // Calcular n√∫mero de meses seg√∫n el rango seleccionado
    const monthsToShow = this.getMonthsToShow();
    
    // Preparar datos del gr√°fico
    const { months, payments } = this.generateChartData(monthsToShow);

    // Destruir gr√°fico anterior si existe
    if (this.chartInstance) {
      this.chartInstance.destroy();
    }

    // Crear configuraci√≥n seg√∫n el tipo de gr√°fico
    const chartConfig = this.getChartConfig(months, payments);

    // Crear nuevo gr√°fico
    const ctx = canvas.getContext('2d');
    if (ctx && window.Chart) {
      this.chartInstance = new window.Chart(ctx, chartConfig);
      console.log(`‚úÖ Gr√°fico actualizado: tipo ${this.state.currentChartType}, rango ${this.state.currentTimeRange}`);
    }
  }

  getMonthsToShow() {
    switch (this.state.currentTimeRange) {
      case '3m': return 3;
      case '6m': return 6;
      case 'all':
      default: return 12;
    }
  }

  generateChartData(monthsToShow) {
    const months = [];
    const payments = [];
    const currentDate = new Date();
    
    for (let i = 0; i < monthsToShow; i++) {
      const month = new Date(currentDate.getFullYear(), currentDate.getMonth() + i, 1);
      months.push(month.toLocaleDateString('es-ES', { month: 'short', year: '2-digit' }));
      
      // Calcular pagos para este mes
      const monthPayments = this.state.products
        .filter(product => {
          const productStart = new Date(product.startDate);
          const productEnd = new Date(product.endDate);
          return month >= productStart && month <= productEnd;
        })
        .reduce((sum, product) => sum + product.monthlyPayment, 0);
      
      payments.push(Math.round(monthPayments));
    }

    return { months, payments };
  }

  getChartConfig(months, payments) {
    const baseConfig = {
      data: {
        labels: months,
        datasets: [this.getDatasetConfig(payments)]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            borderColor: '#667eea',
            borderWidth: 1,
            cornerRadius: 8,
            callbacks: {
              label: function(context) {
                return `Cuotas: $${context.parsed.y.toLocaleString('es-ES')}`;
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value.toLocaleString('es-ES');
              },
              color: '#666'
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.1)',
              drawBorder: false
            }
          },
          x: {
            ticks: {
              color: '#666'
            },
            grid: {
              display: false
            }
          }
        },
        interaction: {
          intersect: false,
          mode: 'index'
        }
      }
    };

    // Agregar tipo espec√≠fico
    baseConfig.type = this.getChartJSType();
    
    return baseConfig;
  }

  getChartJSType() {
    // Mapear nuestros tipos a tipos de Chart.js
    switch (this.state.currentChartType) {
      case 'line': return 'line';
      case 'area': return 'line'; // √Årea es una l√≠nea con fill
      case 'bar':
      default: return 'bar';
    }
  }

  getDatasetConfig(payments) {
    const baseDataset = {
      data: payments,
      tension: 0.4,
      borderWidth: 3,
      pointRadius: 6,
      pointHoverRadius: 8,
      pointBackgroundColor: '#fff',
      pointBorderWidth: 3
    };

    switch (this.state.currentChartType) {
      case 'line':
        return {
          ...baseDataset,
          label: 'Pagos Mensuales',
          borderColor: '#667eea',
          backgroundColor: 'transparent',
          pointBorderColor: '#667eea',
          fill: false
        };
        
      case 'area':
        return {
          ...baseDataset,
          label: 'Pagos Mensuales',
          borderColor: '#667eea',
          backgroundColor: 'rgba(102, 126, 234, 0.1)',
          pointBorderColor: '#667eea',
          fill: true
        };
        
      case 'bar':
      default:
        return {
          label: 'Pagos Mensuales',
          data: payments,
          backgroundColor: 'rgba(102, 126, 234, 0.8)',
          borderColor: '#667eea',
          borderWidth: 2,
          borderRadius: 6,
          borderSkipped: false,
          hoverBackgroundColor: 'rgba(102, 126, 234, 0.9)',
          hoverBorderColor: '#5a6fd8'
        };
    }
  }

  updateTimeRange(range) {
    this.state.currentTimeRange = range;
    
    // Actualizar botones activos
    document.querySelectorAll('.time-range-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    document.querySelector(`[data-range="${range}"]`)?.classList.add('active');
    
    // Actualizar gr√°fico con nuevo rango
    this.updateChart();
    console.log(`Rango de tiempo actualizado: ${range}`);
  }

  updateChartType(type) {
    this.state.currentChartType = type;
    
    // Actualizar botones activos
    document.querySelectorAll('.chart-type-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    document.querySelector(`[data-type="${type}"]`)?.classList.add('active');
    
    // Actualizar gr√°fico con nuevo tipo
    this.updateChart();
    console.log(`Tipo de gr√°fico actualizado: ${type}`);
    
    // Mostrar notificaci√≥n del cambio
    const typeNames = {
      'bar': 'Gr√°fico de Barras',
      'line': 'Gr√°fico de L√≠neas', 
      'area': 'Gr√°fico de √Årea'
    };
    this.showNotification('info', 'Vista actualizada', `Cambiado a ${typeNames[type]}`, 3000);
  }

  async generatePDF() {
    try {
      // Verificar si jsPDF est√° disponible (diferentes formas de acceso)
      let jsPDFConstructor = null;
      
      // M√©todo 1: jsPDF como constructor directo (m√°s moderno)
      if (typeof window.jsPDF === 'function') {
        jsPDFConstructor = window.jsPDF;
        console.log('‚úÖ jsPDF encontrado como constructor directo');
      }
      // M√©todo 2: jsPDF.jsPDF (versi√≥n UMD)
      else if (window.jsPDF && typeof window.jsPDF.jsPDF === 'function') {
        jsPDFConstructor = window.jsPDF.jsPDF;
        console.log('‚úÖ jsPDF encontrado como window.jsPDF.jsPDF');
      }
      // M√©todo 3: jspdf namespace (alternativo)
      else if (window.jspdf && typeof window.jspdf.jsPDF === 'function') {
        jsPDFConstructor = window.jspdf.jsPDF;
        console.log('‚úÖ jsPDF encontrado como window.jspdf.jsPDF');
      }
      
      if (!jsPDFConstructor) {
        console.error('‚ùå jsPDF no encontrado. Objetos disponibles:', {
          'window.jsPDF': typeof window.jsPDF,
          'window.jspdf': typeof window.jspdf,
          'window.jsPDF.jsPDF': window.jsPDF ? typeof window.jsPDF.jsPDF : 'N/A'
        });
        alert('Error: jsPDF no est√° disponible. Verifica que la librer√≠a se haya cargado correctamente.');
        return;
      }

      console.log('üìÑ Creando documento PDF avanzado...');
      const doc = new jsPDFConstructor();
      
      // === P√ÅGINA 1: PORTADA Y RESUMEN ===
      await this.generatePDFCoverPage(doc);
      
      // === P√ÅGINA 2: GR√ÅFICO ===
      if (this.state.products.length > 0) {
        doc.addPage();
        await this.generatePDFChartPage(doc);
        
        // === P√ÅGINAS 3+: CARDS MENSUALES ===
        await this.generatePDFMonthlyCards(doc);
      }
      
      // Guardar
      doc.save(`calculadora-cuotas-reporte-${new Date().toLocaleDateString().replace(/\//g, '-')}.pdf`);
      console.log('‚úÖ PDF generado exitosamente');
      
    } catch (error) {
      console.error('‚ùå Error generando PDF:', error);
      alert('Error al generar el PDF: ' + error.message);
    }
  }

  generatePDFCoverPage(doc) {
    // Paleta de colores moderna y minimalista
    const navy = [33, 47, 61]; // Azul marino elegante
    const teal = [26, 188, 156]; // Verde azulado vibrante
    const emerald = [46, 204, 113]; // Verde esmeralda
    const amber = [243, 156, 18]; // √Åmbar dorado
    const coral = [231, 76, 60]; // Coral vibrante
    const violet = [155, 89, 182]; // Violeta suave
    const slate = [52, 73, 94]; // Pizarra elegante
    const silver = [189, 195, 199]; // Plata clara
    const cream = [253, 254, 254]; // Crema sutil
    const charcoal = [44, 62, 80]; // Carb√≥n oscuro
    
    // === PORTADA MODERNA CON GRADIENTE SIMULADO ===
    // Fondo principal en azul marino
    doc.setFillColor(...navy);
    doc.rect(0, 0, 210, 65, 'F');
    
    // Banda decorativa superior en teal
    doc.setFillColor(...teal);
    doc.rect(0, 0, 210, 8, 'F');
    
    // === T√çTULO PRINCIPAL CON ESTILO ===
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(28);
    doc.setFont('helvetica', 'light');
    doc.text('CALCULADORA DE CUOTAS', 20, 32);
    
    // Subt√≠tulo elegante
    doc.setFontSize(14);
    doc.setFont('helvetica', 'normal');
    doc.text('Reporte Financiero Inteligente', 20, 48);
    
    // Fecha estilizada
    doc.setFontSize(10);
    const currentDate = new Date();
    const dateStr = currentDate.toLocaleDateString('es-CO', { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });
    doc.text(`Generado el ${dateStr}`, 20, 58);
    
    // === VERIFICACI√ìN DE PRODUCTOS ===
    if (this.state.products.length === 0) {
      doc.setFillColor(...cream);
      doc.rect(15, 80, 180, 40, 'F');
      
      doc.setTextColor(...slate);
      doc.setFontSize(16);
      doc.setFont('helvetica', 'normal');
      doc.text('No hay productos registrados', 25, 95);
      
      doc.setFontSize(11);
      doc.setTextColor(...silver);
      doc.text('Agrega productos para generar un reporte completo con an√°lisis detallado', 25, 110);
      return;
    }
    
    // === MENSAJE DE BIENVENIDA PERSONALIZADO ===
    doc.setFillColor(...cream);
    doc.rect(15, 75, 180, 20, 'F');
    
    doc.setTextColor(...charcoal);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'normal');
    doc.text('¬°Hola! Tu resumen financiero est√° listo con insights personalizados', 20, 82);
    doc.text('Informaci√≥n organizada para decisiones financieras inteligentes', 20, 90);
    
    // === ESTAD√çSTICAS EN TARJETAS PREMIUM ===
    const totalValue = this.state.products.reduce((sum, p) => sum + p.totalValue, 0);
    const monthlyTotal = this.state.products.reduce((sum, p) => sum + p.monthlyPayment, 0);
    const avgValue = Math.round(totalValue / this.state.products.length);
    const totalDuration = Math.max(...this.state.products.map(p => p.installments));
    
    // T√≠tulo de secci√≥n
    doc.setFontSize(15);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(...navy);
    doc.text('Panorama Financiero', 20, 110);
    
    // L√≠nea decorativa
    doc.setDrawColor(...teal);
    doc.setLineWidth(1.5);
    doc.line(20, 115, 190, 115);
    doc.setLineWidth(0.2);
    
    // Tarjetas de estad√≠sticas modernas
    const stats = [
      { 
        icon: 'PRODUCTOS',
        label: 'Productos activos', 
        value: this.state.products.length.toString(), 
        color: teal,
        unit: 'items'
      },
      { 
        icon: 'INVERSI√ìN',
        label: 'Inversi√≥n total', 
        value: `$${totalValue.toLocaleString('es-CO')}`, 
        color: emerald,
        unit: 'COP'
      },
      { 
        icon: 'MENSUAL',
        label: 'Compromiso mensual', 
        value: `$${Math.round(monthlyTotal).toLocaleString('es-CO')}`, 
        color: amber,
        unit: 'COP/mes'
      },
      { 
        icon: 'PROMEDIO',
        label: 'Valor promedio', 
        value: `$${avgValue.toLocaleString('es-CO')}`, 
        color: violet,
        unit: 'COP'
      }
    ];
    
    let yPos = 125;
    stats.forEach((stat, index) => {
      const x = 20 + (index % 2) * 90;
      const y = yPos + Math.floor(index / 2) * 38;
      
      // Fondo de tarjeta elegante
      doc.setFillColor(255, 255, 255);
      doc.rect(x, y, 85, 32, 'F');
      
      // Borde colorido premium
      doc.setDrawColor(...stat.color);
      doc.setLineWidth(1.2);
      doc.rect(x, y, 85, 32, 'S');
      doc.setLineWidth(0.2);
      
      // Acento de color superior
      doc.setFillColor(...stat.color);
      doc.rect(x, y, 85, 4, 'F');
      
      // Emoji grande
      doc.setTextColor(...charcoal);
      doc.setFontSize(16);
      doc.setFontSize(8);
      doc.setFont('helvetica', 'bold');
      doc.text(stat.icon, x + 6, y + 15);
      
      // Etiqueta descriptiva
      doc.setFontSize(7);
      doc.setTextColor(...silver);
      doc.setFont('helvetica', 'normal');
      doc.text(stat.label.toUpperCase(), x + 22, y + 10);
      
      // Valor principal
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(...stat.color);
      doc.text(stat.value, x + 22, y + 20);
      
      // Unidad opcional
      doc.setFontSize(6);
      doc.setTextColor(...silver);
      doc.setFont('helvetica', 'normal');
      doc.text(stat.unit, x + 22, y + 26);
    });
    
    // === GALER√çA DE PRODUCTOS PREMIUM ===
    yPos = 205;
    doc.setFontSize(15);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(...navy);
    doc.text('Cartera de Productos', 20, yPos);
    
    // L√≠nea decorativa
    doc.setDrawColor(...emerald);
    doc.setLineWidth(1);
    doc.line(20, yPos + 3, 140, yPos + 3);
    doc.setLineWidth(0.2);
    
    yPos += 15;
    
    this.state.products.forEach((product, index) => {
      if (yPos > 270) return;
      
      // Determinar emoji seg√∫n el tipo de producto
      let productType = this.getProductType(product.name);
      
      // Paleta de colores rotativos para productos
      const productColors = [teal, emerald, amber, coral, violet];
      const productColor = productColors[index % productColors.length];
      
      // Tarjeta mini para cada producto
      doc.setFillColor(255, 255, 255);
      doc.rect(20, yPos - 2, 170, 14, 'F');
      
      // Borde lateral colorido
      doc.setFillColor(...productColor);
      doc.rect(20, yPos - 2, 3, 14, 'F');
      
      // Informaci√≥n del producto
      doc.setTextColor(...charcoal);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text(product.name, 28, yPos + 6);
      
      // Detalles financieros con colores espec√≠ficos
      doc.setFontSize(8);
      doc.setFont('helvetica', 'normal');
      
      // Valor total
      doc.setTextColor(...emerald);
      doc.text(`${product.totalValue.toLocaleString('es-CO')}`, 28, yPos + 10);
      
      // Cuotas
      doc.setTextColor(...amber);
      doc.text(`${product.installments} pagos`, 85, yPos + 10);
      
      // Pago mensual
      doc.setTextColor(...coral);
      doc.text(`ÔøΩ $${Math.round(product.monthlyPayment).toLocaleString('es-CO')}/mes`, 135, yPos + 10);
      
      yPos += 16;
    });
    
    // === CONSEJO FINANCIERO DESTACADO ===
    if (yPos < 275) {
      yPos = Math.max(yPos + 5, 275);
      
      // Fondo destacado
      doc.setFillColor(...teal);
      doc.rect(15, yPos, 180, 15, 'F');
      
      // Texto del consejo
      doc.setTextColor(255, 255, 255);
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(9);
      doc.text('Consejo Inteligente:', 20, yPos + 6);
      
      doc.setFont('helvetica', 'normal');
      doc.text(`Reserva $${Math.round(monthlyTotal * 0.15).toLocaleString('es-CO')} mensuales para emergencias (15% de tus compromisos)`, 20, yPos + 11);
    }
  }
  
  // Funci√≥n auxiliar para determinar emoji de producto
  getProductType(productName) {
    const name = productName.toLowerCase();
    
    // Tecnolog√≠a
    if (name.includes('laptop') || name.includes('computador') || name.includes('pc') || name.includes('macbook')) return 'TECH';
    if (name.includes('celular') || name.includes('phone') || name.includes('m√≥vil') || name.includes('iphone') || name.includes('samsung')) return 'PHONE';
    if (name.includes('tablet') || name.includes('ipad')) return 'PHONE';
    if (name.includes('tv') || name.includes('televisor') || name.includes('smart tv') || name.includes('pantalla')) return 'TV';
    if (name.includes('playstation') || name.includes('xbox') || name.includes('gaming') || name.includes('nintendo')) return 'GAME';
    if (name.includes('auriculares') || name.includes('headphones') || name.includes('aud√≠fonos')) return 'AUDIO';
    if (name.includes('c√°mara') || name.includes('camera') || name.includes('gopro')) return 'CAMERA';
    
    // Veh√≠culos
    if (name.includes('carro') || name.includes('auto') || name.includes('veh√≠culo') || name.includes('toyota') || name.includes('chevrolet') || name.includes('ford')) return 'AUTO';
    if (name.includes('moto') || name.includes('motocicleta') || name.includes('yamaha') || name.includes('honda')) return 'MOTO';
    if (name.includes('bicicleta') || name.includes('bike')) return 'BIKE';
    
    // Hogar
    if (name.includes('casa') || name.includes('apartamento') || name.includes('vivienda') || name.includes('inmueble')) return 'HOME';
    if (name.includes('refrigerador') || name.includes('nevera') || name.includes('heladera')) return 'FRIDGE';
    if (name.includes('lavadora') || name.includes('secadora')) return 'WASH';
    if (name.includes('horno') || name.includes('microondas') || name.includes('estufa')) return 'COOK';
    if (name.includes('sof√°') || name.includes('mueble') || name.includes('cama')) return 'FURNITURE';
    
    // Educaci√≥n y trabajo
    if (name.includes('curso') || name.includes('educaci√≥n') || name.includes('capacitaci√≥n') || name.includes('universidad')) return 'EDU';
    if (name.includes('libro') || name.includes('manual')) return 'BOOK';
    
    // Salud y deporte
    if (name.includes('bicicleta') || name.includes('gimnasio') || name.includes('deporte')) return 'SPORT';
    if (name.includes('m√©dico') || name.includes('salud') || name.includes('dental')) return 'HEALTH';
    
    // Viajes
    if (name.includes('viaje') || name.includes('vacaciones') || name.includes('vuelo')) return 'TRAVEL';
    if (name.includes('hotel') || name.includes('hospedaje')) return 'HOTEL';
    
    // Servicios
    if (name.includes('seguro') || name.includes('p√≥liza')) return 'INSUR';
    if (name.includes('internet') || name.includes('wifi') || name.includes('plan')) return 'NET';
    
    // Default
    return 'ITEM';
  }

  async generatePDFChartPage(doc) {
    // Paleta moderna y vibrante
    const navy = [33, 47, 61]; 
    const teal = [26, 188, 156];
    const emerald = [46, 204, 113];
    const amber = [243, 156, 18];
    const coral = [231, 76, 60];
    const violet = [155, 89, 182];
    const slate = [52, 73, 94];
    const silver = [189, 195, 199];
    const cream = [253, 254, 254];
    const charcoal = [44, 62, 80];
    
    // === HEADER MODERNO ===
    // Fondo principal con esquinas redondeadas
    doc.setFillColor(...navy);
    doc.rect(0, 0, 210, 50, 'F');
    
    // Acento decorativo superior
    doc.setFillColor(...teal);
    doc.rect(0, 0, 210, 6, 'F');
    
    // T√≠tulo principal
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(20);
    doc.setFont('helvetica', 'light');
    doc.text('Analisis Visual de Pagos', 20, 25);
    
    // Subt√≠tulo
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.text('Distribucion mensual de compromisos financieros', 20, 38);
    
    doc.setTextColor(...charcoal);
    
    // === SECCI√ìN DEL GR√ÅFICO ===
    const canvas = document.getElementById('gastosChart');
    if (canvas && this.chartInstance) {
      try {
        // Generar imagen del gr√°fico con alta calidad
        const chartImage = canvas.toDataURL('image/png', 1.0);
        
        // Marco elegante para el gr√°fico con esquinas redondeadas
        doc.setFillColor(...cream);
        doc.rect(10, 60, 190, 125, 'F');
        
        // Borde decorativo con degradado simulado
        doc.setDrawColor(...teal);
        doc.setLineWidth(2);
        doc.rect(10, 60, 190, 125, 'S');
        
        // Borde interno m√°s sutil
        doc.setDrawColor(...silver);
        doc.setLineWidth(0.5);
        doc.rect(15, 65, 180, 115, 'S');
        doc.setLineWidth(0.2);
        
        // A√±adir imagen del gr√°fico
        doc.addImage(chartImage, 'PNG', 20, 70, 170, 105);
        
        // === INFORMACI√ìN CONTEXTUAL ===
        doc.setFillColor(...teal);
        doc.rect(15, 190, 180, 8, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(9);
        doc.setFont('helvetica', 'bold');
        doc.text('Grafico generado en tiempo real desde la aplicacion', 20, 196);
        
      } catch (error) {
        console.error('Error capturando gr√°fico:', error);
        
        // Dise√±o de error elegante con esquinas redondeadas
        doc.setFillColor(...cream);
        doc.rect(15, 70, 180, 80, 'F');
        
        doc.setDrawColor(...coral);
        doc.setLineWidth(1.5);
        doc.rect(15, 70, 180, 80, 'S');
        doc.setLineWidth(0.2);
        
        doc.setTextColor(...coral);
        doc.setFontSize(16);
        doc.setFont('helvetica', 'bold');
        doc.text('Grafico no disponible', 25, 100);
        
        doc.setTextColor(...charcoal);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        doc.text('El grafico no pudo ser capturado en este momento.', 25, 115);
        doc.text('Asegurate de que el grafico este visible antes de generar el PDF.', 25, 125);
        
        // Consejo √∫til con esquinas redondeadas
        doc.setFillColor(...amber);
        doc.rect(25, 135, 150, 10, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(8);
        doc.setFont('helvetica', 'bold');
        doc.text('Tip: Navega a la seccion de estadisticas antes de exportar', 30, 142);
      }
    } else {
      // Dise√±o cuando no hay gr√°fico con esquinas redondeadas
      doc.setFillColor(...cream);
      doc.rect(15, 70, 180, 80, 'F');
      
      doc.setDrawColor(...silver);
      doc.setLineWidth(1);
      doc.rect(15, 70, 180, 80, 'S');
      doc.setLineWidth(0.2);
      
      doc.setTextColor(...slate);
      doc.setFontSize(16);
      doc.setFont('helvetica', 'normal');
      doc.text('Grafico no inicializado', 25, 105);
      
      doc.setTextColor(...charcoal);
      doc.setFontSize(10);
      doc.text('No hay datos suficientes para generar el grafico estadistico.', 25, 120);
      doc.text('Agrega productos y navega a la seccion de estadisticas.', 25, 130);
    }
    
    // === PANEL DE INSIGHTS ===
    let yPos = 210;
    
    // T√≠tulo de insights con esquinas redondeadas
    doc.setFillColor(...violet);
    doc.rect(15, yPos, 180, 12, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Insights del Grafico', 20, yPos + 8);
    
    yPos += 20;
    
    // Puntos de an√°lisis modernos
    const insights = [
      {
        title: 'Distribucion Temporal',
        description: 'Cada barra muestra el total de compromisos mensuales programados'
      },
      {
        title: 'Codificacion Visual',
        description: 'Los colores ayudan a distinguir periodos y facilitan la lectura'
      },
      {
        title: 'Balance Financiero',
        description: 'Observa la distribucion de carga para planificar mejor tu presupuesto'
      },
      {
        title: 'Tendencias',
        description: 'Identifica patrones en tus compromisos para optimizar futuras decisiones'
      }
    ];
    
    insights.forEach((insight, index) => {
      const x = 20 + (index % 2) * 90;
      const y = yPos + Math.floor(index / 2) * 16;
      
      // Punto de color para cada insight (c√≠rculo con esquinas redondeadas)
      doc.setFillColor(...[teal, emerald, amber, coral][index]);
      doc.circle(x + 3, y + 3, 2, 'F');
      
      doc.setTextColor(...charcoal);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text(`[${index + 1}] ${insight.title}`, x + 8, y + 5);
      
      doc.setFontSize(7);
      doc.setFont('helvetica', 'normal');
      doc.setTextColor(...slate);
      doc.text(insight.description, x + 8, y + 9);
    });
    
    // === NOTA DE NAVEGACI√ìN ===
    yPos += 40;
    doc.setFillColor(...cream);
    doc.rect(15, yPos, 180, 15, 'F');
    
    doc.setDrawColor(...teal);
    doc.setLineWidth(0.8);
    doc.rect(15, yPos, 180, 15, 'S');
    doc.setLineWidth(0.2);
    
    doc.setTextColor(...teal);
    doc.setFontSize(9);
    doc.setFont('helvetica', 'bold');
    doc.text('Proxima seccion:', 20, yPos + 6);
    
    doc.setTextColor(...charcoal);
    doc.setFont('helvetica', 'normal');
    doc.text('Cronograma detallado con tarjetas mensuales organizadas', 20, yPos + 11);
  }

  async generatePDFMonthlyCards(doc) {
    // Paleta moderna y vibrante
    const navy = [33, 47, 61]; 
    const teal = [26, 188, 156];
    const emerald = [46, 204, 113];
    const amber = [243, 156, 18];
    const coral = [231, 76, 60];
    const violet = [155, 89, 182];
    const slate = [52, 73, 94];
    const silver = [189, 195, 199];
    const cream = [253, 254, 254];
    const charcoal = [44, 62, 80];
    
    const monthlyData = this.generateMonthlyBreakdown();
    
    doc.addPage();
    
    // === HEADER PREMIUM ===
    doc.setFillColor(...navy);
    doc.rect(0, 0, 210, 50, 'F');
    
    // Acento superior decorativo
    doc.setFillColor(...emerald);
    doc.rect(0, 0, 210, 6, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(20);
    doc.setFont('helvetica', 'light');
    doc.text('Cronograma Financiero', 20, 25);
    
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.text('Planificaci√≥n mensual detallada de tus compromisos', 20, 38);
    
    doc.setTextColor(...charcoal);
    
    let yPos = 60;
    let currentPage = 1;
    
    // === RESUMEN ESTAD√çSTICO INICIAL ===
    if (monthlyData.length > 0) {
      // Calcular estad√≠sticas
      const totalMonths = monthlyData.length;
      const avgMonthly = monthlyData.reduce((sum, month) => sum + month.total, 0) / totalMonths;
      const maxMonth = Math.max(...monthlyData.map(month => month.total));
      const minMonth = Math.min(...monthlyData.map(month => month.total));
      
      // Panel de estad√≠sticas
      doc.setFillColor(...cream);
      doc.rect(15, yPos, 180, 25, 'F');
      
      doc.setDrawColor(...emerald);
      doc.setLineWidth(1);
      doc.rect(15, yPos, 180, 25, 'S');
      doc.setLineWidth(0.2);
      
      // L√≠nea superior decorativa
      doc.setFillColor(...emerald);
      doc.rect(15, yPos, 180, 3, 'F');
      
      doc.setTextColor(...charcoal);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text('Resumen del Cronograma', 20, yPos + 10);
      
      doc.setFontSize(8);
      doc.setFont('helvetica', 'normal');
      doc.setTextColor(...slate);
      
      // Estad√≠sticas en l√≠nea
      doc.text(`${totalMonths} meses programados`, 20, yPos + 16);
      doc.text(`Promedio: ${Math.round(avgMonthly).toLocaleString('es-CO')}`, 65, yPos + 16);
      doc.text(`M√°ximo: ${Math.round(maxMonth).toLocaleString('es-CO')}`, 120, yPos + 16);
      doc.text(`M√≠nimo: ${Math.round(minMonth).toLocaleString('es-CO')}`, 170, yPos + 16);
      
      doc.setTextColor(...emerald);
      doc.text(`Organizaci√≥n inteligente para ${totalMonths} meses de compromisos`, 20, yPos + 21);
      
      yPos += 35;
    }
    
    // === TARJETAS MENSUALES PREMIUM ===
    monthlyData.forEach((monthData, index) => {
      // Nueva p√°gina si es necesario
      if (yPos > 220) {
        doc.addPage();
        currentPage++;
        yPos = 30;
        
        // Header mini en p√°ginas adicionales
        doc.setFillColor(...navy);
        doc.rect(0, 0, 210, 25, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(14);
        doc.setFont('helvetica', 'normal');
        doc.text(`Cronograma - P√°gina ${currentPage}`, 20, 16);
        
        doc.setTextColor(...charcoal);
        yPos = 35;
      }
      
      // Dibujar tarjeta moderna
      this.drawModernMonthlyCard(doc, monthData, 15, yPos, index);
      yPos += 42; // Altura optimizada
    });
    
    // === MENSAJE CUANDO NO HAY DATOS ===
    if (monthlyData.length === 0) {
      doc.setFillColor(...cream);
      doc.rect(15, yPos, 180, 50, 'F');
      
      doc.setDrawColor(...silver);
      doc.setLineWidth(1);
      doc.rect(15, yPos, 180, 50, 'S');
      doc.setLineWidth(0.2);
      
      doc.setTextColor(...slate);
      doc.setFontSize(18);
      doc.setFont('helvetica', 'light');
      doc.text('üì≠ Cronograma vac√≠o', 25, yPos + 20);
      
      doc.setTextColor(...charcoal);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      doc.text('No hay compromisos financieros programados en el tiempo.', 25, yPos + 32);
      
      doc.setTextColor(...teal);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'italic');
      doc.text('üí° Agrega productos con fechas para ver la planificaci√≥n detallada', 25, yPos + 42);
    }
    
    // === P√ÅGINA DE CONSEJOS FINANCIEROS ===
    if (monthlyData.length > 0) {
      doc.addPage();
      this.generateFinancialTipsPage(doc, monthlyData);
    }
  }

  drawModernMonthlyCard(doc, monthData, x, y, cardIndex) {
    const cardWidth = 180;
    const cardHeight = 38;
    
    // Paleta moderna para las tarjetas
    const navy = [33, 47, 61]; 
    const teal = [26, 188, 156];
    const emerald = [46, 204, 113];
    const amber = [243, 156, 18];
    const coral = [231, 76, 60];
    const violet = [155, 89, 182];
    const slate = [52, 73, 94];
    const silver = [189, 195, 199];
    const cream = [253, 254, 254];
    const charcoal = [44, 62, 80];
    
    // Colores rotativos para cada tarjeta
    const cardColors = [teal, emerald, amber, coral, violet, navy];
    const cardColor = cardColors[cardIndex % cardColors.length];
    
    // === FONDO PRINCIPAL ===
    doc.setFillColor(...cream);
    doc.rect(x, y, cardWidth, cardHeight, 'F');
    
    // === BORDE MODERNO ===
    doc.setDrawColor(...cardColor);
    doc.setLineWidth(0.8);
    doc.rect(x, y, cardWidth, cardHeight, 'S');
    doc.setLineWidth(0.2);
    
    // === BANDA LATERAL COLORIDA ===
    doc.setFillColor(...cardColor);
    doc.rect(x, y, 4, cardHeight, 'F');
    
    // === INFORMACI√ìN DEL MES ===
    const monthNames = [
      'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
    ];
    const monthName = `${monthNames[monthData.date.getMonth()]} ${monthData.date.getFullYear()}`;
    
    // Header del mes con fondo sutil
    doc.setFillColor(255, 255, 255);
    doc.rect(x + 8, y + 4, cardWidth - 12, 12, 'F');
    
    // Emoji y nombre del mes
    doc.setTextColor(...charcoal);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(8);
    doc.text('FECHA', x + 8, y + 11);
    doc.text(monthName, x + 20, y + 11);
    
    // Total del mes con estilo destacado
    doc.setTextColor(...cardColor);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    const totalText = `$${Math.round(monthData.total).toLocaleString('es-CO')}`;
    const totalWidth = doc.getTextWidth(totalText);
    doc.text(totalText, x + cardWidth - totalWidth - 12, y + 11);
    
    // === PRODUCTOS DEL MES ===
    doc.setTextColor(...charcoal);
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(8);
    
    let productY = y + 20;
    const maxProducts = Math.min(2, monthData.products.length);
    
    for (let i = 0; i < maxProducts; i++) {
      const product = monthData.products[i];
      
      // Tipo del producto usando la funci√≥n auxiliar
      const productType = this.getProductType(product.name);
      
      // Nombre del producto (optimizado)
      const maxLength = 28;
      const productName = product.name.length > maxLength ? 
        product.name.substring(0, maxLength) + '...' : product.name;
      
      // Informaci√≥n del producto
      doc.setTextColor(...charcoal);
      doc.text(productName, x + 12, productY);
      
      // Detalles financieros con colores
      doc.setTextColor(...silver);
      doc.setFontSize(7);
      const paymentInfo = `$${Math.round(product.payment).toLocaleString('es-CO')} ‚Ä¢ Cuota ${product.installmentNumber}/${product.totalInstallments}`;
      doc.text(paymentInfo, x + 110, productY);
      
      productY += 8;
    }
    
    // === PRODUCTOS ADICIONALES ===
    if (monthData.products.length > 2) {
      doc.setTextColor(...silver);
      doc.setFont('helvetica', 'italic');
      doc.setFontSize(7);
      doc.text(`+ ${monthData.products.length - 2} productos m√°s`, x + 12, productY);
    }
    
    // === INDICADOR DE CARGA ===
    // Calcular intensidad del mes para mostrar indicador visual
    const allTotals = this.generateMonthlyBreakdown().map(m => m.total);
    const maxTotal = Math.max(...allTotals);
    const intensity = monthData.total / maxTotal;
    
    // Barra de intensidad
    const barWidth = 30;
    const filledWidth = barWidth * intensity;
    
    doc.setFillColor(...silver);
    doc.rect(x + cardWidth - 40, y + cardHeight - 6, barWidth, 2, 'F');
    
    doc.setFillColor(...cardColor);
    doc.rect(x + cardWidth - 40, y + cardHeight - 6, filledWidth, 2, 'F');
  }

  generateFinancialTipsPage(doc, monthlyData) {
    // Paleta moderna
    const navy = [33, 47, 61]; 
    const teal = [26, 188, 156];
    const emerald = [46, 204, 113];
    const amber = [243, 156, 18];
    const coral = [231, 76, 60];
    const violet = [155, 89, 182];
    const slate = [52, 73, 94];
    const silver = [189, 195, 199];
    const cream = [253, 254, 254];
    const charcoal = [44, 62, 80];
    
    // === HEADER PREMIUM ===
    doc.setFillColor(...violet);
    doc.rect(0, 0, 210, 50, 'F');
    
    // Acento superior
    doc.setFillColor(...amber);
    doc.rect(0, 0, 210, 6, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(20);
    doc.setFont('helvetica', 'light');
    doc.text('üí° Consejos Financieros', 20, 25);
    
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.text('Recomendaciones personalizadas para tu perfil econ√≥mico', 20, 38);
    
    // === AN√ÅLISIS PERSONALIZADO ===
    let yPos = 65;
    const totalMonthly = monthlyData.reduce((sum, month) => sum + month.total, 0) / monthlyData.length;
    const totalProducts = this.state.products.length;
    const totalInvestment = this.state.products.reduce((sum, p) => sum + p.totalValue, 0);
    
    // Panel de perfil
    doc.setFillColor(...cream);
    doc.rect(15, yPos, 180, 30, 'F');
    
    doc.setDrawColor(...violet);
    doc.setLineWidth(1);
    doc.rect(15, yPos, 180, 30, 'S');
    doc.setLineWidth(0.2);
    
    // L√≠nea superior decorativa
    doc.setFillColor(...violet);
    doc.rect(15, yPos, 180, 4, 'F');
    
    doc.setTextColor(...charcoal);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('üéØ Tu Perfil Financiero', 20, yPos + 12);
    
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(...slate);
    
    // Estad√≠sticas del perfil
    doc.text(`üí∞ Compromiso mensual promedio: $${Math.round(totalMonthly).toLocaleString('es-CO')}`, 20, yPos + 19);
    doc.text(`üì¶ ${totalProducts} productos en tu portafolio`, 20, yPos + 25);
    doc.text(`üíé Inversi√≥n total: $${totalInvestment.toLocaleString('es-CO')}`, 110, yPos + 19);
    doc.text(`${monthlyData.length} meses de planificaci√≥n`, 110, yPos + 25);
    
    yPos += 40;
    
    // === CONSEJOS PERSONALIZADOS ===
    const tips = [
      {
        emoji: 'üö®',
        title: 'Fondo de Emergencia',
        description: `Ahorra $${Math.round(totalMonthly * 0.2).toLocaleString('es-CO')} mensuales`,
        detail: 'Equivale al 20% de tus compromisos mensuales',
        color: coral,
        priority: 'ALTA'
      },
      {
        emoji: '‚è∞',
        title: 'Alertas Inteligentes',
        description: 'Configura recordatorios 3-5 d√≠as antes de cada pago',
        detail: 'Evita cargos por mora y mant√©n tu historial crediticio',
        color: amber,
        priority: 'MEDIA'
      },
      {
        emoji: 'üìä',
        title: 'Revisi√≥n Mensual',
        description: 'Analiza tu progreso cada 30 d√≠as',
        detail: 'Ajusta tu presupuesto seg√∫n cambios en ingresos',
        color: teal,
        priority: 'MEDIA'
      },
      {
        emoji: '‚ö°',
        title: 'Pagos Anticipados',
        description: 'Considera abonos extra cuando sea posible',
        detail: 'Reduce el tiempo total de financiamiento',
        color: emerald,
        priority: 'BAJA'
      },
      {
        emoji: 'üéØ',
        title: 'Planificaci√≥n Estrat√©gica',
        description: 'Evita nuevos compromisos en meses pesados',
        detail: 'Distribuye la carga financiera de manera inteligente',
        color: violet,
        priority: 'ALTA'
      },
      {
        emoji: 'üìà',
        title: 'Diversificaci√≥n',
        description: 'No concentres todos los pagos en las mismas fechas',
        detail: 'Distribuye los vencimientos a lo largo del mes',
        color: navy,
        priority: 'MEDIA'
      }
    ];
    
    tips.forEach((tip, index) => {
      const x = 15 + (index % 2) * 90;
      const y = yPos + Math.floor(index / 2) * 32;
      
      // Tarjeta del consejo
      doc.setFillColor(255, 255, 255);
      doc.rect(x, y, 85, 28, 'F');
      
      // Borde colorido
      doc.setDrawColor(...tip.color);
      doc.setLineWidth(1);
      doc.rect(x, y, 85, 28, 'S');
      doc.setLineWidth(0.2);
      
      // Acento lateral
      doc.setFillColor(...tip.color);
      doc.rect(x, y, 3, 28, 'F');
      
      // Prioridad
      doc.setFillColor(...tip.color);
      doc.rect(x + 65, y + 2, 18, 6, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(5);
      doc.setFont('helvetica', 'bold');
      doc.text(tip.priority, x + 66, y + 6);
      
      // Emoji y t√≠tulo
      doc.setTextColor(...charcoal);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text(`${tip.emoji} ${tip.title}`, x + 6, y + 10);
      
      // Descripci√≥n
      doc.setTextColor(...slate);
      doc.setFontSize(7);
      doc.setFont('helvetica', 'normal');
      doc.text(tip.description, x + 6, y + 16);
      
      // Detalle
      doc.setTextColor(...tip.color);
      doc.setFontSize(6);
      doc.setFont('helvetica', 'italic');
      doc.text(tip.detail, x + 6, y + 22);
    });
    
    // === MENSAJE MOTIVACIONAL FINAL ===
    yPos += 105;
    
    doc.setFillColor(...emerald);
    doc.rect(15, yPos, 180, 25, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(14);
    doc.setFont('helvetica', 'bold');
    doc.text('üåü ¬°Excelente Planificaci√≥n!', 20, yPos + 10);
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text('Has dado un paso importante hacia la estabilidad financiera.', 20, yPos + 17);
    doc.text('Contin√∫a monitoreando y ajustando tu estrategia seg√∫n tus objetivos.', 20, yPos + 22);
    
    // === PIE DE P√ÅGINA ELEGANTE ===
    yPos += 35;
    
    doc.setFillColor(...cream);
    doc.rect(15, yPos, 180, 20, 'F');
    
    doc.setDrawColor(...teal);
    doc.setLineWidth(0.5);
    doc.rect(15, yPos, 180, 20, 'S');
    doc.setLineWidth(0.2);
    
    doc.setTextColor(...teal);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'bold');
    doc.text('üôè Gracias por usar la Calculadora de Cuotas', 20, yPos + 8);
    
    doc.setTextColor(...charcoal);
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.text('Herramienta desarrollada para optimizar tu gesti√≥n financiera personal', 20, yPos + 14);
    
    // Marca de tiempo del reporte
    const now = new Date();
    const timestamp = now.toLocaleString('es-CO');
    doc.setTextColor(...silver);
    doc.setFontSize(7);
    doc.text(`Reporte generado: ${timestamp}`, 140, yPos + 17);
  }

  generateElegantSummaryPage(doc, monthlyData) {
    // Paleta minimalista
    const primary = [52, 73, 94];
    const accent = [74, 144, 226];
    const success = [46, 204, 113];
    const warning = [241, 196, 15];
    const lightGray = [248, 249, 250];
    const mediumGray = [149, 165, 166];
    const darkText = [44, 62, 80];
    
    // === HEADER ===
    doc.setFillColor(...success);
    doc.rect(0, 0, 210, 45, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(18);
    doc.setFont('helvetica', 'light');
    doc.text('üí° CONSEJOS FINANCIEROS', 20, 22);
    
    doc.setFontSize(11);
    doc.setFont('helvetica', 'normal');
    doc.text('Recomendaciones personalizadas para tu perfil', 20, 35);
    
    // === AN√ÅLISIS PERSONAL ===
    let yPos = 65;
    const totalMonthly = monthlyData.reduce((sum, month) => sum + month.total, 0) / monthlyData.length;
    
    doc.setFillColor(...lightGray);
    doc.rect(15, yPos, 180, 25, 'F');
    
    doc.setTextColor(...accent);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('üìä TU PERFIL FINANCIERO', 20, yPos + 10);
    
    doc.setTextColor(...darkText);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text(`üí∞ Pago mensual promedio: $${Math.round(totalMonthly).toLocaleString('es-CO')}`, 20, yPos + 18);
    doc.text(`Meses con pagos: ${monthlyData.length}`, 110, yPos + 18);
    
    yPos += 35;
    
    // === CONSEJOS MINIMALISTAS ===
    const tips = [
      {
        emoji: 'üö®',
        title: 'Fondo de Emergencia',
        description: `Ahorra $${Math.round(totalMonthly * 0.2).toLocaleString('es-CO')} mensuales (20% de tus pagos)`,
        color: warning
      },
      {
        emoji: '‚è∞',
        title: 'Recordatorios Inteligentes',
        description: 'Configura alertas 3 d√≠as antes de cada fecha de pago',
        color: accent
      },
      {
        emoji: 'üìà',
        title: 'Revisi√≥n Mensual',
        description: 'Analiza tu progreso y ajusta tu presupuesto regularmente',
        color: primary
      },
      {
        emoji: '‚ö°',
        title: 'Pagos Adelantados',
        description: 'Considera pagos extra cuando tengas ingresos adicionales',
        color: success
      }
    ];
    
    tips.forEach((tip, index) => {
      // Borde sutil colorido
      doc.setDrawColor(...tip.color);
      doc.setLineWidth(0.8);
      doc.rect(15, yPos, 180, 20, 'S');
      doc.setLineWidth(0.2);
      
      // Emoji y t√≠tulo
      doc.setTextColor(...darkText);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'bold');
      doc.text(`${tip.emoji} ${tip.title}`, 20, yPos + 8);
      
      // Descripci√≥n
      doc.setTextColor(...mediumGray);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.text(tip.description, 20, yPos + 15);
      
      // L√≠nea de color
      doc.setDrawColor(...tip.color);
      doc.setLineWidth(2);
      doc.line(20, yPos + 17, 185, yPos + 17);
      
      yPos += 30;
    });
    
    // === MENSAJE FINAL ELEGANTE ===
    yPos += 10;
    doc.setFillColor(...lightGray);
    doc.rect(15, yPos, 180, 20, 'F');
    
    doc.setTextColor(...primary);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'bold');
    doc.text('üôè Gracias por usar la Calculadora de Cuotas', 20, yPos + 8);
    
    doc.setTextColor(...darkText);
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.text('Gestiona tus finanzas de manera inteligente. ¬°Que tengas un excelente d√≠a!', 20, yPos + 15);
  }

  drawEnhancedMonthlyCard(doc, monthData, x, y, cardIndex) {
    const cardWidth = 180;
    const cardHeight = 55;
    
    // Colores vibrantes
    const gradientBlue = [102, 126, 234];
    const gradientPurple = [118, 75, 162];
    const vibrantGreen = [76, 175, 80];
    const vibrantOrange = [255, 152, 0];
    const vibrantRed = [244, 67, 54];
    const vibrantCyan = [0, 188, 212];
    const darkText = [51, 51, 51];
    
    // Seleccionar color de tema para la tarjeta (rotativo)
    const themeColors = [gradientBlue, gradientPurple, vibrantCyan, vibrantGreen, vibrantOrange];
    const themeColor = themeColors[cardIndex % themeColors.length];
    const lightThemeColor = this.lightenColor(themeColor, 0.9);
    
    // === SOMBRA DE LA TARJETA ===
    doc.setFillColor(200, 200, 200);
    doc.roundedRect(x + 2, y + 2, cardWidth, cardHeight, 4, 4, 'F');
    
    // === FONDO PRINCIPAL DE LA TARJETA ===
    doc.setFillColor(255, 255, 255);
    doc.roundedRect(x, y, cardWidth, cardHeight, 4, 4, 'F');
    
    // === BORDE COLORIDO HERMOSO ===
    doc.setDrawColor(...themeColor);
    doc.setLineWidth(2);
    doc.roundedRect(x, y, cardWidth, cardHeight, 4, 4, 'S');
    doc.setLineWidth(0.2);
    
    // === HEADER DE LA TARJETA CON GRADIENTE SIMULADO ===
    doc.setFillColor(...themeColor);
    doc.roundedRect(x, y, cardWidth, 18, 4, 4, 'F');
    
    // Rect√°ngulo blanco para cortar las esquinas inferiores del header
    doc.setFillColor(255, 255, 255);
    doc.rect(x, y + 14, cardWidth, 4, 'F');
    
    // === INFORMACI√ìN DEL MES EN EL HEADER ===
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    
    const monthNames = [
      'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
    ];
    const monthName = `${monthNames[monthData.date.getMonth()]} ${monthData.date.getFullYear()}`;
    
    // Emoji del calendario simulado
    doc.setFillColor(255, 255, 255);
    doc.circle(x + 8, y + 9, 3, 'F');
    doc.setTextColor(...themeColor);
    doc.setFontSize(8);
    doc.text('CAL', x + 6, y + 10);
    
    // Nombre del mes
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(12);
    doc.text(monthName, x + 18, y + 11);
    
    // Total del mes destacado
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(14);
    const totalText = `$${Math.round(monthData.total).toLocaleString('es-CO')}`;
    const totalWidth = doc.getTextWidth(totalText);
    doc.text(totalText, x + cardWidth - totalWidth - 10, y + 11);
    
    // === CONTENIDO DE LA TARJETA ===
    doc.setTextColor(...darkText);
    let contentY = y + 25;
    
    // Mostrar productos con √≠conos coloridos
    const maxProducts = Math.min(3, monthData.products.length);
    
    for (let i = 0; i < maxProducts; i++) {
      const product = monthData.products[i];
      
      // Color √∫nico para cada producto
      const productColors = [vibrantGreen, vibrantCyan, vibrantOrange, vibrantRed, gradientPurple];
      const productColor = productColors[i % productColors.length];
      
      // C√≠rculo colorido para el producto (emoji simulado)
      doc.setFillColor(...productColor);
      doc.circle(x + 8, contentY + 3, 2.5, 'F');
      
      // Nombre del producto
      doc.setTextColor(...darkText);
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(9);
      const productName = product.name.length > 25 ? product.name.substring(0, 25) + '...' : product.name;
      doc.text(productName, x + 15, contentY + 4);
      
      // Informaci√≥n de la cuota con fondo colorido
      doc.setFillColor(...this.lightenColor(productColor, 0.8));
      doc.roundedRect(x + 95, contentY, 35, 8, 1, 1, 'F');
      doc.setTextColor(...productColor);
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(8);
      doc.text(`$${Math.round(product.payment).toLocaleString('es-CO')}`, x + 97, contentY + 5);
      
      // N√∫mero de cuota
      doc.setFillColor(...this.lightenColor(themeColor, 0.8));
      doc.roundedRect(x + 135, contentY, 40, 8, 1, 1, 'F');
      doc.setTextColor(...themeColor);
      doc.text(`Cuota ${product.installmentNumber}/${product.totalInstallments}`, x + 137, contentY + 5);
      
      contentY += 10;
    }
    
    // === PRODUCTOS ADICIONALES ===
    if (monthData.products.length > 3) {
      doc.setFillColor(...this.lightenColor(themeColor, 0.9));
      doc.roundedRect(x + 8, contentY, 165, 8, 1, 1, 'F');
      doc.setTextColor(...themeColor);
      doc.setFont('helvetica', 'italic');
      doc.setFontSize(8);
      doc.text(`... y ${monthData.products.length - 3} productos mas`, x + 12, contentY + 5);
    }
    
    // === BARRA DE PROGRESO VISUAL ===
    const progressY = y + cardHeight - 8;
    const progressWidth = (cardWidth - 20) * Math.min(1, cardIndex / 12); // Simular progreso temporal
    
    // Fondo de la barra
    doc.setFillColor(240, 240, 240);
    doc.roundedRect(x + 10, progressY, cardWidth - 20, 4, 2, 2, 'F');
    
    // Progreso coloreado
    if (progressWidth > 0) {
      doc.setFillColor(...themeColor);
      doc.roundedRect(x + 10, progressY, progressWidth, 4, 2, 2, 'F');
    }
  }

  // Funci√≥n auxiliar para aclarar colores
  lightenColor(color, factor) {
    return color.map(c => Math.min(255, Math.round(c + (255 - c) * factor)));
  }

  // Nueva p√°gina de consejos financieros
  generateFinancialTipsPage(doc, monthlyData) {
    const gradientBlue = [102, 126, 234];
    const gradientPurple = [118, 75, 162];
    const vibrantGreen = [76, 175, 80];
    const vibrantOrange = [255, 152, 0];
    const darkText = [51, 51, 51];
    
    // === HEADER DE CONSEJOS ===
    doc.setFillColor(...vibrantGreen);
    doc.rect(0, 0, 210, 50, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(20);
    doc.setFont('helvetica', 'bold');
    doc.text('CONSEJOS FINANCIEROS PERSONALIZADOS', 20, 25);
    
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.text('Recomendaciones basadas en tu perfil financiero', 20, 40);
    
    // === AN√ÅLISIS PERSONALIZADO ===
    let yPos = 70;
    const totalMonthly = monthlyData.reduce((sum, month) => sum + month.total, 0) / monthlyData.length;
    
    // Tarjeta de an√°lisis
    doc.setFillColor(232, 245, 233); // verde claro
    doc.roundedRect(15, yPos, 180, 30, 3, 3, 'F');
    
    doc.setTextColor(...vibrantGreen);
    doc.setFontSize(14);
    doc.setFont('helvetica', 'bold');
    doc.text('TU PERFIL FINANCIERO:', 20, yPos + 10);
    
    doc.setTextColor(...darkText);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'normal');
    doc.text(`Promedio mensual: $${Math.round(totalMonthly).toLocaleString('es-CO')}`, 20, yPos + 20);
    doc.text(`Meses con pagos: ${monthlyData.length}`, 20, yPos + 27);
    
    yPos += 45;
    
    // === CONSEJOS ESPEC√çFICOS ===
    const tips = [
      {
        icon: 'emergency',
        title: 'Fondo de Emergencia',
        description: 'Mant√©n ahorrado el 20% de tu pago mensual total para imprevistos.',
        amount: Math.round(totalMonthly * 0.2),
        color: vibrantOrange
      },
      {
        icon: 'reminder',
        title: 'Recordatorios Inteligentes',
        description: 'Programa alertas 3 d√≠as antes de cada pago para estar preparado.',
        color: gradientBlue
      },
      {
        icon: 'review',
        title: 'Revisi√≥n Mensual',
        description: 'Analiza tu progreso cada mes y ajusta tu presupuesto seg√∫n sea necesario.',
        color: gradientPurple
      },
      {
        icon: 'optimization',
        title: 'Optimizaci√≥n de Pagos',
        description: 'Considera pagos adelantados cuando tengas ingresos extra disponibles.',
        color: vibrantGreen
      }
    ];
    
    tips.forEach((tip, index) => {
      // Tarjeta de consejo
      doc.setFillColor(...this.lightenColor(tip.color, 0.9));
      doc.roundedRect(15, yPos, 180, 25, 2, 2, 'F');
      
      // √çcono circular
      doc.setFillColor(...tip.color);
      doc.circle(25, yPos + 12, 5, 'F');
      
      // T√≠tulo
      doc.setTextColor(...tip.color);
      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      doc.text(tip.title, 35, yPos + 10);
      
      // Descripci√≥n
      doc.setTextColor(...darkText);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.text(tip.description, 35, yPos + 17);
      
      // Monto espec√≠fico si aplica
      if (tip.amount) {
        doc.setTextColor(...tip.color);
        doc.setFont('helvetica', 'bold');
        doc.text(`Sugerencia: $${tip.amount.toLocaleString('es-CO')}`, 35, yPos + 22);
      }
      
      yPos += 35;
    });
    
    // === MENSAJE DE DESPEDIDA ===
    yPos += 10;
    doc.setFillColor(224, 247, 250); // cyan claro
    doc.roundedRect(15, yPos, 180, 25, 3, 3, 'F');
    
    doc.setTextColor(...gradientBlue);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Gracias por usar la Calculadora de Cuotas!', 20, yPos + 10);
    
    doc.setTextColor(...darkText);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text('Esperamos que este reporte te ayude a mantener un mejor control', 20, yPos + 18);
    doc.text('de tus finanzas. Que tengas un excelente d√≠a!', 20, yPos + 24);
  }

  generateMonthlyBreakdown() {
    const monthlyMap = new Map();
    
    this.state.products.forEach(product => {
      const startDate = new Date(product.startDate);
      const monthlyPayment = product.monthlyPayment;
      
      for (let i = 0; i < product.installments; i++) {
        const paymentDate = new Date(startDate.getFullYear(), startDate.getMonth() + i, 1);
        const monthKey = `${paymentDate.getFullYear()}-${(paymentDate.getMonth() + 1).toString().padStart(2, '0')}`;
        
        if (!monthlyMap.has(monthKey)) {
          monthlyMap.set(monthKey, {
            date: paymentDate,
            monthKey,
            products: [],
            total: 0
          });
        }
        
        const monthData = monthlyMap.get(monthKey);
        monthData.products.push({
          name: product.name,
          payment: monthlyPayment,
          installmentNumber: i + 1,
          totalInstallments: product.installments,
          remaining: product.installments - (i + 1)
        });
        monthData.total += monthlyPayment;
      }
    });
    
    // Convertir a array y ordenar por fecha (sin s√≠mbolos especiales)
    return Array.from(monthlyMap.values())
      .sort((a, b) => a.date.getTime() - b.date.getTime())
      .map(item => ({
        ...item,
        // Asegurar que los n√∫meros est√©n redondeados correctamente
        total: Math.round(item.total * 100) / 100,
        products: item.products.map(product => ({
          ...product,
          payment: Math.round(product.payment * 100) / 100
        }))
      }));
  }

  editProduct(id) {
    const product = this.state.products.find(p => p.id === id);
    if (!product) return;

    // Cargar datos en el modal con formato latinoamericano
    document.getElementById('modal-nombre').value = product.name;
    document.getElementById('modal-valor').value = this.formatLatinNumber(product.totalValue);
    document.getElementById('modal-cuotas').value = product.installments;
    document.getElementById('modal-fecha').value = product.startDate.toISOString().split('T')[0];

    // Guardar ID para edici√≥n
    this.currentEditingId = id;

    // Mostrar modal
    this.openModal('editModal');
  }

  saveEditedProduct() {
    if (!this.currentEditingId) return;

    const nombre = document.getElementById('modal-nombre').value;
    const valorStr = document.getElementById('modal-valor').value;
    const cuotas = parseInt(document.getElementById('modal-cuotas').value);
    const fecha = document.getElementById('modal-fecha').value;

    // Usar la nueva funci√≥n de parseo latinoamericano
    const valor = this.parseLatinNumber(valorStr);

    if (!nombre || !this.isValidNumber(valorStr) || !cuotas || !fecha) {
      this.showNotification('error', 'Error de validaci√≥n', 'Por favor completa todos los campos con valores v√°lidos');
      return;
    }

    if (valor <= 0) {
      this.showNotification('error', 'Valor inv√°lido', 'El valor del producto debe ser mayor a 0');
      return;
    }

    if (cuotas <= 0) {
      this.showNotification('error', 'Cuotas inv√°lidas', 'El n√∫mero de cuotas debe ser mayor a 0');
      return;
    }

    const productIndex = this.state.products.findIndex(p => p.id === this.currentEditingId);
    if (productIndex === -1) return;

    const startDate = new Date(fecha);
    const endDate = new Date(startDate);
    endDate.setMonth(endDate.getMonth() + cuotas);

    this.state.products[productIndex] = {
      ...this.state.products[productIndex],
      name: nombre,
      totalValue: valor,
      installments: cuotas,
      startDate: startDate,
      endDate: endDate,
      monthlyPayment: valor / cuotas
    };

    this.saveProducts();
    this.renderProducts();
    this.updateStats();
    this.closeModal('editModal');
    this.currentEditingId = null;
    
    // Mostrar notificaci√≥n de √©xito con valor formateado
    try {
      this.showNotification('success', '¬°Producto actualizado!', 
        `"${nombre}" por $${this.formatLatinNumber(valor)} se ha modificado correctamente`);
    } catch (error) {
      console.error('‚ùå Error en showNotification:', error);
      // Fallback
      alert(`‚úÖ Producto actualizado: "${nombre}" por $${this.formatLatinNumber(valor)}`);
    }
  }

  deleteProduct(id) {
    const product = this.state.products.find(p => p.id === id);
    if (!product) return;

    // Mostrar nombre del producto en el modal de confirmaci√≥n
    document.getElementById('confirm-product-name').textContent = product.name;
    
    // Guardar ID para eliminaci√≥n
    this.currentDeletingId = id;

    // Mostrar modal de confirmaci√≥n normal
    this.openModal('confirmModal');
  }

  confirmDelete() {
    if (!this.currentDeletingId) return;

    const product = this.state.products.find(p => p.id === this.currentDeletingId);
    const productName = product ? product.name : 'Producto';

    this.state.products = this.state.products.filter(p => p.id !== this.currentDeletingId);
    this.saveProducts();
    this.renderProducts();
    this.updateStats();
    this.closeModal('confirmModal');
    this.currentDeletingId = null;
    
    // Mostrar notificaci√≥n de eliminaci√≥n
    try {
      this.showNotification('warning', 'Producto eliminado', `"${productName}" se ha eliminado correctamente`);
    } catch (error) {
      console.error('‚ùå Error en showNotification:', error);
      // Fallback
      alert(`‚ö†Ô∏è Producto eliminado: "${productName}"`);
    }
  }

  handleDeleteAllProducts() {
    if (this.state.products.length === 0) {
      try {
        this.showNotification('info', 'Sin productos', 'No hay productos para eliminar');
      } catch (error) {
        console.error('‚ùå Error en showNotification:', error);
        alert('‚ÑπÔ∏è No hay productos para eliminar');
      }
      return;
    }

    const productCount = this.state.products.length;
    
    // Crear modal de confirmaci√≥n personalizado para eliminar todos
    if (confirm(`¬øEst√°s seguro de que deseas eliminar TODOS los ${productCount} productos?\n\nEsta acci√≥n no se puede deshacer.`)) {
      this.state.products = [];
      this.saveProducts();
      this.renderProducts();
      this.updateStats();
      
      // Mostrar notificaci√≥n de eliminaci√≥n masiva
      try {
        this.showNotification('warning', 'Productos eliminados', `Se eliminaron ${productCount} productos correctamente`);
      } catch (error) {
        console.error('‚ùå Error en showNotification:', error);
        // Fallback
        alert(`‚ö†Ô∏è Se eliminaron ${productCount} productos correctamente`);
      }
    }
  }

  openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      // Mostrar el modal sin animaci√≥n primero
      modal.style.display = 'flex';
      
      // Remover clases anteriores de animaci√≥n
      modal.classList.remove('closing');
      
      // Usar requestAnimationFrame para asegurar que el display se aplique antes de la animaci√≥n
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          modal.classList.add('show');
        });
      });
      
      // Agregar clase al body para prevenir scroll
      document.body.style.overflow = 'hidden';
    }
  }

  closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      // A√±adir clase de cierre para animaci√≥n de salida
      modal.classList.add('closing');
      modal.classList.remove('show');
      
      // Esperar a que termine la animaci√≥n antes de ocultar
      setTimeout(() => {
        modal.style.display = 'none';
        modal.classList.remove('closing');
        
        // Restaurar scroll del body
        document.body.style.overflow = '';
      }, 400); // 400ms coincide con la nueva duraci√≥n de la transici√≥n CSS
    }
  }

  showLoading() {
    const loading = document.getElementById('loadingIndicator');
    if (loading) {
      loading.style.display = 'flex';
    }
  }

  hideLoading() {
    const loading = document.getElementById('loadingIndicator');
    if (loading) {
      loading.style.display = 'none';
    }
  }

  showError(message) {
    this.showNotification('error', 'Error', message);
  }

  // Sistema de notificaciones flotantes
  showNotification(type = 'info', title = '', message = '', duration = 5000) {
    console.log(`üîî NOTIFICACI√ìN: ${type} - ${title} - ${message}`);
    
    const container = document.getElementById('notificationContainer');
    if (!container) {
      console.error('‚ùå CR√çTICO: Contenedor de notificaciones no encontrado');
      console.log('üìç Buscando contenedor...');
      console.log('- document.getElementById:', document.getElementById('notificationContainer'));
      console.log('- querySelector:', document.querySelector('#notificationContainer'));
      
      // Fallback: usar alert si no hay contenedor
      alert(`${title}: ${message}`);
      return;
    }

    console.log('‚úÖ Contenedor encontrado, creando notificaci√≥n...');

    // Crear elemento de notificaci√≥n
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    // Definir iconos seg√∫n el tipo
    const icons = {
      success: 'fas fa-check-circle',
      error: 'fas fa-exclamation-circle',
      warning: 'fas fa-exclamation-triangle',
      info: 'fas fa-info-circle'
    };

    notification.innerHTML = `
      <div class="notification-icon">
        <i class="${icons[type] || icons.info}"></i>
      </div>
      <div class="notification-content">
        ${title ? `<div class="notification-title">${title}</div>` : ''}
        <div class="notification-message">${message}</div>
      </div>
      <button class="notification-close">
        <i class="fas fa-times"></i>
      </button>
      <div class="notification-progress"></div>
    `;

    try {
      // Agregar al contenedor
      container.appendChild(notification);
      console.log('‚úÖ Notificaci√≥n agregada al DOM');

      // Configurar cierre manual
      const closeBtn = notification.querySelector('.notification-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          this.removeNotification(notification);
        });
      }

      // Mostrar con animaci√≥n
      setTimeout(() => {
        notification.classList.add('show');
        console.log('‚úÖ Animaci√≥n de mostrar aplicada');
      }, 50);

      // Barra de progreso
      const progressBar = notification.querySelector('.notification-progress');
      if (progressBar && duration > 0) {
        progressBar.style.width = '100%';
        progressBar.style.transitionDuration = `${duration}ms`;
        
        setTimeout(() => {
          progressBar.style.width = '0%';
        }, 100);

        // Auto-remover despu√©s del tiempo especificado
        setTimeout(() => {
          this.removeNotification(notification);
        }, duration);
      }
    } catch (error) {
      console.error('‚ùå Error creando notificaci√≥n:', error);
      alert(`${title}: ${message}`);
    }
  }

  removeNotification(notification) {
    if (!notification || !notification.parentNode) return;
    
    notification.classList.remove('show');
    notification.classList.add('hide');
    
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 400);
  }

  // Funci√≥n para mostrar m√∫ltiples notificaciones
  showMultipleNotifications(notifications) {
    notifications.forEach((notif, index) => {
      setTimeout(() => {
        this.showNotification(notif.type, notif.title, notif.message, notif.duration);
      }, index * 200); // Delay progresivo para mejor UX
    });
  }

  // Inicializar sistema de recordatorios
  async initializeReminders() {
    try {
      console.log('üîî Inicializando sistema de recordatorios...');
      
      // Verificar que el m√≥dulo est√© disponible
      if (typeof RemindersManager === 'undefined') {
        console.warn('‚ö†Ô∏è RemindersManager no encontrado - continuando sin recordatorios');
        return;
      }
      
      console.log('üìã Creando instancia de RemindersManager...');
      this.remindersManager = new RemindersManager();
      
      // Hacer disponible globalmente
      window.remindersManager = this.remindersManager;
      
      console.log('‚úÖ Sistema de recordatorios inicializado correctamente');
    } catch (error) {
      console.error('‚ùå Error inicializando recordatorios:', error);
      console.warn('‚ö†Ô∏è Continuando sin sistema de recordatorios');
      // No lanzar el error para que la app contin√∫e funcionando
    }
  }

  // ===================================================
  // UTILIDADES PARA N√öMEROS EN FORMATO LATINOAMERICANO
  // ===================================================

  /**
   * Parsea un n√∫mero en formato latinoamericano
   * Acepta: 1.500,75 / 1,500.75 / 1500.75 / 1500,75 / 1500
   */
  parseLatinNumber(value) {
    if (!value || typeof value !== 'string') return 0;
    
    // Limpiar espacios y validar que contiene solo n√∫meros, puntos y comas
    const cleanValue = value.trim().replace(/\s+/g, '');
    if (!/^[\d.,]+$/.test(cleanValue)) return 0;
    
    // Contar puntos y comas
    const dotCount = (cleanValue.match(/\./g) || []).length;
    const commaCount = (cleanValue.match(/,/g) || []).length;
    
    let result;
    
    if (dotCount === 0 && commaCount === 0) {
      // Solo n√∫meros: 1500
      result = parseFloat(cleanValue);
    } else if (dotCount === 1 && commaCount === 0) {
      // Solo punto: 1500.75 (formato US) o 1.500 (separador de miles EU)
      const parts = cleanValue.split('.');
      if (parts[1] && parts[1].length <= 2) {
        // Decimal: 1500.75
        result = parseFloat(cleanValue);
      } else {
        // Miles: 1.500 -> 1500
        result = parseFloat(cleanValue.replace('.', ''));
      }
    } else if (dotCount === 0 && commaCount === 1) {
      // Solo coma: 1500,75 (decimal EU) o 1,500 (separador de miles US poco com√∫n)
      const parts = cleanValue.split(',');
      if (parts[1] && parts[1].length <= 2) {
        // Decimal: 1500,75 -> 1500.75
        result = parseFloat(cleanValue.replace(',', '.'));
      } else {
        // Miles: 1,500 -> 1500
        result = parseFloat(cleanValue.replace(',', ''));
      }
    } else if (dotCount > 0 && commaCount === 1) {
      // Formato mixto: 1.500,75 (EU) o 1,500.75 (US)
      const lastDotIndex = cleanValue.lastIndexOf('.');
      const lastCommaIndex = cleanValue.lastIndexOf(',');
      
      if (lastCommaIndex > lastDotIndex) {
        // Formato EU: 1.500,75
        result = parseFloat(cleanValue.replace(/\./g, '').replace(',', '.'));
      } else {
        // Formato US: 1,500.75
        result = parseFloat(cleanValue.replace(/,/g, ''));
      }
    } else {
      // Casos complejos: m√∫ltiples separadores
      // Asumir que el √∫ltimo es decimal
      if (cleanValue.endsWith('.') || cleanValue.endsWith(',')) {
        // Termina en separador, remover
        result = parseFloat(cleanValue.slice(0, -1).replace(/[.,]/g, ''));
      } else {
        // Tomar los √∫ltimos 1-2 d√≠gitos como decimales
        const lastSeparatorIndex = Math.max(
          cleanValue.lastIndexOf('.'),
          cleanValue.lastIndexOf(',')
        );
        const beforeDecimal = cleanValue.substring(0, lastSeparatorIndex).replace(/[.,]/g, '');
        const afterDecimal = cleanValue.substring(lastSeparatorIndex + 1);
        
        if (afterDecimal.length <= 2) {
          result = parseFloat(`${beforeDecimal}.${afterDecimal}`);
        } else {
          result = parseFloat(beforeDecimal + afterDecimal);
        }
      }
    }
    
    return isNaN(result) ? 0 : result;
  }

  /**
   * Formatea un n√∫mero al formato latinoamericano preferido
   * Usa punto para miles y coma para decimales: 1.500,75
   */
  formatLatinNumber(number, decimals = 2) {
    if (!number || isNaN(number)) return '0,00';
    
    const parts = number.toFixed(decimals).split('.');
    const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    const decimalPart = parts[1];
    
    return decimals > 0 ? `${integerPart},${decimalPart}` : integerPart;
  }

  /**
   * Valida si un string puede ser parseado como n√∫mero
   */
  isValidNumber(value) {
    if (!value || typeof value !== 'string') return false;
    const cleanValue = value.trim().replace(/\s+/g, '');
    return /^[\d.,]+$/.test(cleanValue) && this.parseLatinNumber(cleanValue) >= 0;
  }

  /**
   * Configura validaci√≥n en tiempo real para inputs num√©ricos
   */
  setupNumberInputValidation() {
    const numberInputs = [
      document.getElementById('valorTotalProducto'),
      document.getElementById('modal-valor')
    ];

    numberInputs.forEach(input => {
      if (!input) return;

      // Validaci√≥n en tiempo real mientras el usuario escribe
      input.addEventListener('input', (e) => {
        this.validateNumberInput(e.target);
      });

      // Validaci√≥n al perder el foco
      input.addEventListener('blur', (e) => {
        this.validateNumberInput(e.target, true);
      });

      // Formatear valor al perder el foco
      input.addEventListener('blur', (e) => {
        const value = this.parseLatinNumber(e.target.value);
        if (value > 0) {
          e.target.value = this.formatLatinNumber(value);
        }
      });
    });
  }

  /**
   * Valida un input num√©rico y aplica clases CSS
   */
  validateNumberInput(input, strict = false) {
    const value = input.value.trim();
    const helpText = input.nextElementSibling;
    
    // Limpiar clases anteriores
    input.classList.remove('error', 'valid');
    
    if (!value) {
      if (strict) {
        input.classList.add('error');
        if (helpText && helpText.classList.contains('input-help')) {
          helpText.textContent = 'Este campo es obligatorio';
          helpText.style.color = '#dc3545';
        }
      }
      return false;
    }

    const isValid = this.isValidNumber(value);
    const numericValue = this.parseLatinNumber(value);
    
    if (!isValid || numericValue <= 0) {
      input.classList.add('error');
      if (helpText && helpText.classList.contains('input-help')) {
        helpText.textContent = 'Formato inv√°lido. Ej: 1.500,75 o 1,500.75';
        helpText.style.color = '#dc3545';
      }
      return false;
    } else {
      input.classList.add('valid');
      if (helpText && helpText.classList.contains('input-help')) {
        helpText.textContent = `Valor: $${this.formatLatinNumber(numericValue)}`;
        helpText.style.color = '#28a745';
      }
      return true;
    }
  }

  // Funci√≥n de prueba para notificaciones
  testNotification() {
    console.log('üß™ Probando sistema de notificaciones...');
    this.showNotification('success', 'Prueba exitosa', 'El sistema de notificaciones est√° funcionando correctamente');
  }

  // Funci√≥n auxiliar para rect√°ngulos con esquinas redondeadas
  drawRoundedRect(doc, x, y, width, height, radius, style = 'S') {
    try {
      // Verificar si jsPDF tiene la funci√≥n roundedRect
      if (typeof doc.roundedRect === 'function') {
        doc.roundedRect(x, y, width, height, radius, radius, style);
      } else {
        // Fallback: dibujar rect√°ngulo normal
        this.drawRoundedRect(doc, x, y, width, height, style, 4, 'S');
      }
    } catch (error) {
      // Si hay error, usar rect√°ngulo normal
      this.drawRoundedRect(doc, x, y, width, height, style, 4, 'S');
    }
  }
  
  // Funci√≥n auxiliar para determinar icono de producto (texto)
  getProductIcon(productName) {
    const name = productName.toLowerCase();
    
    // Tecnolog√≠a
    if (name.includes('laptop') || name.includes('computador') || name.includes('pc') || name.includes('macbook')) return '[LAPTOP]';
    if (name.includes('celular') || name.includes('phone') || name.includes('movil') || name.includes('iphone') || name.includes('samsung')) return '[PHONE]';
    if (name.includes('tablet') || name.includes('ipad')) return '[TABLET]';
    if (name.includes('tv') || name.includes('televisor') || name.includes('smart tv') || name.includes('pantalla')) return '[TV]';
    if (name.includes('playstation') || name.includes('xbox') || name.includes('gaming') || name.includes('nintendo')) return '[GAME]';
    if (name.includes('auriculares') || name.includes('headphones') || name.includes('audifonos')) return '[AUDIO]';
    if (name.includes('camara') || name.includes('camera') || name.includes('gopro')) return '[CAM]';
    
    // Veh√≠culos
    if (name.includes('carro') || name.includes('auto') || name.includes('vehiculo') || name.includes('toyota') || name.includes('chevrolet') || name.includes('ford')) return '[CAR]';
    if (name.includes('moto') || name.includes('motocicleta') || name.includes('yamaha') || name.includes('honda')) return '[MOTO]';
    if (name.includes('bicicleta') || name.includes('bike')) return '[BIKE]';
    
    // Hogar
    if (name.includes('casa') || name.includes('apartamento') || name.includes('vivienda') || name.includes('inmueble')) return '[HOME]';
    if (name.includes('refrigerador') || name.includes('nevera') || name.includes('heladera')) return '[FRIDGE]';
    if (name.includes('lavadora') || name.includes('secadora')) return '[WASH]';
    if (name.includes('horno') || name.includes('microondas') || name.includes('estufa')) return '[OVEN]';
    if (name.includes('sofa') || name.includes('mueble') || name.includes('cama')) return '[FURN]';
    
    // Educaci√≥n y trabajo
    if (name.includes('curso') || name.includes('educacion') || name.includes('capacitacion') || name.includes('universidad')) return '[EDU]';
    if (name.includes('libro') || name.includes('manual')) return '[BOOK]';
    
    // Salud y deporte
    if (name.includes('bicicleta') || name.includes('gimnasio') || name.includes('deporte')) return '[GYM]';
    if (name.includes('medico') || name.includes('salud') || name.includes('dental')) return '[HEALTH]';
    
    // Viajes
    if (name.includes('viaje') || name.includes('vacaciones') || name.includes('vuelo')) return '[TRAVEL]';
    if (name.includes('hotel') || name.includes('hospedaje')) return '[HOTEL]';
    
    // Servicios
    if (name.includes('seguro') || name.includes('poliza')) return '[SHIELD]';
    if (name.includes('internet') || name.includes('wifi') || name.includes('plan')) return '[WIFI]';
    
    // Default
    return '[ITEM]';
  }

  // Funciones mejoradas para manejar productos
}

// Inicializar aplicaci√≥n cuando el DOM est√© listo
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üü¢ DOM cargado, creando aplicaci√≥n JS...');
    setTimeout(() => {
      try {
        window.app = new CalculadoraCuotas();
      } catch (error) {
        console.error('‚ùå Error cr√≠tico inicializando aplicaci√≥n:', error);
        // Mostrar mensaje de error al usuario
        const loading = document.getElementById('loadingIndicator');
        if (loading) {
          loading.innerHTML = `
            <div style="text-align: center; color: #dc3545;">
              <h3>‚ùå Error de Inicializaci√≥n</h3>
              <p>No se pudo cargar la aplicaci√≥n correctamente.</p>
              <p style="font-size: 14px; opacity: 0.8;">Error: ${error.message}</p>
              <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üîÑ Recargar P√°gina
              </button>
            </div>
          `;
        }
      }
    }, 100);
  });
} else {
  console.log('üü¢ DOM ya est√° cargado, creando aplicaci√≥n JS...');
  setTimeout(() => {
    try {
      window.app = new CalculadoraCuotas();
    } catch (error) {
      console.error('‚ùå Error cr√≠tico inicializando aplicaci√≥n:', error);
      // Mostrar mensaje de error al usuario
      const loading = document.getElementById('loadingIndicator');
      if (loading) {
        loading.innerHTML = `
          <div style="text-align: center; color: #dc3545;">
            <h3>‚ùå Error de Inicializaci√≥n</h3>
            <p>No se pudo cargar la aplicaci√≥n correctamente.</p>
            <p style="font-size: 14px; opacity: 0.8;">Error: ${error.message}</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
              üîÑ Recargar P√°gina
            </button>
          </div>
        `;
      }
    }
  }, 100);
}

// Timeout de emergencia global - Fuerza ocultar loading despu√©s de 3 segundos
setTimeout(() => {
  console.log('üö® TIMEOUT DE EMERGENCIA - Forzando ocultado de loading');
  const loading = document.getElementById('loadingIndicator');
  if (loading && loading.style.display !== 'none') {
    loading.style.display = 'none';
    console.log('‚úÖ Loading forzadamente ocultado por timeout de emergencia');
  }
}, 3000);

// Funciones globales de prueba
window.testNotifications = function() {
  console.log('üß™ Iniciando prueba de notificaciones...');
  if (window.app && typeof window.app.testNotification === 'function') {
    window.app.testNotification();
  } else {
    console.error('‚ùå Aplicaci√≥n no disponible o funci√≥n testNotification no existe');
  }
};

window.forceNotification = function(type = 'info', title = 'Prueba', message = 'Mensaje de prueba') {
  console.log('üî• FORZANDO NOTIFICACI√ìN:', { type, title, message });
  console.log('üîç Estado de window.app:', !!window.app);
  
  if (window.app && typeof window.app.showNotification === 'function') {
    console.log('‚úÖ Llamando a app.showNotification...');
    window.app.showNotification(type, title, message);
  } else {
    console.error('‚ùå window.app no disponible o showNotification no existe');
    console.log('üîç window.app:', window.app);
    
    // Test directo sin la clase
    console.log('üß™ Intentando test directo...');
    const container = document.getElementById('notificationContainer');
    if (container) {
      console.log('‚úÖ Contenedor encontrado, creando notificaci√≥n manual...');
      const notif = document.createElement('div');
      notif.className = `notification ${type}`;
      notif.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
          <i class="fas fa-check-circle"></i>
          <div>
            <div style="font-weight: 600;">${title}</div>
            <div>${message}</div>
          </div>
        </div>
      `;
      container.appendChild(notif);
      
      setTimeout(() => {
        notif.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        if (notif.parentNode) {
          notif.parentNode.removeChild(notif);
        }
      }, 3000);
    } else {
      console.error('‚ùå Ni siquiera el contenedor existe');
      alert(`${title}: ${message}`);
    }
  }
};

// Funci√≥n para probar EmailJS espec√≠ficamente
window.testEmailJS = function() {
  console.log('üß™ Probando configuraci√≥n de EmailJS...');
  
  // Esperar un poco para asegurar que todo est√© cargado
  setTimeout(() => {
    console.log('üìß EmailJS disponible:', !!window.emailjs);
    console.log('‚öôÔ∏è Configuraci√≥n disponible:', !!window.SERVICES_CONFIG);
    
    if (window.SERVICES_CONFIG) {
      console.log('üîß Configuraci√≥n EmailJS:', window.SERVICES_CONFIG.emailJS);
    } else {
      console.log('‚ùå SERVICES_CONFIG no encontrado');
      
      // Intentar acceder a la variable global directamente
      if (typeof SERVICES_CONFIG !== 'undefined') {
        window.SERVICES_CONFIG = SERVICES_CONFIG;
        console.log('‚úÖ Configuraci√≥n recuperada desde variable global');
      } else {
        console.log('‚ùå Tampoco existe la variable global SERVICES_CONFIG');
      }
    }
    
    if (window.emailjs && window.SERVICES_CONFIG) {
      try {
        // Intentar inicializar
        emailjs.init(window.SERVICES_CONFIG.emailJS.publicKey);
        console.log('‚úÖ EmailJS inicializado manualmente');
        
        if (window.app) {
          window.app.showNotification('success', 'EmailJS Test', 'Configuraci√≥n b√°sica correcta');
        }
        
      } catch (error) {
        console.error('‚ùå Error configurando EmailJS:', error);
        if (window.app) {
          window.app.showNotification('error', 'EmailJS Config Error', error.message);
        }
      }
    } else {
      const missing = [];
      if (!window.emailjs) missing.push('emailjs');
      if (!window.SERVICES_CONFIG) missing.push('SERVICES_CONFIG');
      
      console.error('‚ùå Faltan dependencias:', missing);
      if (window.app) {
        window.app.showNotification('error', 'EmailJS Test', `Faltan: ${missing.join(', ')}`);
      }
    }
  }, 200); // Esperar 200ms para que se carguen los scripts
};

// Funci√≥n simple para probar solo notificaciones
window.testBasicNotification = function() {
  console.log('üß™ Probando notificaciones b√°sicas...');
  
  if (window.app && typeof window.app.showNotification === 'function') {
    window.app.showNotification('success', 'Test B√°sico', 'Las notificaciones b√°sicas funcionan correctamente');
    console.log('‚úÖ Notificaciones b√°sicas funcionando');
  } else {
    console.error('‚ùå Sistema de notificaciones no disponible');
    alert('‚ùå Sistema de notificaciones no disponible');
  }
};
    </script>
    
    <!-- Script de navegaci√≥n embebido -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            const navOverlay = document.querySelector('.nav-overlay');
            const navLinks = document.querySelectorAll('.nav-link');

            // Toggle men√∫ m√≥vil
            hamburger.addEventListener('click', function() {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
                navOverlay.classList.toggle('active');
                document.body.classList.toggle('nav-open');
            });

            // Cerrar men√∫ al hacer clic en overlay
            navOverlay.addEventListener('click', function() {
                closeMenu();
            });

            // Cerrar men√∫ al hacer clic en un enlace
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    
                    if (targetSection) {
                        targetSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                    
                    closeMenu();
                    
                    // Actualizar enlace activo
                    navLinks.forEach(l => l.parentElement.classList.remove('active'));
                    this.parentElement.classList.add('active');
                });
            });

            // Funci√≥n para cerrar men√∫
            function closeMenu() {
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
                navOverlay.classList.remove('active');
                document.body.classList.remove('nav-open');
            }

            // Cerrar men√∫ al scroll en m√≥vil
            let isScrolling = false;
            window.addEventListener('scroll', function() {
                if (!isScrolling && window.innerWidth <= 768) {
                    isScrolling = true;
                    closeMenu();
                    setTimeout(() => {
                        isScrolling = false;
                    }, 100);
                }
            });

            // Actualizar enlace activo al hacer scroll
            window.addEventListener('scroll', function() {
                const sections = document.querySelectorAll('.section');
                const scrollPos = window.scrollY + 100;

                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.getAttribute('id');

                    if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                        navLinks.forEach(link => {
                            link.parentElement.classList.remove('active');
                            if (link.getAttribute('href') === '#' + sectionId) {
                                link.parentElement.classList.add('active');
                            }
                        });
                    }
                });
            });
        });
    </script>
    
    <!-- Timeout de emergencia para evitar cuelgues -->
    <script>
        // Timeout de emergencia - fuerza ocultar loading despu√©s de 2 segundos
        setTimeout(() => {
            const loading = document.getElementById('loadingIndicator');
            if (loading && loading.style.display !== 'none') {
                loading.style.display = 'none';
                console.log('‚úÖ Loading ocultado por timeout de emergencia (versi√≥n embebida)');
            }
        }, 2000);
        
        // Inicializaci√≥n inmediata del loading
        document.addEventListener('DOMContentLoaded', () => {
            const loading = document.getElementById('loadingIndicator');
            if (loading) {
                setTimeout(() => {
                    if (loading.style.display !== 'none') {
                        loading.style.display = 'none';
                        console.log('‚úÖ Loading ocultado por timeout DOM (versi√≥n embebida)');
                    }
                }, 1000);
            }
        });
        
        console.log('üî• Aplicaci√≥n cargada con assets embebidos - Sin dependencias externas de archivos');
    </script>
</body>
</html>
